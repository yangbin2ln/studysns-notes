var Utils={isIE:function(){return!!window.ActiveXObject},isIE8:function(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")&&-1!=e.indexOf("8.0")},ltIE8:function(){var e=navigator.userAgent.toLowerCase();return!!(-1<e.indexOf("msie"))&&e.match(/msie ([\d.]+)/)[1]<="8.0"},htmlEncode:function(e){return 0==e.length?"":e.replace(/&/g,"&#38;").replace(/\"/g,"&#34;").replace(/\'/g,"&#39;").replace(/</g,"&#60;").replace(/>/g,"&#62;")},htmlDecode:function(e){return 0==e.length?"":e.replace(/&#62;/g,">").replace(/&#60;/g,"<").replace(/&#39;/g,"'").replace(/&#34;/g,'"').replace(/&#38;/g,"&")},apply:function(e,t){var n;if(e&&t&&"object"==typeof t)for(n in t)e[n]=t[n];return e},applyIf:function(e,t){var n;if(e)for(n in t)void 0===e[n]&&(e[n]=t[n]);return e},clone:function(e){if(null==e)return e;if(e.nodeType&&e.cloneNode)return e.cloneNode(!0);var t,n,o,l=toString.call(e);if("[object Date]"===l)return new Date(e.getTime());if("[object Array]"===l)for(t=e.length,n=[];t--;)n[t]=Utils.clone(e[t]);else if("[object Object]"===l&&e.constructor===Object)for(o in n={},e)n[o]=Utils.clone(e[o]);return n||e},on:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},off:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},getEvent:function(e){return e||window.event},getEventTarget:function(e){return e.target||e.srcElement},getParameter:function(e){for(var t=unescape(window.location.search.substr(1)).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if(2==o.length&&o[0].toUpperCase()==e.toUpperCase())return o[1]}return null},replaceParamVal:function(paramName,replaceWith,url){var oUrl=location.href.toString();null!=url&&null!=url&&(oUrl=url);var nUrl=null;if(-1!=oUrl.indexOf(paramName+"=")){var re=eval("/("+paramName+"=)([^&]*)/gi");nUrl=oUrl.replace(re,paramName+"="+replaceWith)}else nUrl=oUrl,-1!=nUrl.indexOf("?")?nUrl+="&"+paramName+"="+replaceWith:nUrl+="?"+paramName+"="+replaceWith;return nUrl},require:function(e,t,n){null!=n&&null!=n||(n=0);var o=Utils.getExtName(e[n]);n==e.length-1?"css"===o?Utils.addCss(e[n],t):"js"===o?Utils.addScript(e[n],t):Utils.getTemplate(e[n],t):"css"===o?Utils.addCss(e[n],function(){n++,Utils.require(e,t,n)}):"js"===o?Utils.addScript(e[n],function(){n++,Utils.require(e,t,n)}):Utils.getTemplate(e[n],function(){n++,Utils.require(e,t,n)})},addScript:function(e,t){e=e+"?v="+STATIC_VERSION;for(var n=document.getElementsByTagName("head")[0],o=n.getElementsByTagName("script"),l=!1,i=0;i<o.length;i++){if(o[i].getAttribute("src")==e){l=!0;break}}if(l)t&&"function"==typeof t&&t();else{var r=document.createElement("script");r.setAttribute("src",e),r.setAttribute("type","text/javascript"),r.onload=r.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(t&&"function"==typeof t&&t(),r.onload=r.onreadystatechange=null)},n.appendChild(r)}},addCss:function(e,t){e=e+"?v="+STATIC_VERSION;for(var n=document.getElementsByTagName("head")[0],o=n.getElementsByTagName("link"),l=!1,i=0;i<o.length;i++){if(o[i].getAttribute("href")==e){l=!0;break}}if(!l){var r=document.createElement("link");r.setAttribute("type","text/css"),r.setAttribute("rel","stylesheet"),r.setAttribute("href",e),n.appendChild(r)}t&&"function"==typeof t&&t()},templateCache:[],getTemplate:function(n,o){n=n+"?v="+STATIC_VERSION;for(var l="",e=0;e<Utils.templateCache.length;e++){var t=Utils.templateCache[e];if(n==t.path)return void(o&&"function"==typeof o&&o(t.content))}Utils.Messager.send({type:"GET",url:n,cache:!0,onSuccess:function(e){var t={path:n,content:l=e};Utils.templateCache.push(t),o&&"function"==typeof o&&o(l)}})},isNotEmpty:function(e){return!this.isEmpty(e)},isEmpty:function(e){return null==e||void 0===e||"string"==typeof e&&""==e&&"undefined"!=e},isNumber:function(e){return!isNaN(e)},each:function(e,t,n){if(null!=e)if(e.length===+e.length){for(var o=0,l=e.length;o<l;o++)if(!1===t.call(n,e[o],o,e))return!1}else for(var i in e)if(e.hasOwnProperty(i)&&!1===t.call(n,e[i],i,e))return!1},inArray:function(e,n){var o=-1;return this.each(e,function(e,t){if(e===n)return o=t,!1}),o},pushItem:function(e,t){-1==this.inArray(e,t)&&e.push(t)},removeItem:function(e,t){for(var n=0,o=e.length;n<o;n++)e[n]===t&&(e.splice(n,1),n--)},replaceAll:function(e,t,n){return raRegExp=new RegExp(t,"g"),e.replace(raRegExp,n)},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},getExtName:function(e){return e.substring(e.lastIndexOf(".")+1).toLowerCase()},formatCurrency:function(e){e=e.toString().replace(/\$|\,/g,""),isNaN(e)&&(e="0"),sign=e==(e=Math.abs(e)),e=Math.floor(100*e+.50000000001),cents=e%100,e=Math.floor(e/100).toString(),cents<10&&(cents="0"+cents);for(var t=0;t<Math.floor((e.length-(1+t))/3);t++)e=e.substring(0,e.length-(4*t+3))+","+e.substring(e.length-(4*t+3));return(sign?"":"-")+e+"."+cents},formatDate:function(t,e){function n(e,t){return t=t.length,e=e||0}return e.replace(/([YMDhsm])\1*/g,function(e){switch(e.charAt()){case"Y":return n(t.getFullYear(),e);case"M":return Utils.leftZeroPad(n(t.getMonth()+1,e),2);case"D":return Utils.leftZeroPad(n(t.getDate(),e),2);case"w":return t.getDay()+1;case"h":return Utils.leftZeroPad(n(t.getHours(),e),2);case"m":return Utils.leftZeroPad(n(t.getMinutes(),e),2);case"s":return Utils.leftZeroPad(n(t.getSeconds(),e),2)}})},leftZeroPad:function(e,t){return"string"!=typeof e&&(e=String(e)),"00000000000000000000".substring(0,t-e.length)+e},getUUID:function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},Map:function(){this.map={},this.length=0}};Utils.Map.prototype={put:function(e,t){var n=this.map;return this.containsKey(e)||++this.length,n[e]=t,this},get:function(e){var t=this.map;return t.hasOwnProperty(e)?t[e]:void 0},containsKey:function(e){var t=this.map;return t.hasOwnProperty(e)&&void 0!==t[e]},removeAtKey:function(e){return!!this.containsKey(e)&&(delete this.map[e],--this.length,!0)},clear:function(){return this.map={},this.length=0,this},getKeys:function(){return this.getArray(!0)},getValues:function(){return this.getArray(!1)},getArray:function(e){var t,n=[],o=this.map;for(t in o)o.hasOwnProperty(t)&&n.push(e?t:o[t]);return n},each:function(e,t){var n,o=Utils.apply({},this.map),l=this.length;for(n in t=t||this,o)if(o.hasOwnProperty(n)&&!1===e.call(t,n,o[n],l))break;return this}},Utils.Messager={send:function(e){var t=this,n=t.makeRequest();e=t.buildCfg(e),n.onreadystatechange=function(){t.readyStateChange(n,e)},n.open(e.method,e.url,e.async),"GET"===e.method?n.send(null):(n.setRequestHeader("Content-type",e.contentType),n.send(e.data))},makeRequest:function(){var t=!1;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return t},buildCfg:function(e){if(e.method=null==e.type||null==e.type?"POST":e.type.toUpperCase(),e.async=null==e.sync||null==e.sync||!e.sync,e.cache=null!=e.cache&&null!=e.cache&&e.cache,e.contentType=null==e.contentType||null==e.contentType?"application/x-www-form-urlencoded":e.contentType,e.cache||(-1!=e.url.indexOf("?")?e.url+="&":e.url+="?",e.url+="t="+(new Date).getTime()),"object"==typeof e.data){var t="";for(var n in e.data)t+=n+"="+e.data[n]+"&";e.data=t.substring(0,t.length-1)}return e},readyStateChange:function(e,t){4==e.readyState&&(200==e.status||304==e.status?t.onSuccess&&t.onSuccess(e.responseText):t.onError&&t.onError())}},Utils.Math={random:function(e,t){return Math.floor(Math.random()*(t-e))+e},add:function(e,t){var n,o,l;try{n=e.toString().split(".")[1].length}catch(e){n=0}try{o=t.toString().split(".")[1].length}catch(e){o=0}return(e*(l=Math.pow(10,Math.max(n,o)))+t*l)/l},sub:function(e,t){var n,o,l;try{n=e.toString().split(".")[1].length}catch(e){n=0}try{o=t.toString().split(".")[1].length}catch(e){o=0}return((e*(l=Math.pow(10,Math.max(n,o)))-t*l)/l).toFixed(o<=n?n:o)},mul:function(e,t){var n=0,o=e.toString(),l=t.toString();try{n+=o.split(".")[1].length}catch(e){}try{n+=l.split(".")[1].length}catch(e){}return Number(o.replace(".",""))*Number(l.replace(".",""))/Math.pow(10,n)},div:function(arg1,arg2){var t1=0,t2=0,r1,r2;try{t1=arg1.toString().split(".")[1].length}catch(e){}try{t2=arg2.toString().split(".")[1].length}catch(e){}with(Math)return r1=Number(arg1.toString().replace(".","")),r2=Number(arg2.toString().replace(".","")),r1/r2*pow(10,t2-t1)}},Utils.Cookie={openCookie:function(){var e=!!navigator.cookieEnabled;return void 0!==navigator.cookieEnabled||e||(e=(document.cookie="testcookie")==document.cookie||(falsedocument.cookie="")),!!e},setCookie:function(e,t,n){date=new Date,null!=n&&null!=n||(n=1440),date.setTime(date.getTime()+60*n*1e3),document.cookie=e+"="+escape(t)+";expires="+date.toGMTString()+";path=/"},getCookie:function(e){var t=new RegExp(e+"=[^;]+","i");return document.cookie.match(t)?document.cookie.match(t)[0].split("=")[1]:""}};var Message={msg:function(e,t,n){var o="提示";null!=t&&null!=t||(t="INFO");var l=Ext.Msg.INFO;"INFO"===t.toUpperCase()?l=Ext.Msg.INFO:"WARN"===t.toUpperCase()?(l=Ext.Msg.WARNING,o="警告"):"ERROR"===t.toUpperCase()&&(l=Ext.Msg.ERROR,o="错误"),Ext.Msg.show({title:o,msg:e,buttons:Ext.MessageBox.OK,icon:l,fn:null==n||null==n?function(){}:n})},input:function(e,o){Ext.Msg.prompt(e,"",function(e,t){var n=!1;"OK"===e.toUpperCase()&&(n=!0),o(n,t)})},ask:function(e,n){Ext.Msg.confirm("询问",e,function(e){var t=!1;"YES"===e.toUpperCase()&&(t=!0),n(t)})}};TopMessage=function(){var a;return{info:function(e){TopMessage.msg(e,"消息","info")},warn:function(e){TopMessage.msg(e,"警告","warn")},error:function(e){TopMessage.msg(e,"错误","error")},msg:function(e,t,n){a?document.body.appendChild(a.dom):a=Ext.DomHelper.append(document.body,{id:"top-msg-div"},!0);var o;null!=t&&null!=t||(t="消息");var l=document.createElement("div");l.setAttribute("class","top-msg "+Ext.baseCSSPrefix+"border-box"),null!=n&&null!=n?"INFO"===n.toUpperCase()?(l.style.border="2px solid #3892d3",l.style.color="#3892d3"):"WARN"===n.toUpperCase()?(l.style.border="2px solid #eb7e23",l.style.color="#eb7e23"):"ERROR"===n.toUpperCase()&&(l.style.border="2px solid red",l.style.color="red"):l.style.border="2px solid #ccc",Ext.DomHelper.append(l,"<h3>"+t+"</h3><p>"+e+"</p>",!0);var i=document.createElement("outerDiv");i.appendChild(l),o=i.innerHTML,i=null;var r=Ext.DomHelper.append(a,o,!0);r.hide(),r.slideIn("t").ghost("t",{delay:3e3,remove:!0})}}}();var Messager={send:function(t){var n=this;null!=t.confirm?Message.ask(t.confirm,function(e){1==e&&n.base(t)}):n.base(t)},base:function(o){var l=null;null!=o.maskCmp&&(l=new Ext.LoadMask({msg:null!=o.maskText&&null!=o.maskText?o.maskText:"正在加载，请稍后...",target:o.maskCmp})),null!=l&&l.show();var e=!0;null!=o.onBefore&&(e=o.onBefore()),e&&Ext.Ajax.request({url:o.url,params:o.data,async:null==o.sync||null==o.sync||!o.sync,success:function(t){if(null!=l&&Ext.destroy(l),null!=o.onSuccess){var n=null;if(null!=t.responseText&&null!=t.responseText&&""!=t.responseText)try{n=Ext.JSON.decode(t.responseText)}catch(e){n=t.responseText}o.onSuccess(n)}},failure:function(e,t){null!=l&&Ext.destroy(l),null!=o.onError&&o.onError(e,t)}})}};Ext.define("Ins.data.Store",{extend:"Ext.data.Store",alias:["widget.ins_store"],config:{url:null},autoLoad:!0,pageSize:1e3,constructor:function(){var e=this;e.callParent(arguments),null!=e.url?e.setProxy({type:"ajax",url:e.url,simpleSortMode:!0,actionMethods:{read:"POST"},reader:{type:"json",rootProperty:"data",totalProperty:"total"},extraParams:null==e.params||null==e.params?{}:e.params}):e.setProxy({type:"memory",reader:{type:"json"}})},getTotle:function(){return this.getTotalCount()},findRecordById:function(e,t){return this.findRecord(e,t)},findRecordByIndex:function(e){return this.getAt(e)},getColumnData:function(e){for(var t=[],n=0;n<this.getTotle();n++){var o=this.findRecordByIndex(n);if(null==o||null==o)break;t.push(o.get(e))}return{ser:Ext.JSON.encode(t),data:t}},getCurrentPageData:function(){return this.data.items},addRecords:function(e){this.add(e)},removeAllRecords:function(){this.removeAll()}}),Ext.define("Ins.panel.Panel",{extend:"Ext.panel.Panel",alias:"widget.ins_panel",config:{views:[],headButtons:[],actionButtons:[],actionButtonsAlign:"top",actionButtonsStyle:"default",onAfterRender:null,onAfterResize:null,useAppBg:!1},layout:"fit",headerPosition:"top",initComponent:function(){var e=this;if(e.useAppBg&&(e.bodyStyle="background-image:url("+App.LAYOUT_BG+")"),0<e.actionButtons.length){var t={id:e.getId()+"_toolbar",xtype:"toolbar",items:e.actionButtons,dock:e.actionButtonsAlign,ui:e.actionButtonsStyle};Ext.apply(e,{dockedItems:t})}0<e.headButtons.length&&Ext.apply(e,{tools:e.headButtons}),Ext.apply(e,{items:e.views}),null!=e.onAfterRender&&e.addListener("afterrender",e.onAfterRender),null!=e.onAfterResize&&e.addListener("resize",e.onAfterResize),this.callParent(arguments)}}),Ext.define("Ins.layout.BorderLayout",{extend:"Ext.panel.Panel",alias:["widget.ins_borderlayout"],config:{views:[],location:[],fold:[],useAppBg:!1},locationMapping:{top:"north",bottom:"south",left:"west",right:"east",center:"center"},border:!1,initComponent:function(){var e=this;e.useAppBg&&(e.bodyStyle="background-image:url("+App.LAYOUT_BG+")");var t=[];for(var n in e.views){var o=e.views[n],l=e.locationMapping[e.location[n]];if(Ext.apply(o,{region:l}),null!=e.fold&&null!=e.fold&&e.fold.length>n){var i=e.fold[n];null!=i&&null!=i&&1==i&&Ext.apply(o,{split:!0,collapsible:!0,collapseMode:"undefinde"})}t.push(o)}Ext.apply(e,{layout:"border",items:t}),this.callParent(arguments)},foldView:function(e){Ext.getCmp(e).collapse()},unfoldView:function(e){Ext.getCmp(e).expand()}}),Ext.define("Ins.layout.BoxLayout",{extend:"Ext.panel.Panel",alias:["widget.ins_boxlayout"],config:{views:[],direction:"-",comSize:[],useAppBg:!1},border:!1,initComponent:function(){var e=this;e.useAppBg&&(e.bodyStyle="background-image:url("+App.LAYOUT_BG+")");var t=null;t="-"==e.direction?{type:"hbox",align:"stretch"}:{type:"vbox",align:"stretch"};for(var n=0;n<e.views.length;n++)null==e.comSize[n]||null==e.comSize[n]||Ext.apply(e.views[n],e.comSize[n]);Ext.apply(e,{layout:t,items:e.views}),this.callParent(arguments)}}),Ext.define("Ins.layout.AccrodionLayout",{extend:"Ext.panel.Panel",alias:["widget.ins_accrodionlayout"],config:{views:[]},layout:{type:"accordion",titleCollapse:!0,animate:!0},initComponent:function(){0<this.views.length&&Ext.apply(this,{items:this.views}),this.callParent(arguments)}}),Ext.define("Ins.layout.tab.TabLayout",{extend:"Ext.tab.Panel",alias:["widget.ins_tablayout"],config:{views:[],direction:"top",onTabChange:null,useAppBg:!1},activeTab:0,flex:1,border:!1,deferredRender:!1,initComponent:function(){var l=this;if(l.useAppBg&&(l.bodyStyle="background-image:url("+App.LAYOUT_BG+")"),0!=l.views.length){var e=[];for(var t in l.views){var n=l.views[t];Ext.apply(n,{tabConfig:{tooltip:l.views[t].title}}),e.push(n)}Ext.apply(l,{items:e,defaults:{closeText:"关闭此标签"}})}l.setTabPosition(l.direction),null!=l.onTabChange&&null!=l.onTabChange&&l.addListener("tabchange",function(e,t,n,o){l.onTabChange(l.getSelectedTabTitle(),n,t)}),this.callParent(arguments)},setDisabled:function(e){this.callParent([e]),this.selectTabByIndex(1),this.selectTabByIndex(0)},selectTabByIndex:function(e){this.setActiveTab(e)},selectTabById:function(e){var t=Ext.getCmp(e);t.setDisabled(!1),this.setActiveTab(t)},getSelectedTabTitle:function(){return this.getActiveTab().title}}),Ext.define("Ins.layout.tab.TabCloseMenu",{extend:"Ext.plugin.Abstract",alias:"plugin.ins_tabclosemenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"关闭标签",showCloseOthers:!0,closeOthersTabsText:"关闭其它标签",showCloseAll:!0,closeAllTabsText:"关闭所有标签",extraItemsHead:null,extraItemsTail:null,constructor:function(e){this.callParent([e]),this.mixins.observable.constructor.call(this,e)},init:function(e){this.tabPanel=e,this.tabBar=e.down("tabbar"),this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:!0})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:".x-tab"})},destroy:function(){this.callParent(),Ext.destroy(this.menu)},onContextMenu:function(e,t){var n=this,o=n.createMenu(),l=!0,i=!0,r=n.tabBar.getChildByElement(t),a=n.tabBar.items.indexOf(r);n.item=n.tabPanel.getComponent(a),o.child("#close").setDisabled(!n.item.closable),(n.showCloseAll||n.showCloseOthers)&&(n.tabPanel.items.each(function(e){return!e.closable||(l=!1,e===n.item)||(i=!1)}),n.showCloseAll&&o.child("#closeAll").setDisabled(l),n.showCloseOthers&&o.child("#closeOthers").setDisabled(i)),e.preventDefault?e.preventDefault():e.returnValue=!1,n.fireEvent("beforemenu",o,n.item,n),o.showAt(e.getXY())},createMenu:function(){var e=this;if(!e.menu){var t=[{itemId:"close",iconCls:"icon-cross",text:e.closeTabText,scope:e,handler:e.onClose}];(e.showCloseAll||e.showCloseOthers)&&t.push("-"),e.showCloseOthers&&t.push({itemId:"closeOthers",text:e.closeOthersTabsText,scope:e,handler:e.onCloseOthers}),e.showCloseAll&&t.push({itemId:"closeAll",text:e.closeAllTabsText,scope:e,handler:e.onCloseAll}),e.extraItemsHead&&(t=e.extraItemsHead.concat(t)),e.extraItemsTail&&(t=t.concat(e.extraItemsTail)),e.menu=Ext.create("Ext.menu.Menu",{items:t,listeners:{hide:e.onHideMenu,scope:e}})}return e.menu},onHideMenu:function(){this.fireEvent("aftermenu",this.menu,this)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(!0)},onCloseAll:function(){this.doClose(!1)},doClose:function(t){var n=[];this.tabPanel.items.each(function(e){e.closable&&(t&&e===this.item||n.push(e))},this),Ext.suspendLayouts(),Ext.Array.forEach(n,function(e){this.tabPanel.remove(e)},this),Ext.resumeLayouts(!0)}}),Ext.define("Ins.layout.CenterLayout",{extend:"Ins.panel.Panel",alias:["widget.ins_centerlayout"],layout:"center",initComponent:function(){this.callParent(arguments)}}),Ext.define("Ins.window.Window",{extend:"Ext.window.Window",alias:["widget.ins_window"],config:{views:[],hideTitle:!1,headButtons:[],actionButtons:[],actionButtonsAlign:"bottom",actionButtonsStyle:"footer",onBeforeShow:null,onBeforeHide:null,useAppBg:!1},title:"未命名窗体",closeAction:"hide",collapsible:!0,resizable:!0,modal:!0,layout:"fit",headerPosition:"top",maximizable:!1,minimizable:!1,constrain:!0,constrainHeader:!0,initComponent:function(){var e=this;if(e.useAppBg&&(e.bodyStyle="background-image:url("+App.LAYOUT_BG+")"),e.header=!e.hideTitle,0<e.actionButtons.length){var t={id:e.getId()+"_toolbar",xtype:"toolbar",dock:e.actionButtonsAlign,items:e.actionButtons,ui:e.actionButtonsStyle};Ext.apply(e,{dockedItems:t})}0<e.headButtons.length&&Ext.apply(e,{tools:e.headButtons}),Ext.apply(e,{items:e.views}),null!=e.onBeforeShow&&null!=e.onBeforeShow&&e.addListener("beforeshow",e.onBeforeShow),null!=e.onBeforeHide&&null!=e.onBeforeHide&&e.addListener("beforehide",e.onBeforeHide),this.callParent(arguments)},alignToCenter:function(){this.center()}}),Ext.define("Ins.menu.Menu",{extend:"Ext.menu.Menu",alias:["widget.ins_menu"],config:{},initComponent:function(){this.callParent(arguments)},showMenu:function(e){this.showAt(e.pageX,e.pageY)}}),Ext.define("Ins.tree.Tree",{extend:"Ext.tree.Panel",config:{url:null,fields:[],pkField:"id",onDblClick:null,onContextMenuClick:null,onClick:null,loadOnShow:!0,clearOnLoad:!0,hideTitle:!1,searchFiled:!1,searchFieldText:"查询",actionButtons:[],checkedAsParent:!0,noCheckedAsParent:!0,checkedAsChild:!0,noCheckedAsChild:!0,onCtxClick:null,NODE_EXPAND_STATE:[],afterChecked:function(){}},title:"未命名标题",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!1,width:240,initComponent:function(){var r=this;(null!=r.getHeader()||r.hideTitle)&&Ext.apply(r,{header:!r.hideTitle});var e=["id","pid","text"];for(var t in e){var n=e[t];Ext.Array.contains(r.fields,n)||r.fields.push(n)}Ext.apply(r,{store:new Ext.data.TreeStore({fields:r.fields,clearOnLoad:r.clearOnLoad,autoLoad:r.loadOnShow,idProperty:r.pkField,proxy:{actionMethods:{read:"POST"},type:"ajax",url:r.url}})}),r.tools=[{type:"collapse",tooltip:"全部展开",listeners:{click:function(){r.expandAll()}}},{type:"expand",tooltip:"全部折叠",listeners:{click:function(){r.collapseAll()}}},{type:"refresh",tooltip:"刷新",handler:function(){r.reloadExpand()}}],r.listeners={itemdblclick:function(e,t,n,o,l){Ext.apply(r,{currNode:t}),null!=r.onDblClick&&r.onDblClick(t,l)},itemclick:function(e,t,n,o,l,i){Ext.apply(r,{currNode:t}),null!=r.onClick&&r.onClick(t)},itemcontextmenu:function(e,t,n,o,l){Ext.apply(r,{currNode:t}),null!=r.onContextMenuClick&&(rsFlag=r.onContextMenuClick(t,l)),null!=r.onCtxClick&&r.onCtxClick(t,l)},checkchange:function(e,t){r.setChecked(e,t);r.afterChecked()},selectionchange:function(e,t,n){}};var o=[];if(0<r.actionButtons.length&&o.push({xtype:"toolbar",items:r.actionButtons}),r.searchFiled){var l;if("ins_gridtree"!=r.xtype&&"ins_crudgridtree"!=r.xtype)r.hideHeaders=!0,r.columns=[{xtype:"treecolumn",flex:1,dataIndex:"text",scope:r,renderer:function(e){var t=this.searchField.getValue();return 0<t.length?this.strMarkRedPlus(t,e):e}}];else for(t=0;t<r.columns.length;t++)"text"==r.columns[t].dataIndex&&Ext.apply(r.columns[t],{xtype:"treecolumn",dataIndex:"text",scope:r,renderer:function(e){var t=this.searchField.getValue();return 0<t.length?this.strMarkRedPlus(t,e):e}});o.push({xtype:"textfield",dock:"top",emptyText:r.searchFieldText,enableKeyEvents:!0,triggers:{clear:{cls:"x-form-clear-trigger",handler:"onClearTriggerClick",hidden:!0,scope:"this"},search:{cls:"x-form-search-trigger",weight:1,handler:"onSearchTriggerClick",scope:"this"}},onClearTriggerClick:function(){this.setValue(),r.store.clearFilter(),this.getTrigger("clear").hide()},onSearchTriggerClick:function(){r.filterStore(this.getValue())},listeners:{keyup:{fn:function(e,t,n){var o=e.getValue();o&&o!==l&&(e.getTrigger("clear")[0<o.length?"show":"hide"](),r.filterStore(o),l=o)},buffer:200},render:function(e){this.searchField=e},scope:r}})}0<o.length&&Ext.apply(r,{dockedItems:o}),this.callParent(arguments)},getCurrentNode:function(){return this.currNode},getSelectedView:function(){var e=this.getSelectionModel().getSelection(),t="[";for(var n in e){t+='"'+e[n].data[this.pkField]+'",'}return t=t.substring(0,t.length-1),"]"==(t+="]")&&(t="[]"),{count:e.length,idSer:t,idArr:Ext.JSON.decode(t),records:e}},getCheckedView:function(){var e=this.getView().getChecked(),t="[";for(var n in e){t+='"'+e[n].data[this.pkField]+'",'}return t=t.substring(0,t.length-1),"]"==(t+="]")&&(t="[]"),{count:e.length,idSer:t,idArr:Ext.JSON.decode(t),records:e}},load:function(e){var t=this;t.setDisabled(!1),null!=e&&null!=e&&(t.loadParams=e,t.getStore().proxy.extraParams=t.loadParams),t.store.reload()},reloadExpand:function(){var t=this;t.NODE_EXPAND_STATE=[],t.getRootNode().cascadeBy(function(e){1==e.data.expanded&&t.NODE_EXPAND_STATE.push(e.getPath())}),t.store.reload({callback:function(){var e;for(e=0;e<t.NODE_EXPAND_STATE.length;e++)t.expandPath(t.NODE_EXPAND_STATE[e])}})},clearChecked:function(){this.getRootNode().cascadeBy(function(e){e.set("checked",!1)})},clearSelect:function(){0<this.getStore().getTotalCount()&&this.getSelectionModel().selectAll(),this.getSelectionModel().deselectAll()},setChecked:function(e,t){var n=this;(n.checkedAsParent&&t||n.noCheckedAsParent&&!t)&&n.setParentNodeChecked(e,t),e.set("checked",t),(n.checkedAsChild&&t||n.noCheckedAsChild&&!t)&&e.cascadeBy(function(e){e.set("checked",t)})},setParentNodeChecked:function(e,t){var n=e.parentNode;if(n){for(var o=n.childNodes,l=!1,i=0;i<o.length;i++){if(o[i].get("checked")){l=!0;break}}l?e.parentNode.set("checked",!0):e.parentNode.set("checked",!1),this.setParentNodeChecked(n)}},filterStore:function(e){var i,t=this.store,n=e.toLowerCase(),r=function(e){var t,n=e.childNodes,o=n&&n.length,l=i.test(e.get("text"));if(l)for(t=0;t<o;t++)n[t].set("visible",!0);else for(t=0;t<o&&!(l=n[t].isLeaf()?n[t].get("visible"):r(n[t]));t++);return l};n.length<1?t.clearFilter():(i=new RegExp(n,"i"),t.getFilters().replaceAll({filterFn:r}))},strMarkRedPlus:function(e,t){return t.replace(new RegExp("("+e+")","gi"),"<span style='color: red;'><b>$1</b></span>")}}),Ext.define("Ins.tree.CrudTree",{extend:"Ins.tree.Tree",config:{urlConfig:{},dataSet:[],formFields:[],permission:{add:!0,update:!0,remove:!0,view:!0},defaultFormFieldWidth:230,customMenu:[],onBeforeShowAddForm:null,onBeforeShowEditForm:null,onBeforeShowViewForm:null,onAfterShowAddForm:null,onAfterShowEditForm:null,onAfterShowViewForm:null,onBeforeDelete:null,onBeforeSaveAdd:null,onBeforeSaveEdit:null,onBeforeShowCxtMenu:null,onAfterShowCxtMenu:null,onAfterDelete:null,onAfterFormSubmit:null,columnSize:2,labelConfig:{add:{text:null,iconCls:null},update:{text:null,iconCls:null},view:{text:null,iconCls:null},remove:{text:null,iconCls:null}},formWindowHeight:null,formWindowWidth:510,formWindowMaxHeight:null,formWindowMaxWidth:null,formWindowModal:!1},initComponent:function(){var o=this,e=[];for(var t in o.dataSet){var n=o.dataSet[t];e.push(n.name)}Ext.apply(o,{fields:e});var l=[];for(var t in o.formFields){var i=null;if(null!=(d=o.formFields[t]).forData&&null!=d.forData||null!=d.name&&null!=d.name)null!=(i=o.getFieldDefByName(Ext.clone(d)))&&null==i.width&&"component"!=i.xtype&&"container"!=i.xtype&&"panel"!=i.xtype&&"ins_panel"!=i.xtype&&"ins_fieldcontainer"!=i.xtype&&Ext.apply(i,{width:o.defaultFormFieldWidth});else if(null!=d.items&&null!=d.items)for(var r in(i=Ext.clone(d)).items=[],d.items)null!=d.items[r]&&null==d.items[r].width&&"component"!=d.items[r].xtype&&"container"!=d.items[r].xtype&&"panel"!=d.items[r].xtype&&"ins_panel"!=d.items[r].xtype&&"ins_fieldcontainer"!=d.items[r].xtype&&Ext.apply(d.items[r],{width:o.defaultFormFieldWidth}),i.items.push(o.getFieldDefByName(Ext.clone(d.items[r])));l.push(i)}var a={fields:l,modal:o.formWindowModal,defaultFormFieldWidth:o.defaultFormFieldWidth,columnSize:o.columnSize,onBeforeHide:function(e){e.getForm().reset()}};null!=o.onAfterFormSubmit&&(a.onAfterSubmit=o.onAfterFormSubmit),null!=o.formWindowHeight&&(a.height=o.formWindowHeight),null!=o.formWindowWidth&&(a.width=o.formWindowWidth),null!=o.formWindowMaxHeight&&(a.maxHeight=o.formWindowMaxHeight),null!=o.formWindowMaxWidth&&(a.maxWidth=o.formWindowMaxWidth);var s=Ext.create("Ins.form.OprFormWindow",a);Ext.apply(o,{form:s,url:o.urlConfig.loadAll});var u=[];if(null!=o.urlConfig.add&&null!=o.urlConfig.add&&o.permission.add&&u.push({id:o.getId()+"_add_btn",text:null!=o.labelConfig.add.text?o.labelConfig.add.text:"添加",iconCls:null!=o.labelConfig.add.iconCls?o.labelConfig.add.iconCls:"icon-add",handler:function(e){var t=!0;null!=o.onBeforeShowAddForm&&(t=o.onBeforeShowAddForm(o.getForm())),t&&(s.showAsAddMode({url:o.urlConfig.add,onBeforeSave:o.onBeforeSaveAdd,success:function(e){o.reloadExpand()}}),null!=o.onAfterShowAddForm&&o.onAfterShowAddForm(o.getForm()))}}),null!=o.urlConfig.update&&null!=o.urlConfig.update&&null!=o.urlConfig.load&&null!=o.urlConfig.load&&o.permission.update&&u.push({id:o.getId()+"_edit_btn",iconCls:null!=o.labelConfig.update.iconCls?o.labelConfig.update.iconCls:"icon-edit",text:null!=o.labelConfig.update.text?o.labelConfig.update.text:"编辑",handler:function(){var e=!0;if(null!=o.onBeforeShowEditForm&&null!=o.onBeforeShowEditForm&&(e=o.onBeforeShowEditForm(o.getForm())),e){var t={};t[o.pkField]=o.getCurrentNode().data[o.pkField],s.showAsEditMode({loadUrl:o.urlConfig.load+"?nolog=y",updateUrl:o.urlConfig.update,onBeforeSave:o.onBeforeSaveEdit,params:t,success:function(e){o.reloadExpand()},onSuccess:function(e,t){null!=o.onAfterShowEditForm&&o.onAfterShowEditForm(e,t)}})}}}),null!=o.urlConfig.remove&&null!=o.urlConfig.remove&&o.permission.remove&&u.push({id:o.getId()+"_delete_btn",text:null!=o.labelConfig.remove.text?o.labelConfig.remove.text:"删除",iconCls:null!=o.labelConfig.remove.iconCls?o.labelConfig.remove.iconCls:"icon-delete",handler:function(e){var t=!0;if(null!=o.onBeforeDelete&&null!=o.onBeforeDelete&&(t=o.onBeforeDelete(o.getSelectedView())),t){var n=o.getCurrentNode().data[o.pkField];Messager.send({confirm:"确认要删除该节点吗？",maskCmp:o,url:o.urlConfig.remove,data:{id:n},onSuccess:function(e){o.reloadExpand(),null!=o.onAfterDelete&&o.onAfterDelete(),TopMessage.info("操作成功！")}})}}}),null!=o.urlConfig.load&&null!=o.urlConfig.load&&o.permission.view&&u.push({id:o.getId()+"_view_btn",iconCls:null!=o.labelConfig.view.iconCls?o.labelConfig.view.iconCls:"icon-view",text:null!=o.labelConfig.view.text?o.labelConfig.view.text:"查看明细",handler:function(){var e=!0;if(null!=o.onBeforeShowViewForm&&null!=o.onBeforeShowViewForm&&(e=o.onBeforeShowViewForm(o.getForm())),e){var t={};t[o.pkField]=o.getCurrentNode().data[o.pkField],s.showAsViewMode({loadUrl:o.urlConfig.load,params:t,onSuccess:function(e,t){null!=o.onAfterShowViewForm&&o.onAfterShowViewForm(e,t)}})}}}),null!=o.customMenu&&0<o.customMenu.length)for(var t in 0<u.length&&u.push("-"),o.customMenu){var d=o.customMenu[t];u.push(d)}if(0<u.length){var c=new Ins.menu.Menu({items:u});Ext.apply(o,{contextMenu:c,onCtxClick:function(e,t){t.preventDefault?t.preventDefault():t.returnValue=!1;var n=!0;null!=o.onBeforeShowCxtMenu&&(n=o.onBeforeShowCxtMenu(c)),n&&0<u.length&&(o.contextMenu.showAt(t.getXY()),null!=o.onAfterShowCxtMenu&&o.onAfterShowCxtMenu(c))}})}o.addListener("beforedestroy",function(){null==o.form&&null==o.form||Ext.destroy(o.form),null==o.contextMenu&&null==o.contextMenu||Ext.destroy(o.contextMenu)}),o.callParent(arguments)},getFieldDefByName:function(e){for(var t in this.dataSet){var n=this.dataSet[t];if(n.name==e.forData)return Ext.apply(e,{fieldLabel:n.text,text:n.text,name:n.name}),e}if(null!=e.name&&null!=e.name)return Ext.apply(e,{fieldLabel:e.text,text:e.text}),e;window.console&&console.error("没有发现 dataSet 中配置的该表单字段。")},getForm:function(){return this.form.getForm()}}),Ext.define("Ins.tree.GridTree",{extend:"Ins.tree.Tree",alias:"widget.ins_gridtree",config:{gridColumns:null,hideTableHead:!1,treeAt:"text",defaultColumnWidth:120,disabledColumnsSortable:!1},animate:!1,rowLines:!0,columnLines:!0,width:"100%",multiSelect:!1,viewConfig:{stripeRows:!0,enableTextSelection:!0},initComponent:function(){var e=this;if(Ext.apply(e,{hideHeaders:e.hideTableHead}),null!=e.gridColumns)for(var t in e.gridColumns){var n=e.gridColumns[t];null!=n.dataIndex&&Ext.applyIf(n,{width:e.defaultColumnWidth}),null!=n.dataIndex&&null==n.sortable&&Ext.apply(n,{sortable:!e.disabledColumnsSortable}),n.dataIndex==e.treeAt&&Ext.applyIf(n,{xtype:"treecolumn"})}Ext.apply(e,{columns:e.gridColumns}),e.callParent(arguments)}}),Ext.define("Ins.tree.CrudGridTree",{extend:"Ins.tree.Tree",alias:"widget.ins_crudgridtree",config:{urlConfig:{},dataSet:[],formFields:[],permission:{add:!0,update:!0,remove:!0,view:!0},defaultFormFieldWidth:230,customMenu:[],onBeforeShowAddForm:null,onBeforeShowEditForm:null,onBeforeShowViewForm:null,onAfterShowAddForm:null,onAfterShowEditForm:null,onAfterShowViewForm:null,onBeforeDelete:null,onBeforeSaveAdd:null,onBeforeSaveEdit:null,onBeforeShowCxtMenu:null,onAfterShowCxtMenu:null,onAfterDelete:null,onAfterFormSubmit:null,columnSize:2,labelConfig:{add:{text:null,iconCls:null},update:{text:null,iconCls:null},view:{text:null,iconCls:null},remove:{text:null,iconCls:null}},gridColumns:null,hideTableHead:!1,treeAt:"text",defaultColumnWidth:120,disabledColumnsSortable:!1,formWindowHeight:null,formWindowWidth:510,formWindowMaxHeight:null,formWindowMaxWidth:null,formWindowModal:!1},animate:!1,rowLines:!0,columnLines:!0,width:"100%",multiSelect:!1,viewConfig:{stripeRows:!0,enableTextSelection:!0},initComponent:function(){var o=this;Ext.apply(o,{hideHeaders:o.hideTableHead});var e=[];for(var t in o.dataSet){var n=o.dataSet[t];e.push(n.name)}Ext.apply(o,{fields:e});var l=[];for(var t in o.gridColumns){var i=Ext.clone(o.gridColumns[t]),r=o.getColumnDefByName(i);Ext.applyIf(r,{width:o.defaultColumnWidth,sortable:!o.disabledColumnsSortable}),r.dataIndex==o.treeAt&&Ext.applyIf(r,{xtype:"treecolumn"}),l.push(r)}Ext.apply(o,{columns:l});var a=[];for(var t in o.formFields){var s=null;if(null!=(h=o.formFields[t]).forData&&null!=h.forData||null!=h.name&&null!=h.name)null!=(s=o.getFieldDefByName(Ext.clone(h)))&&null==s.width&&"component"!=s.xtype&&"container"!=s.xtype&&"panel"!=s.xtype&&"ins_panel"!=s.xtype&&"ins_fieldcontainer"!=s.xtype&&Ext.apply(s,{width:o.defaultFormFieldWidth});else if(null!=h.items&&null!=h.items)for(var u in(s=Ext.clone(h)).items=[],h.items)null!=h.items[u]&&null==h.items[u].width&&"component"!=h.items[u].xtype&&"container"!=h.items[u].xtype&&"panel"!=h.items[u].xtype&&"ins_panel"!=h.items[u].xtype&&"ins_fieldcontainer"!=h.items[u].xtype&&Ext.apply(h.items[u],{width:o.defaultFormFieldWidth}),s.items.push(o.getFieldDefByName(Ext.clone(h.items[u])));a.push(s)}var d={fields:a,modal:o.formWindowModal,defaultFormFieldWidth:o.defaultFormFieldWidth,columnSize:o.columnSize,onBeforeHide:function(e){e.getForm().reset()}};null!=o.onAfterFormSubmit&&(d.onAfterSubmit=o.onAfterFormSubmit),null!=o.formWindowHeight&&(d.height=o.formWindowHeight),null!=o.formWindowWidth&&(d.width=o.formWindowWidth),null!=o.formWindowMaxHeight&&(d.maxHeight=o.formWindowMaxHeight),null!=o.formWindowMaxWidth&&(d.maxWidth=o.formWindowMaxWidth);var c=Ext.create("Ins.form.OprFormWindow",d);Ext.apply(o,{form:c,url:o.urlConfig.loadAll});var f=[];if(null!=o.urlConfig.add&&null!=o.urlConfig.add&&f.push({id:o.getId()+"_add_btn",hidden:!o.permission.add,text:null!=o.labelConfig.add.text?o.labelConfig.add.text:"添加",iconCls:null!=o.labelConfig.add.iconCls?o.labelConfig.add.iconCls:"icon-add",handler:function(e){var t=!0;null!=o.onBeforeShowAddForm&&(t=o.onBeforeShowAddForm(o.getForm())),t&&(c.showAsAddMode({url:o.urlConfig.add,onBeforeSave:o.onBeforeSaveAdd,success:function(e){o.reloadExpand()}}),null!=o.onAfterShowAddForm&&o.onAfterShowAddForm(o.getForm()))}}),null!=o.urlConfig.update&&null!=o.urlConfig.update&&null!=o.urlConfig.load&&null!=o.urlConfig.load&&f.push({id:o.getId()+"_edit_btn",hidden:!o.permission.update,iconCls:null!=o.labelConfig.update.iconCls?o.labelConfig.update.iconCls:"icon-edit",text:null!=o.labelConfig.update.text?o.labelConfig.update.text:"编辑",handler:function(){var e=!0;if(null!=o.onBeforeShowEditForm&&null!=o.onBeforeShowEditForm&&(e=o.onBeforeShowEditForm(o.getForm())),e){var t={};t[o.pkField]=o.getCurrentNode().data[o.pkField],c.showAsEditMode({loadUrl:o.urlConfig.load+"?nolog=y",updateUrl:o.urlConfig.update,onBeforeSave:o.onBeforeSaveEdit,params:t,success:function(e){o.reloadExpand()},onSuccess:function(e,t){null!=o.onAfterShowEditForm&&o.onAfterShowEditForm(e,t)}})}}}),null!=o.urlConfig.remove&&null!=o.urlConfig.remove&&f.push({id:o.getId()+"_delete_btn",hidden:!o.permission.remove,text:null!=o.labelConfig.remove.text?o.labelConfig.remove.text:"删除",iconCls:null!=o.labelConfig.remove.iconCls?o.labelConfig.remove.iconCls:"icon-delete",handler:function(e){var t=!0;if(null!=o.onBeforeDelete&&null!=o.onBeforeDelete&&(t=o.onBeforeDelete(o.getSelectedView())),t){var n=o.getCurrentNode().data[o.pkField];Messager.send({confirm:"确认要删除该节点吗？",maskCmp:o,url:o.urlConfig.remove,data:{id:n},onSuccess:function(e){o.reloadExpand(),null!=o.onAfterDelete&&o.onAfterDelete(),TopMessage.info("操作成功！")}})}}}),null!=o.urlConfig.load&&null!=o.urlConfig.load&&f.push({id:o.getId()+"_view_btn",hidden:!o.permission.view,iconCls:null!=o.labelConfig.view.iconCls?o.labelConfig.view.iconCls:"icon-view",text:null!=o.labelConfig.view.text?o.labelConfig.view.text:"查看明细",handler:function(){var e=!0;if(null!=o.onBeforeShowViewForm&&null!=o.onBeforeShowViewForm&&(e=o.onBeforeShowViewForm(o.getForm())),e){var t={};t[o.pkField]=o.getCurrentNode().data[o.pkField],c.showAsViewMode({loadUrl:o.urlConfig.load,params:t,onSuccess:function(e,t){null!=o.onAfterShowViewForm&&o.onAfterShowViewForm(e,t)}})}}}),null!=o.customMenu&&0<o.customMenu.length)for(var t in 0<f.length&&f.push("-"),o.customMenu){var h=o.customMenu[t];f.push(h)}if(0<f.length){var m=new Ins.menu.Menu({items:f});Ext.apply(o,{contextMenu:m,onCtxClick:function(e,t){t.preventDefault?t.preventDefault():t.returnValue=!1;var n=!0;null!=o.onBeforeShowCxtMenu&&(n=o.onBeforeShowCxtMenu(m)),n&&0<f.length&&(o.contextMenu.showAt(t.getXY()),null!=o.onAfterShowCxtMenu&&o.onAfterShowCxtMenu(m))}})}o.addListener("beforedestroy",function(){null==o.form&&null==o.form||Ext.destroy(o.form),null==o.contextMenu&&null==o.contextMenu||Ext.destroy(o.contextMenu)}),o.callParent(arguments)},getColumnDefByName:function(e){var t=null;for(var n in"string"==typeof e?t={forData:e}:"object"==typeof e&&(t=e),this.dataSet){var o=this.dataSet[n];if(o.name==t.forData){Ext.apply(t,{text:o.text,dataIndex:o.name});break}}return t},getFieldDefByName:function(e){for(var t in this.dataSet){var n=this.dataSet[t];if(n.name==e.forData)return Ext.apply(e,{fieldLabel:n.text,text:n.text,name:n.name}),e}if(null!=e.name&&null!=e.name)return Ext.apply(e,{fieldLabel:e.text,text:e.text}),e;window.console&&console.error("没有发现 dataSet 中配置的该表单字段。")},getForm:function(){return this.form.getForm()}}),Ext.define("Ins.tree.ChooserTree",{extend:"Ins.tree.Tree",alias:"widget.ins_choosertree",config:{onChooserSelect:null,onBeforeChooserSelect:null,onChooserCancel:null,isSearch:!1,showDefaultActBut:!0},initComponent:function(){var o=this;o.searchFiled=o.isSearch,o.hideTitle=!0,o.showDefaultActBut&&(o.actionButtons.unshift({text:"取消",iconCls:"icon-delete",handler:function(e){null!=o.onChooserCancel&&o.onChooserCancel()}}),o.actionButtons.unshift({text:"确定选择",iconCls:"icon-ok",handler:function(e){var t=o.getSelectedView();if(0!=t.count){var n=!0;null!=o.onBeforeChooserSelect&&null!=o.onBeforeChooserSelect&&(n=o.onBeforeChooserSelect(t.records[0])),n&&null!=o.onChooserSelect&&o.onChooserSelect(t.records[0])}else TopMessage.warn("请选择记录")}})),o.callParent(arguments)}});var FormToolkit={REQUIRED_TPL:'<span style="color:red;font-weight:bold" data-qtip="必输项">*</span>',config:{text:null,onFieldFocus:null,onFieldBlur:null,onFieldChange:null,msgTarget:"side"},init:function(e){null!=e.text&&Ext.apply(e,{fieldLabel:e.text}),null==e.allowBlank||e.allowBlank||Ext.apply(e,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL}),null!=e.onFieldFocus&&e.addListener("focus",e.onFieldFocus),null!=e.onFieldBlur&&e.addListener("blur",e.onFieldBlur),null!=e.onFieldChange&&e.addListener("change",e.onFieldChange)},setFormFieldsReadonly:function(e,t){e.getForm().getFields().each(function(e){try{"ins_htmleditor"!=e.xtype&&(e.setReadOnly(t),1==t?e.setFieldStyle({backgroundColor:"#EBEBEB"}):e.setFieldStyle({backgroundColor:"#FFF"}))}catch(e){}})}};Ext.define("Ins.form.field.TextField",{extend:"Ext.form.field.Text",alias:["widget.ins_textfield"],config:FormToolkit.config,maxLength:32,initComponent:function(){FormToolkit.init(this),0==this.allowBlank&&(this.allowOnlyWhitespace=!1),this.callParent(arguments)}}),Ext.define("Ins.form.field.PasswordField",{extend:"Ins.form.field.TextField",alias:["widget.ins_passwordfield"],inputType:"password"}),Ext.define("Ins.form.field.HiddenField",{extend:"Ext.form.field.Hidden",alias:["widget.ins_hiddenfield"],config:{onFieldChange:null},initComponent:function(){null!=this.onFieldChange&&this.addListener("change",this.onFieldChange),this.callParent(arguments)}}),Ext.define("Ins.form.field.NumberField",{extend:"Ext.form.field.Number",alias:["widget.ins_numberfield"],config:FormToolkit.config,decimalPrecision:12,maxLength:32,minValue:0,maxValue:999999999999,initComponent:function(){FormToolkit.init(this),this.callParent(arguments)}}),Ext.define("Ins.form.field.List",{extend:"Ext.form.field.ComboBox",alias:["widget.ins_list"],config:FormToolkit.config,constructor:function(e){Ext.apply(this,{list:[],fields:["text","value"]}),this.callParent([e])},editable:!1,displayField:"text",valueField:"value",queryMode:"local",initComponent:function(){var e=this;FormToolkit.init(e),null!=e.list&&0<e.list.length&&(e.store={fields:e.fields,data:e.list}),this.callParent(arguments)},getList:function(){return this.list},getTextByValue:function(e){for(var t in this.list){var n=this.list[t];if(n.value==e)return n.text}return null},getValueByText:function(e){for(var t in this.list){var n=this.list[t];if(n.text==e)return n.value}return null}}),Ext.define("Ins.form.field.DynamicList",{extend:"Ins.form.field.List",alias:["widget.ins_dynamiclist"],config:{url:null,params:{}},initComponent:function(){var e=this;null!=e.url&&Ext.apply(e,{store:e.buildStore(e.url,e.params)}),this.callParent(arguments)},getList:function(){var t=[];return this.getStore().each(function(e){t.push({text:e.get("text"),value:e.get("value")})}),t},buildStore:function(e,t){return new Ins.data.Store({fields:this.fields,url:e,params:t})},load:function(e){null!=e&&null!=e&&(this.getStore().proxy.extraParams=e),this.getStore().reload()}}),Ext.define("Ins.form.field.TagList",{extend:"Ext.form.field.Tag",alias:["widget.ins_taglist"],config:FormToolkit.config,constructor:function(e){Ext.apply(this,{url:null,list:[],fields:["text","value"]}),this.callParent([e])},displayField:"text",valueField:"value",initComponent:function(){var s=this;null!=s.url&&Ext.apply(s,{store:s.buildStore(s.url,s.params)}),Ext.apply(s,{listeners:{change:function(e,t,n,o){if(null!=t.length&&0<t.length){for(var l=[],i=0;i<t.length;i++){for(var r=!1,a=0;a<l.length;a++)if(l[a]==t[i]){r=!0;break}r||l.push(t[i])}s.setValue(l)}}}}),FormToolkit.init(this),this.callParent(arguments)},getList:function(){var t=[];return this.getStore().each(function(e){t.push({text:e.get("text"),value:e.get("value")})}),t},buildStore:function(e,t){return new Ins.data.Store({fields:this.fields,url:e,params:t})},load:function(e){null!=e&&null!=e&&(this.getStore().proxy.extraParams=e),this.getStore().load()}}),Ext.define("Ins.form.field.DateField",{extend:"Ext.form.field.Date",alias:["widget.ins_datefield"],config:FormToolkit.config,format:"Y-m-d",initComponent:function(){FormToolkit.init(this),this.callParent(arguments)},getStringValue:function(){return this.getRawValue()}}),Ext.define("Ins.form.field.DateTimeField",{extend:"Ext.form.field.Picker",alias:["widget.ins_datetimefield"],config:FormToolkit.config,initComponent:function(){FormToolkit.init(this),this.callParent()},format:"yyyy-MM-dd HH:mm:ss",triggerCls:Ext.baseCSSPrefix+"form-date-trigger",matchFieldWidth:!1,getErrors:function(e){var t=this.callParent([e]);return 0<t.length?t:(svalue=e,e=Ext.Date.parse(e,"Y-m-d H:i:s",!0),""!=svalue&&null==e?(t.push(svalue+" 是无效的日期时间格式 - 必须符合格式：Y-m-d H:i:s"),t):void 0)},createPicker:function(){var e=this,t="d_"+(new Date).getTime();Ext.apply(e,{dateId:t});var n=new Date;return e.form=Ext.widget({xtype:"form",layout:"vbox",items:[{xtype:"datepicker",colspan:5,id:t},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"hour",width:55,minValue:0,maxValue:23,allowBlank:!1,value:n.getHours()},{xtype:"ins_displayfield",value:":"},{xtype:"numberfield",name:"min",minValue:0,maxValue:59,width:55,allowBlank:!1,value:n.getMinutes()},{xtype:"ins_displayfield",value:":"},{xtype:"numberfield",name:"seconds",minValue:0,maxValue:59,width:55,allowBlank:!1,value:0}]}],buttons:[{text:"选择",iconCls:"icon-ok",handler:function(){e.onSelect()}}]}),Ext.create("Ext.panel.Panel",{border:!0,floating:!0,items:[e.form],onMouseDown:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}})},onSelect:function(e,t){var n=this;if(n.form.isValid()){var o=Ext.getCmp(n.dateId).getValue(),l=n.form.getForm(),i=o.getFullYear(),r=o.getMonth()+1,a=(o=o.getDate(),l.findField("hour").getValue()),s=l.findField("min").getValue(),u=l.findField("seconds").getValue();r<10&&(r="0"+r),o<10&&(o="0"+o),a<10&&(a="0"+a),s<10&&(s="0"+s),u<10&&(u="0"+u);var d=n.format.replace("yyyy",i).replace("MM",r).replace("dd",o).replace("HH",a).replace("mm",s).replace("ss",u);n.setValue(d),n.collapse()}},onExpand:function(){},onBlur:function(e){this.callParent([e])}}),Ext.define("Ins.form.field.TextAreaField",{extend:"Ext.form.field.TextArea",alias:["widget.ins_textareafield"],config:FormToolkit.config,maxLength:256,initComponent:function(){FormToolkit.init(this),0==this.allowBlank&&(this.allowOnlyWhitespace=!1),this.callParent(arguments)}}),Ext.define("Ins.form.field.FileField",{extend:"Ext.form.field.File",alias:["widget.ins_filefield"],config:FormToolkit.config,buttonText:"请选择...",initComponent:function(){FormToolkit.init(this),this.callParent(arguments)}}),Ext.define("Ins.form.field.DisplayField",{extend:"Ext.form.field.Display",alias:["widget.ins_displayfield"],config:FormToolkit.config,initComponent:function(){FormToolkit.init(this),this.callParent(arguments)}}),Ext.define("Ins.form.FieldContainer",{extend:"Ext.form.FieldContainer",alias:["widget.ins_fieldcontainer"],config:{text:null},layout:"hbox",defaults:{},defaultType:"ins_textfield",initComponent:function(){var e=this;null!=e.text&&(Ext.apply(e,{fieldLabel:e.text}),null==e.allowBlank||e.allowBlank||Ext.apply(e,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL})),this.callParent(arguments)}}),Ext.define("Ins.form.FieldSet",{extend:"Ext.form.FieldSet",alias:["widget.ins_fieldset"],config:{text:null,columnSize:2,defaultFormFieldWidth:230},margin:"2 2 2 2",collapsible:!0,padding:"5 5 10 5",defaultType:"ins_textfield",initComponent:function(){Ext.apply(this,{title:"<span style='font-weight:bold;'>"+this.text+"</span>",layout:{type:"table",columns:this.columnSize},defaults:{width:this.defaultFormFieldWidth}}),this.callParent(arguments)}}),Ext.define("Ins.form.field.RaidoField",{extend:"Ext.form.RadioGroup",alias:["widget.ins_radiofield"],config:{text:null,name:null,columnSize:2,boxs:[],onFieldChange:null},msgTarget:"side",initComponent:function(){var e=this,t=[];null==e.allowBlank||e.allowBlank||Ext.apply(e,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL});for(var n=0;n<e.boxs.length;n++)null!=e.boxs[n].checked&&null!=e.boxs[n].checked||(e.boxs[n].checked=!1),null!=e.value&&null!=e.value&&""!=e.value&&(e.value==e.boxs[n].value&&(e.boxs[n].checked=!0),e.initRadioValue=e.value),t.push({boxLabel:e.boxs[n].text,name:e.name,inputValue:e.boxs[n].value,checked:e.boxs[n].checked,hidden:e.boxs[n].hidden,disabled:e.boxs[n].disabled});Ext.apply(e,{columns:e.columnSize,fieldLabel:e.text,items:t}),null!=e.onFieldChange&&e.addListener("change",e.onFieldChange),this.callParent(arguments)},setValue:function(value){var me=this;eval("value={"+me.name+":value};"),me.callParent([value])},getValue:function(){return this.callParent()[this.name]},reset:function(){this.setValue(this.initRadioValue)}}),Ext.define("Ins.form.field.CheckboxField",{extend:"Ext.form.CheckboxGroup",alias:["widget.ins_checkboxfield"],config:{text:null,name:null,columnSize:2,boxs:[],onFieldChange:null},blankText:"该输入项为必输项",msgTarget:"side",initComponent:function(){var e=this;null==e.allowBlank||e.allowBlank||Ext.apply(e,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL});for(var t=[],n=0;n<e.boxs.length;n++){if(null!=e.boxs[n].checked&&null!=e.boxs[n].checked||(e.boxs[n].checked=!1),null!=e.value&&null!=e.value&&""!=e.value){for(var o in e.value)if(e.value[o]==e.boxs[n].value){e.boxs[n].checked=!0;break}e.initRadioValue=e.value}t.push({boxLabel:e.boxs[n].text,name:e.name,inputValue:e.boxs[n].value,checked:e.boxs[n].checked,hidden:e.boxs[n].hidden,disabled:e.boxs[n].disabled})}Ext.apply(e,{columns:e.columnSize,fieldLabel:e.text,items:t}),null!=e.onFieldChange&&e.addListener("change",e.onFieldChange),this.callParent(arguments)},setValue:function(value){var me=this;eval("value={"+me.name+":value};"),me.callParent([value])},getValue:function(){return this.callParent()[this.name]},reset:function(){this.setValue(this.initRadioValue)}}),Ext.define("Ins.form.field.SliderField",{extend:"Ext.slider.Single",alias:["widget.ins_sliderfield"],config:{text:null,onFieldDrag:null,onFieldChange:null},width:270,minValue:0,maxValue:100,value:0,hideLabel:!1,useTips:!0,initComponent:function(){var e=this;null!=e.text&&Ext.apply(e,{fieldLabel:e.text}),null!=e.onFieldDrag&&e.addListener("drag",e.onFieldDrag),null!=e.onFieldChange&&e.addListener("change",e.onFieldChange),this.callParent(arguments)}}),Ext.define("Ins.form.field.HtmlEditor",{extend:"Ext.form.FieldContainer",mixins:["Ext.form.field.Field"],alias:["widget.ins_htmleditor"],config:FormToolkit.config,ueditorInstance:null,initialized:!1,initComponent:function(){var t=this;null!=t.text&&Ext.apply(t,{fieldLabel:t.text}),null==t.allowBlank||t.allowBlank||Ext.apply(t,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL});var n=(null==t.id||null==t.id?"":t.id)+"-ueditor-"+(new Date).getTime();t.html='<script id="'+n+'" type="text/plain" name="'+t.name+'"><\/script>',t.callParent(arguments),t.initField(),t.on("render",function(){var e={elementPathEnabled:!1,wordCount:!1,autoFloatEnabled:!0,autoHeightEnabled:!1,enableContextMenu:!1,enableAutoSave:!1,initialFrameWidth:"100%",initialFrameHeight:t.ueheight,pasteplain:!1,toolbars:[["fontsize","bold","underline","italic","forecolor","backcolor","|","blockquote","insertorderedlist","insertunorderedlist","justifyleft","justifycenter","justifyright","|","link","insertimage","insertvideo","preview"]]};t.ueditorInstance=UE.getEditor(n,e),t.ueditorInstance.ready(function(){t.initialized=!0,null!=t._value&&null!=t._value&&""!=t._value&&t.setValue(t._value),null!=t.onFieldFocus&&t.ueditorInstance.addListener("focus",function(){t.onFieldFocus(t)}),t.ueditorInstance.addListener("blur",function(){t.isValid(),null!=t.onFieldBlur&&t.onFieldBlur(t)}),t.ueditorInstance.addListener("contentChange",function(){t.isValid(),null!=t.onFieldChange&&t.onFieldChange(t)})})})},getValue:function(){var e="";return this.initialized&&(e=this.ueditorInstance.getContent()),this.value=e},setValue:function(e){return null==e&&(e=""),this.initialized?this.ueditorInstance.setContent(e):this._value=e,this},setReadOnly:function(e){e?this.ueditorInstance.setDisabled():this.ueditorInstance.setEnabled()},isValid:function(){var e=this;if(0==e.allowBlank){if(""==e.getValue()||null==e.getValue()||null==e.getValue())return $("#"+e.getId()+"-innerCt iframe").css({border:"1px solid red"}),!1;$("#"+e.getId()+"-innerCt iframe").css({border:""})}return!0},reset:function(){this.setValue(""),$("#"+this.getId()+"-innerCt iframe").css({border:""})}}),Ext.define("Ins.form.Form",{extend:"Ext.form.Panel",alias:["widget.ins_form"],config:{fields:[],columnSize:2,defaultFormFieldWidth:230,actionButtons:[],textWidth:100,textAlign:"top",textStyle:""},defaultType:"ins_textfield",bodyPadding:6,scrollable:!0,extraValues:{},initComponent:function(){var e=this;if(0<e.fields.length)for(var t in e.fields){var n=e.fields[t];null!=n&&null==n.width&&"component"!=n.xtype&&"container"!=n.xtype&&"panel"!=n.xtype&&"ins_panel"!=n.xtype&&("ins_fieldset"!=n.xtype?Ext.apply(n,{width:e.defaultFormFieldWidth}):Ext.apply(n,{width:"100%"}))}0<e.actionButtons.length&&Ext.apply(e,{buttons:e.actionButtons}),Ext.apply(e,{items:e.fields,layout:{type:"table",columns:e.columnSize},defaults:{},fieldDefaults:{labelAlign:e.textAlign,margin:"2 5 2 2",labelStyle:e.textStyle}}),this.callParent(arguments)},getField:function(e){return this.getForm().findField(e)},getValue:function(e){var t=this.getForm().findField(e);return null==t||null==t?this.extraValues[e]:"ins_datefield"==t.xtype?t.getRawValue():t.getValue()},getValues:function(){var e=this.getForm().getValues();return Ext.applyIf(e,this.extraValues),e},setExtraValues:function(e){Ext.applyIf(this.extraValues,e)},setValue:function(e,t){this.getField(e).setValue(t)},valid:function(e){this.getForm().isValid()?null!=e.onSuccess&&null!=e.onSuccess&&e.onSuccess(this):null!=e.onError&&null!=e.onError&&e.onError(this)},loadData:function(n){var o=this;o.getForm().load({url:n.url,waitMsg:"正在加载数据，请稍后...",params:n.params,failure:function(e,t){o.getForm().reset()},success:function(e,t){null!=n.onSuccess&&null!=n.onSuccess&&n.onSuccess(o,t)}})},send:function(t){var n=this;n.valid({onSuccess:function(e){null!=t.confirm&&null!=t.confirm?Message.ask(t.confirm,function(e){e&&n.sendBase(t)}):n.sendBase(t)},onError:function(e){null!=t.onValidError&&null!=t.onValidError&&t.onValidError(e)}})},sendBase:function(n){var e=null==n.maskText||null==n.maskText?"正在执行，请稍后...":n.maskText;this.submit({url:n.url,waitMsg:e,success:function(e,t){null!=n.onSuccess&&n.onSuccess(t.result)},failure:function(e,t){try{return App.errorHandler(t.response)}catch(e){return TopMessage.error("操作失败或系统错误"),!1}}})},hideFields:function(e){if(null!=e&&0<e.length)for(var t in e){var n=e[t];this.getField(n).hide()}},showFields:function(e){if(null!=e&&0<e.length)for(var t in e){var n=e[t];this.getField(n).show()}},reset:function(e){this.extraValues={};var t=this.getForm().getFields().items;for(var n in t){var o=t[n],l=o.xtype;(null!=e&&null!=e||"ins_hiddenfield"!=l)&&o.reset()}}}),Ext.define("Ins.form.OprFormWindow",{extend:"Ins.window.Window",alias:"widget.ins_oprformwindow",config:{fields:[],url:null,success:null,mode:null,defaultFormFieldWidth:230,onBeforeSave:null,onAfterClickResetButton:null,columnSize:2,onBeforeShow:null,onBeforeHide:null,autoMessage:!0,onAfterSubmit:null},modal:!1,maximizable:!0,initComponent:function(){var t=this,n=Ext.create("Ins.form.Form",{xtype:"ins_form",columnSize:t.columnSize,defaultFormFieldWidth:t.defaultFormFieldWidth,fields:t.fields});t.form=n,Ext.apply(t,{views:[n],dockedItems:[{id:"toolbar_"+t.getId(),xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{id:"resetBtn_"+t.getId(),text:"重置",iconCls:"icon-clear",handler:function(){n.reset(),null!=t.onAfterClickResetButton&&t.onAfterClickResetButton(n)}},{text:"保存",id:"saveBtn_"+t.getId(),iconCls:"icon-ok",handler:function(){if(n.getForm().isValid()){var e=!0;if(null!=t.onBeforeSave&&null!=t.onBeforeSave&&(e=t.onBeforeSave(t.getForm())),!e)return;t.oprRecord(n)}}}]}],listeners:{beforehide:function(){return null==t.onBeforeHide||null==t.onBeforeHide||t.onBeforeHide(t.getForm())},close:function(){t.getForm().reset()},beforeshow:function(){return null==t.onBeforeShow||null==t.onBeforeShow||t.onBeforeShow(t.getForm())}}}),t.callParent(arguments)},showAsAddMode:function(e){var t=this;if(App.getCom("resetBtn_"+t.getId()).setHidden(!1),!t.isHidden())return TopMessage.warn("请先完成当前操作，或先关闭此窗体再进行其它操作！"),!1;t.setTitle(null!=e.title&&null!=e.title?e.title:"添加"),App.getCom("toolbar_"+t.getId()).setVisible(!0),FormToolkit.setFormFieldsReadonly(t.getForm(),!1),t.mode="ADD",t.url=e.url,t.success=e.success,t.onBeforeSave=e.onBeforeSave,t.onBeforeHide=e.onBeforeHide,t.onBeforeShow=e.onBeforeShow,t.show(),t.alignToCenter()},showAsEditMode:function(n){var o=this;if(App.getCom("resetBtn_"+o.getId()).setHidden(!0),!o.isHidden())return TopMessage.warn("请先完成当前操作，或先关闭此窗体再进行其它操作！"),!1;o.setTitle(null!=n.title&&null!=n.title?n.title:"编辑"),App.getCom("toolbar_"+o.getId()).setVisible(!0),FormToolkit.setFormFieldsReadonly(o.getForm(),!1),o.mode="EDIT",o.url=n.updateUrl,o.success=n.success,o.onBeforeSave=n.onBeforeSave,o.onBeforeHide=n.onBeforeHide,o.onBeforeShow=n.onBeforeShow,o.getForm().loadData({url:n.loadUrl,params:n.params,onSuccess:function(e,t){o.show(),o.alignToCenter(),null!=n.onSuccess&&n.onSuccess(e,t)}})},showAsViewMode:function(n){var o=this;if(!o.isHidden())return TopMessage.warn("请先完成当前操作，或先关闭此窗体再进行其它操作！"),!1;o.setTitle(null!=n.title&&null!=n.title?n.title:"查看明细"),App.getCom("toolbar_"+o.getId()).setVisible(!1),o.mode="VIEW",FormToolkit.setFormFieldsReadonly(o.getForm(),!0),o.onBeforeHide=n.onBeforeHide,o.onBeforeShow=n.onBeforeShow,o.getForm().loadData({url:n.loadUrl,params:n.params,onSuccess:function(e,t){o.show(),o.alignToCenter(),null!=n.onSuccess&&n.onSuccess(e,t)}})},getForm:function(){return this.form},getField:function(e){return this.getForm().getField(e)},setValue:function(e,t){this.getForm().setValue(e,t)},getValue:function(e){this.getForm().getValue(e)},oprRecord:function(t){var o=this;Message.ask("确定要执行该操作吗？",function(e){e&&t.submit({url:o.url,waitMsg:"正在执行，请稍后...",success:function(e,t){var n=!0;if(null!=o.onAfterSubmit&&(n=o.onAfterSubmit(e,t)),n){o.getForm().reset();try{o.getForm().setValue("id","")}catch(e){throw new Error("不存在id字段")}o.hide(),o.autoMessage&&TopMessage.info("操作成功！"),null!=o.success&&o.success()}},failure:function(e,t){try{return App.errorHandler(t.response)}catch(e){return TopMessage.error("操作失败或系统错误"),!1}}})})}}),Ext.define("Ins.grid.Grid",{extend:"Ext.grid.Panel",config:{url:null,fields:[],gridColumns:[],pkField:"id",loadOnShow:!0,hideTitle:!1,hideTableHead:!1,hidePagingBar:!1,actionButtons:[],actionButtonsSort:[],checkable:!0,defaultColumnWidth:120,autoColunmWidth:!1,valueMapper:null,selectMode:"MULTI",selectCheckOnly:!1,exportToExcel:!1,pageSize:30,customPage:[10,20,30,50,100],onBeforeSearch:null,editable:!1,editType:"row",disabledColumnsSortable:!1,onLoadComplete:null,onRowClick:null,onRowDbClick:null,onContextMenuClick:null,onRowSelect:null,onRowDeSelect:null,onRowSelectChange:null,hideRowNumber:!0,rowNumberText:"编号",rowNumberWidth:50,showActionColumn:!0,actionColumnMenu:[],actionColumnClick:null,actionColumnLocked:!0,acrossSelect:!1,model:"server",localData:[],condition:{},onConditionShow:null,_childdActionButtons:[],showSelCheck:null},loadMask:!0,columnLines:!0,invalidateScrollerOnRefresh:!1,enableLocking:!1,disableSelection:!1,resizable:!1,viewConfig:{stripeRows:!0,enableTextSelection:!0},initComponent:function(){var u=this;if(u.acrossSelect&&Ext.apply(u,{acrossSelection:new Ext.util.HashMap}),Ext.apply(u,{title:null==u.title||null==u.title?"未命名表格":u.title}),Ext.apply(u,{forceFit:u.autoColunmWidth}),u.hidePagingBar&&(u.pageSize=1e3),null==u.store||null==u.store){var e=null;"server"===u.model?e=new Ins.data.Store({remoteSort:!0,fields:u.fields,url:u.url,idProperty:u.pkField,pageSize:u.pageSize,autoLoad:u.loadOnShow,listeners:{beforeload:function(e,t,n){},load:function(e,t,n,o){null!=u.onLoadComplete&&u.onLoadComplete(u.getStore()),u.acrossSelect&&u.getSelectionModel().select(u.acrossSelection.getValues(),!0)}}}):"local"===u.model&&(e=Ext.create("Ins.data.Store",{fields:u.fields,data:u.localData,idProperty:u.pkField,pageSize:u.pageSize,autoLoad:u.loadOnShow})),Ext.apply(u,{store:e})}if(Ext.apply(u,{header:!u.hideTitle,hideHeaders:u.hideTableHead}),u.editable){var t=null;"row"===u.editType?t=Ext.create("Ext.grid.plugin.RowEditing",{clicksToMoveEditor:1,autoCancel:!1}):"cell"===u.editType&&(t=new Ext.grid.plugin.CellEditing({clicksToEdit:1})),Ext.apply(u,{plugins:[t]})}var n={itemclick:function(e,t,n,o,l,i){u.currentRecord=t,null!=u.onRowClick&&u.onRowClick(t,o,l)},itemdblclick:function(e,t,n,o,l,i){u.currentRecord=t,null!=u.onRowDbClick&&u.onRowDbClick(t,o,l)},itemcontextmenu:function(e,t,n,o,l,i){u.currentRecord=t,null!=u.onContextMenuClick&&(l.preventDefault?l.preventDefault():l.returnValue=!1,u.onContextMenuClick(t,o,l))},select:function(e,t,n,o){(u.currentRecord=t,null!=u.onRowSelect&&u.onRowSelect(t,n),u.acrossSelect&&(u.acrossSelection.containsKey(t.data[u.pkField])||u.acrossSelection.add(t.data[u.pkField],t)),null!=u.showSelCheck)&&(u.showSelCheck(t,n)||u.getSelectionModel().deselect(t))},deselect:function(e,t,n,o){u.currentRecord=t,null!=u.onRowDeSelect&&u.onRowDeSelect(t,n),u.acrossSelect&&u.acrossSelection.containsKey(t.data[u.pkField])&&u.acrossSelection.removeAtKey(t.data[u.pkField])},selectionchange:function(e,t,n){null!=u.onRowSelectChange&&u.onRowSelectChange(t)}};Ext.apply(u,{listeners:n}),u.acrossSelect&&(u.selectCheckOnly=!0),u.checkable&&Ext.apply(u,{selModel:{selType:"checkboxmodel",checkOnly:u.selectCheckOnly,mode:u.selectMode,renderer:function(e,t,n,o,l,i,r){t.tdStyle="vertical-align:middle;";var a=!0;return null!=u.showSelCheck&&(a=u.showSelCheck(n,o)),a?'<div class="'+Ext.baseCSSPrefix+'grid-row-checker"> </div>':""}}});var o=[];if(u.hideRowNumber||o.push({xtype:"rownumberer",dataIndex:"ROWNUMBER_COL",text:u.rowNumberText,width:u.rowNumberWidth,locked:!0}),0<u.actionColumnMenu.length){u.quickMenu=Ext.create("Ins.menu.Menu",{id:u.getId()+"_action_menu",items:u.actionColumnMenu});var l=[{iconCls:"icon-list2",tooltip:"操作列表，点击以查看更多操作。",handler:function(e,t,n,o,l){var i=e.getStore().getAt(t);u.fireEvent("itemclick",e,i,null,t,l,null),u.currentRecord=i;var r=!0;null!=u.actionColumnClick&&(r=u.actionColumnClick(i)),r&&u.quickMenu.showAt(l.getXY())}}];u.showActionColumn&&o.push({dataIndex:"OPRATE_COL",text:"操作",align:"center",menuDisabled:!0,sortable:!1,xtype:"actioncolumn",hideable:!1,locked:u.actionColumnLocked,resizable:!1,width:50,items:l,renderer:function(e,t,n,o,l,i,r){return t.tdStyle="vertical-align:middle;",e}})}for(var i in u.gridColumns){var r=Ext.clone(u.gridColumns[i]);if(null!=r.columns&&null!=r.columns&&0<r.columns.length)for(var a=0;a<r.columns.length;a++)u._setColumn(r.columns[a]);else u._setColumn(r);o.push(r)}Ext.apply(u,{columns:o});var s=[];if(0<u._childdActionButtons.length)for(var i in u._childdActionButtons)s.push(u._childdActionButtons[i]);if(null!=u.condition.fields&&null!=u.condition.fields&&0<u.condition.fields.length){Ext.applyIf(u.condition,{columnSize:2,defaultFieldWidth:200});var d=u.getId()+"_query_btn",c=Ext.create("Ins.form.Form",{xtype:"ins_form",title:"查询条件（清空可查看全部记录）",columnSize:u.condition.columnSize,textAlign:"top",textStyle:"font-weight:bold",defaultFormFieldWidth:u.condition.defaultFieldWidth,fields:u.condition.fields,tools:[{type:"close",tooltip:"单击关闭查询条件。",handler:function(){App.getCom(u.getId()+"_query_btn_menu").hide()}}],actionButtons:[{text:"清空",iconCls:"icon-clear",handler:function(){c.reset(!0)}},{text:"查询",iconCls:"icon-ok",handler:function(){var e=!0;if(null!=u.onBeforeSearch&&null!=u.onBeforeSearch&&(e=u.onBeforeSearch(c)),0!=e){var t=0;for(var n in u.condition.fields){var o=u.condition.fields[n];if("ins_hiddenfield"!=o.xtype){var l=c.getField(o.name).getValue();null!=l&&""!=l&&t++}}var i=null!=u.condition.buttonText&&null!=u.condition.buttonText?u.condition.buttonText:"查询";0<t&&(i+="&nbsp;<span style='color:blue;font-weight:bold;'>&nbsp;(+"+t+")</span>"),Ext.getCmp(d).setText(i),App.getCom(u.getId()+"_query_btn_menu").hide(),u.search(c.getForm().getValues())}}}]});Ext.apply(u,{conditionForm:c}),s.push({id:d,iconCls:"icon-search",text:null!=u.condition.buttonText&&null!=u.condition.buttonText?u.condition.buttonText:"查询",menu:new Ins.menu.Menu({id:u.getId()+"_query_btn_menu",items:[c]}),listeners:{menushow:function(){null!=u.onConditionShow&&u.onConditionShow(u.getConditionForm())}}})}u.exportToExcel&&s.push({id:u.getId()+"_export_btn",iconCls:"icon-export",text:"导出",handler:function(){for(var e=u,t=e.columns,n=e.gridColumns,o=Ext.JSON.encode(n),l="[",i=0;i<t.length;i++)"OPRATE_COL"!=t[i].dataIndex&&(l+='{"text":"'+t[i].text+'","dataIndex":"'+t[i].dataIndex+'","width":"'+t[i].cellWidth+'"}',t.length-1!=i&&(l+=","));l+="]";var r=e.url,a=new Object;if(null!=u.condition.fields&&null!=u.condition.fields&&0<u.condition.fields.length){var s=u.getConditionForm().getForm().getValues();null!=s&&null!=s&&(a=Ext.clone(s))}null!=u.loadParams&&null!=u.loadParams&&Ext.applyIf(a,u.loadParams),a.gridColumns=o,a.columnsJson=l,a.gridUrl=r,a.total=e.getStore().totalCount,Messager.send({url:CTX_PATH+"/insexport/excel",data:a,confirm:"确认要导出查询到的所有数据吗？",maskCmp:e,maskText:"正在导出数据，请稍后...",onSuccess:function(e){e.success?(window.location.href=e.fileInfo.baseUrl,TopMessage.info("导出成功")):TopMessage.info("导出失败")}})}});for(i=0;i<u.actionButtons.length;i++)s.push(u.actionButtons[i]);if(0<s.length&&"-"==s[s.length-1]&&s.pop(),0<u.actionButtonsSort.length){var f=[];for(var i in u.actionButtonsSort)if("|"!=u.actionButtonsSort[i])for(var a in s){var h=s[a].text;null!=h&&null!=h&&""!=h||(h=s[a].html),h==u.actionButtonsSort[i]&&(f.push(s[a]),delete s[a])}else f.push("-");for(var i in s)"-"!=s[i]&&"|"!=s[i]&&f.push(s[i]);s=Ext.clone(f)}u.actionButtons=s;var m=[];if(0<u.actionButtons.length){var p={id:u.getId()+"_toolbar",xtype:"toolbar",items:u.actionButtons,dock:"top"};Ext.apply(u,{actionToolbar:p}),m.push(p)}if(!u.hidePagingBar){var g=[],x=!1,C=[];for(var i in u.customPage){u.pageSize==u.customPage[i]&&(x=!0);var v={text:u.customPage[i],value:u.customPage[i]};C.push(v),x&&(g=["-","每页 ",{xtype:"ins_list",width:58,list:C,value:u.pageSize,onFieldChange:function(e,t,n,o){u.getStore().pageSize=t,u.getStore().load({page:1,start:0})}},"条"])}if(!x)return void(window.console&&console.error("pageSize 必须等于 customPage中的配置项！"));m.push({xtype:"pagingtoolbar",dock:"bottom",xtype:"pagingtoolbar",displayInfo:!0,store:u.store,displayMsg:"共 {2} 条",emptyMsg:"无数据",beforePageText:"第",afterPageText:"页，共 {0} 页",items:g})}Ext.apply(u,{dockedItems:m}),u.addListener("beforedestroy",function(){null==u.conditionForm&&null==u.conditionForm||Ext.destroy(u.conditionForm),null==u.quickMenu&&null==u.quickMenu||Ext.destroy(u.quickMenu)}),u.callParent(arguments)},_setColumn:function(e){var t=this;for(var n in null!=e.dataIndex&&null==e.sortable&&Ext.apply(e,{sortable:!t.disabledColumnsSortable}),null!=e.width||t.autoColunmWidth||Ext.apply(e,{width:t.defaultColumnWidth}),t.valueMapper){t.valueMapper[n];if(e.dataIndex==n){Ext.apply(e,{renderer:t.valueMapper[n]});break}}null!=e.renderer&&null!=e.renderer||"checkcolumn"!=e.xtype&&Ext.apply(e,{renderer:function(e,t){return t.tdStyle="vertical-align:middle;",Ext.util.Format.htmlEncode(e)}})},load:function(e){var t=this;t.setDisabled(!1),null!=e&&null!=e&&(t.loadParams=e,t.getStore().proxy.extraParams=t.loadParams),t.getStore().reload()},search:function(e){var t=this;if(t.setDisabled(!1),null!=e&&null!=e){var n=Ext.clone(e);null!=t.loadParams&&null!=t.loadParams&&Ext.applyIf(n,t.loadParams),t.getStore().proxy.extraParams=n}t.getStore().currentPage=1,t.getStore().reload({page:1,start:0})},searchByCondition:function(){this.search(this.getConditionForm().getForm().getValues())},getCurrentRecord:function(){return this.currentRecord},getSelectedView:function(){var e=this,t=null;t=e.acrossSelect?e.acrossSelection.getValues():e.getSelectionModel().getSelection();var n=e.getIdSer(t,e.pkField);return{count:t.length,idSer:n,idArr:Ext.JSON.decode(n),records:t}},getIdSer:function(e,t){var n="[";for(var o in e){n+='"'+e[o].data[t]+'",'}return n=n.substring(0,n.length-1),"]"==(n+="]")&&(n="[]"),n},select:function(e){var t=[];for(var n in e){var o=e[n],l=this.getStore().findRecordById(this.pkField,o);null!=l&&t.push(l)}this.getSelectionModel().select(t)},selectAcrossSelect:function(e){for(var t in e){var n=e[t];this.acrossSelection.add(n.data[this.pkField],n)}this.getSelectionModel().select(this.acrossSelection.getValues(),!0)},clearSelect:function(){var e=this;e.acrossSelect&&e.acrossSelection.clear(),0<e.getStore().getTotle()&&e.getSelectionModel().selectAll(),e.getSelectionModel().deselectAll()},selectCurrentPageRecords:function(){this.getSelectionModel().selectAll()},getConditionForm:function(){return this.conditionForm},setToolbarDisabled:function(e){this.actionToolbar.setDisabled(e)}}),Ext.define("Ins.grid.CrudGrid",{extend:"Ins.grid.Grid",config:{urlConfig:{},dataSet:[],formFields:[],permission:{add:!0,update:!0,remove:!0,view:!0},gridColumns:[],condition:[],conditionColumnSize:2,conditionWidth:200,columnSize:2,defaultFormFieldWidth:230,defaultCondFieldWidth:200,onBeforeSearch:null,onBeforeShowAddForm:null,onBeforeShowEditForm:null,onBeforeShowViewForm:null,onAfterShowAddForm:null,onAfterShowEditForm:null,onAfterShowViewForm:null,onAfterDelete:null,onBeforeDelete:null,onBeforeSaveAdd:null,onBeforeSaveEdit:null,onAfterFormSubmit:null,formWindowHeight:null,formWindowWidth:510,formWindowMaxHeight:null,formWindowMaxWidth:null,formWindowModal:!1,labelConfig:{add:{text:null,iconCls:null},update:{text:null,iconCls:null},view:{text:null,iconCls:null},remove:{text:null,iconCls:null},query:{text:null,iconCls:null}}},initComponent:function(){var o=this,e=[];for(var t in o.dataSet){var n=o.dataSet[t];e.push(n.name)}Ext.apply(o,{fields:e});var l=[];for(var t in o.gridColumns){var i=Ext.clone(o.gridColumns[t]),r=null;if(null!=i.columns&&null!=i.columns&&0<i.columns.length){(r=Ext.clone(i)).columns=[];for(var a=0;a<i.columns.length;a++)r.columns.push(o.getColumnDefByName(i.columns[a]))}else r=o.getColumnDefByName(i);l.push(r)}Ext.apply(o,{gridColumns:l});var s=[];for(var t in o.formFields){var u=null;if(null!=(p=o.formFields[t]).forData&&null!=p.forData||null!=p.name&&null!=p.name)null!=(u=o.getFieldDefByName(Ext.clone(p)))&&null==u.width&&"component"!=u.xtype&&"container"!=u.xtype&&"panel"!=u.xtype&&"ins_panel"!=u.xtype&&"ins_fieldcontainer"!=u.xtype&&Ext.apply(u,{width:o.defaultFormFieldWidth});else if(null!=p.items&&null!=p.items)for(var a in(u=Ext.clone(p)).items=[],p.items)null!=p.items[a]&&null==p.items[a].width&&"component"!=p.items[a].xtype&&"container"!=p.items[a].xtype&&"panel"!=p.items[a].xtype&&"ins_panel"!=p.items[a].xtype&&"ins_fieldcontainer"!=p.items[a].xtype&&Ext.apply(p.items[a],{width:o.defaultFormFieldWidth}),u.items.push(o.getFieldDefByName(Ext.clone(p.items[a])));s.push(u)}var d={fields:s,modal:o.formWindowModal,defaultFormFieldWidth:o.defaultFormFieldWidth,columnSize:o.columnSize,onBeforeHide:function(e){e.getForm().reset()}};null!=o.onAfterFormSubmit&&(d.onAfterSubmit=o.onAfterFormSubmit),null!=o.formWindowHeight&&(d.height=o.formWindowHeight),null!=o.formWindowWidth&&(d.width=o.formWindowWidth),null!=o.formWindowMaxHeight&&(d.maxHeight=o.formWindowMaxHeight),null!=o.formWindowMaxWidth&&(d.maxWidth=o.formWindowMaxWidth);var c=Ext.create("Ins.form.OprFormWindow",d);Ext.apply(o,{form:c,url:o.urlConfig.loadAll}),null!=o.urlConfig.add&&null!=o.urlConfig.add&&o.permission.add&&o._childdActionButtons.push({id:o.getId()+"_add_btn",text:null!=o.labelConfig.add.text?o.labelConfig.add.text:"添加",iconCls:null!=o.labelConfig.add.iconCls?o.labelConfig.add.iconCls:"icon-add",handler:function(e){var t=!0;null!=o.onBeforeShowAddForm&&(t=o.onBeforeShowAddForm(o.getForm())),t&&(c.showAsAddMode({url:o.urlConfig.add,onBeforeSave:o.onBeforeSaveAdd,success:function(e){o.load()}}),null!=o.onAfterShowAddForm&&o.onAfterShowAddForm(o.getForm()))}}),null!=o.urlConfig.remove&&null!=o.urlConfig.remove&&o.permission.remove&&o._childdActionButtons.push({id:o.getId()+"_delete_btn",text:null!=o.labelConfig.remove.text?o.labelConfig.remove.text:"删除",iconCls:null!=o.labelConfig.remove.iconCls?o.labelConfig.remove.iconCls:"icon-delete",handler:function(e){var t=o.getSelectedView();if(0!=t.count){var n=!0;null!=o.onBeforeDelete&&null!=o.onBeforeDelete&&(n=o.onBeforeDelete(o.getSelectedView())),n&&Messager.send({confirm:"确认要删除选定的这 <span style='font-size:25px;color:red'>"+t.count+"</span> 条记录吗？",maskCmp:o,url:o.urlConfig.remove,data:{SELECT_ITEMS:t.idSer},onSuccess:function(e){o.load(),null!=o.onAfterDelete&&o.onAfterDelete(),TopMessage.info("操作成功！")}})}else Message.msg("请至少选择一条需要删除记录！","WARN")}});var f=o.actionColumnMenu.length;(o.permission.update&&null!=o.urlConfig.update&&null!=o.urlConfig.update&&null!=o.urlConfig.load&&null!=o.urlConfig.load||o.permission.view&&null!=o.urlConfig.load&&null!=o.urlConfig.load)&&0<f&&o.actionColumnMenu.unshift("-"),null!=o.urlConfig.load&&null!=o.urlConfig.load&&o.permission.view&&o.actionColumnMenu.unshift({id:o.getId()+"_view_btn",iconCls:null!=o.labelConfig.view.iconCls?o.labelConfig.view.iconCls:"icon-view",text:null!=o.labelConfig.view.text?o.labelConfig.view.text:"查看明细",handler:function(){o.viewCurrentDataForm()}}),null!=o.urlConfig.update&&null!=o.urlConfig.update&&null!=o.urlConfig.load&&null!=o.urlConfig.load&&o.permission.update&&o.actionColumnMenu.unshift({id:o.getId()+"_edit_btn",iconCls:null!=o.labelConfig.update.iconCls?o.labelConfig.update.iconCls:"icon-edit",text:null!=o.labelConfig.update.text?o.labelConfig.update.text:"编辑记录",handler:function(){var e=!0;if(null!=o.onBeforeShowEditForm&&null!=o.onBeforeShowEditForm&&(e=o.onBeforeShowEditForm(o.getForm())),e){var t={};t[o.pkField]=o.getCurrentRecord().data[o.pkField],c.showAsEditMode({loadUrl:o.urlConfig.load+"?nolog=y",updateUrl:o.urlConfig.update,onBeforeSave:o.onBeforeSaveEdit,params:t,success:function(e){o.load()},onSuccess:function(e,t){null!=o.onAfterShowEditForm&&o.onAfterShowEditForm(e,t)}})}}});var h={};if(0<o.condition.length){h.columnSize=o.conditionColumnSize,h.defaultFieldWidth=o.conditionWidth,h.onBeforeSearch=o.onBeforeSearch;var m=[];for(var t in o.condition){var p,g=null;"string"==typeof(p=o.condition[t])?g=o.getConditionField(p):"object"==typeof p&&(g=p),m.push(g),h.fields=m}Ext.apply(o.condition,h)}o.addListener("beforedestroy",function(){null==o.form&&null==o.form||Ext.destroy(o.form)}),o.callParent(arguments)},getFieldDefByName:function(e){for(var t in this.dataSet){var n=this.dataSet[t];if(n.name==e.forData)return Ext.apply(e,{fieldLabel:n.text,text:n.text,name:n.name}),e}if(null!=e.name&&null!=e.name)return Ext.apply(e,{fieldLabel:e.text,text:e.text}),e;window.console&&console.error("没有发现 dataSet 中配置的该表单字段。")},getColumnDefByName:function(e){var t=null;for(var n in"string"==typeof e?t={forData:e}:"object"==typeof e&&(t=e),this.dataSet){var o=this.dataSet[n];if(o.name==t.forData){Ext.apply(t,{text:o.text,dataIndex:o.name});break}}return t},getConditionField:function(e){var t=this,n=null,o=!1;for(var l in t.formFields){if(null!=t.formFields[l].items){for(var i in t.formFields[l].items)if(t.formFields[l].items[i].forData==e){(n=Ext.clone(t.formFields[l].items[i])).colspan=1,n.width=t.conditionWidth,o=!0;break}}else{var r=t.formFields[l];r.forData==e&&((n=Ext.clone(r)).colspan=1,n.width=t.conditionWidth,o=!0)}if(o)break}return Ext.apply(n,{name:e,allowBlank:!0,afterLabelTextTpl:"",suffixText:null}),t.getFieldDefByName(n)},getForm:function(){return this.form.getForm()},viewCurrentDataForm:function(){var n=this,e=!0;if(null!=n.onBeforeShowViewForm&&null!=n.onBeforeShowViewForm&&(e=n.onBeforeShowViewForm(n.getForm())),e){var t={};t[n.pkField]=n.getCurrentRecord().data[n.pkField],n.form.showAsViewMode({loadUrl:n.urlConfig.load,params:t,onSuccess:function(e,t){null!=n.onAfterShowViewForm&&n.onAfterShowViewForm(e,t)}})}}}),Ext.define("Ins.grid.ChooserGrid",{extend:"Ins.grid.Grid",alias:"widget.ins_choosergrid",config:{onChooserSelect:null,onBeforeChooserSelect:null,onChooserCancel:null,isAskWindow:!0},selectMode:"MULTI",initComponent:function(){var o=this;o._childdActionButtons=[{text:"确定选择",iconCls:"icon-ok",handler:function(e){var t=o.getSelectedView();if(0!=t.count){var n=!0;null!=o.onBeforeChooserSelect&&null!=o.onBeforeChooserSelect&&(n=o.onBeforeChooserSelect()),n&&(o.isAskWindow?Message.ask("确定要添加所选的 <span style='font-size:25px;color:red'>"+t.count+"</span> 条记录吗？",function(e){e&&null!=o.onChooserSelect&&o.onChooserSelect(t)}):null!=o.onChooserSelect&&o.onChooserSelect(t))}else TopMessage.warn("请至少选择一条记录")}},{text:"取消",iconCls:"icon-delete",handler:function(e){null!=o.onChooserCancel&&o.onChooserCancel()}}],"MULTI"==o.selectMode?o._childdActionButtons.push("-",{iconCls:"icon-clear",text:"清空选择",handler:function(){o.clearSelect()}}):"SINGLE"==o.selectMode&&(o.onRowClick=function(e){var t=!0;if(null!=o.onBeforeChooserSelect&&null!=o.onBeforeChooserSelect&&(t=o.onBeforeChooserSelect()),t){var n=o.getSelectedView();null!=o.onChooserSelect&&o.onChooserSelect(n)}}),Ext.apply(o,{hideTitle:!0,hideRowNumber:!0,checkable:"MULTI"==o.selectMode,acrossSelect:"MULTI"==o.selectMode}),o.callParent(arguments)}}),Ext.define("Ins.chooser.ChooserGirdWindow",{extend:"Ins.window.Window",alias:"widget.ins_choosergridwindow",config:{onSelect:null,onBeforeSelect:null,beforeShowClear:!0,selectMode:"MULTI",url:null,fields:null,pkField:"id",hidePagingBar:!1,pageSize:20,gridColumns:null,loadOnShow:!0,actionButtons:[],actionButtonsSort:[],valueMapper:null,condition:{}},width:595,height:380,title:"未命名选择器",modal:!0,initComponent:function(){var t=this,e=Ext.create("Ins.grid.ChooserGrid",{url:t.url,fields:t.fields,pkField:t.pkField,pageSize:t.pageSize,gridColumns:t.gridColumns,loadOnShow:t.loadOnShow,actionButtons:t.actionButtons,actionButtonsSort:t.actionButtonsSort,condition:t.condition,hidePagingBar:t.hidePagingBar,selectMode:t.selectMode,valueMapper:t.valueMapper,onChooserCancel:function(){t.hide()},onBeforeChooserSelect:t.onBeforeSelect,onChooserSelect:function(e){null!=t.onSelect&&t.onSelect(e),t.hide()}});Ext.apply(t,{grid:e,views:[e]}),t.onBeforeShow=function(){t.beforeShowClear&&t.grid.clearSelect(),t.grid.load()},t.actionButtons=[],t.callParent(arguments)},getGrid:function(){return this.grid}}),Ext.define("Ins.chooser.ChooserGirdField",{extend:"Ext.form.field.Picker",alias:["widget.ins_choosergridfield"],config:FormToolkit.config,initComponent:function(){FormToolkit.init(this),this.callParent()},editable:!1,constructor:function(e){var t=this;Ext.apply(t,{onSelect:null,onBeforeSelect:null,chooserWidth:null==t.chooserWidth||null==t.chooserWidth?595:t.chooserWidth,chooserHeight:null==t.chooserHeight||null==t.chooserHeight?330:t.chooserHeight,selectMode:null==t.selectMode||null==t.selectMode?"SINGLE":"MULTI",url:null,fields:null,pkField:"id",hidePagingBar:null!=t.isHidePagingBar&&null!=t.isHidePagingBar&&t.isHidePagingBar,gridColumns:null,valueMapper:null,loadOnShow:!0,actionButtons:[],actionButtonsSort:[],condition:{}}),t.callParent([e]),Ext.apply(t,{grid:Ext.create("Ins.grid.ChooserGrid",{url:t.url,fields:t.fields,pkField:t.pkField,hidePagingBar:t.hidePagingBar,gridColumns:t.gridColumns,loadOnShow:t.loadOnShow,actionButtons:t.actionButtons,actionButtonsSort:t.actionButtonsSort,condition:t.condition,valueMapper:t.valueMapper,selectMode:t.selectMode,isAskWindow:!1,onChooserCancel:function(){t.collapse()},onBeforeChooserSelect:t.onBeforeSelect,onChooserSelect:function(e){null!=t.onSelect&&t.onSelect(e),t.collapse()}})})},triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",matchFieldWidth:!1,grid:null,createPicker:function(){return Ext.create("Ext.panel.Panel",{border:!0,floating:!0,width:this.chooserWidth,height:this.chooserHeight,layout:"fit",shadow:!0,maxHeight:350,items:[this.grid]})},onExpand:function(){this.grid.clearSelect(),this.grid.load()},onBlur:function(e){this.callParent([e])}}),Ext.define("Ins.chooser.ChooserTreeField",{extend:"Ext.form.field.Picker",alias:["widget.ins_choosertreefield"],config:FormToolkit.config,initComponent:function(){FormToolkit.init(this),this.callParent()},editable:!1,constructor:function(e){var t=this;Ext.apply(t,{onSelect:null,onBeforeSelect:null,width:null==t.chooserWidth||null==t.chooserWidth?250:t.chooserWidth,url:null,isSearch:null==t.isSearch||null==t.isSearch||t.isSearch}),t.callParent([e]);var n={clearOnLoad:!0,loadOnShow:!0,showDefaultActBut:!0,afterChecked:null,checkedAsParent:!0,noCheckedAsParent:!0,checkedAsChild:!0,noCheckedAsChild:!0};for(key in Ext.apply(t,n),n)null!=e[key]&&null!=e[key]&&(t[key]=e[key]);var o=t.onFocusLeave;t.onFocusLeave=function(e){$(e.target).hasClass("x-tree-checkbox")||o.call(this,e)},t.tree=Ext.create("Ins.tree.ChooserTree",{isSearch:t.isSearch,url:t.url,clearOnLoad:t.clearOnLoad,loadOnShow:t.loadOnShow,checkedAsParent:t.checkedAsParent,noCheckedAsParent:t.noCheckedAsParent,checkedAsChild:t.checkedAsChild,noCheckedAsChild:t.noCheckedAsChild,afterChecked:function(){t.afterChecked(t.tree.getChecked())},showDefaultActBut:t.showDefaultActBut,onChooserCancel:function(){t.collapse()},onBeforeChooserSelect:t.onBeforeSelect,onChooserSelect:function(e){null!=t.onSelect&&t.onSelect(e),t.collapse()}})},triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",matchFieldWidth:!1,createPicker:function(){return Ext.create("Ext.panel.Panel",{border:!0,floating:!0,width:this.chooserWidth,height:this.chooserHeight,layout:"fit",maxHeight:450,minHeight:250,shadow:!0,items:[this.tree]})},onExpand:function(){this.tree.reloadExpand()},onBlur:function(e){this.callParent([e])}}),Ext.define("Ins.chooser.ChooserGridButton",{extend:"Ext.button.Button",alias:"widget.ins_choosergridbutton",config:{onSelect:null,onBeforeSelect:null,beforeShowClear:!0,selectMode:"MULTI",gridUrl:null,fields:null,pkField:"id",hidePagingBar:!1,pageSize:20,gridColumns:null,loadOnShow:!0,actionButtons:[],actionButtonsSort:[],valueMapper:null,condition:{},chooserWidth:595,chooserHeight:380,onBeforeShowChooser:null},initComponent:function(){var t=this;null!=t.text&&null!=t.text&&""!=t.text||(t.text="未命名选择器"),null!=t.iconCls&&null!=t.iconCls&&""!=t.iconCls||(t.iconCls="icon-pageadd");var e=Ext.create("Ins.grid.ChooserGrid",{isAskWindow:!1,width:t.chooserWidth,height:t.chooserHeight,url:t.gridUrl,fields:t.fields,pkField:t.pkField,pageSize:t.pageSize,gridColumns:t.gridColumns,loadOnShow:t.loadOnShow,actionButtons:t.actionButtons,actionButtonsSort:t.actionButtonsSort,condition:t.condition,hidePagingBar:t.hidePagingBar,selectMode:t.selectMode,valueMapper:t.valueMapper,onChooserCancel:function(){t.hideMenu()},onBeforeChooserSelect:t.onBeforeSelect,onChooserSelect:function(e){null!=t.onSelect&&t.onSelect(e),t.hideMenu()}});t.grid=e,t.menu=new Ins.menu.Menu({id:t.getId()+"_chooser_menu",items:[e],listeners:{beforeshow:function(){t.beforeShowClear&&t.grid.clearSelect();var e=!1;return null!=t.onBeforeShowChooser?e=t.onBeforeShowChooser():(t.grid.load(),e=!0),e}},onMouseDown:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}}),t.addListener("menuhide",function(){t.grid.setHidden(!0)}),t.addListener("menushow",function(){t.grid.setHidden(!1)}),t.addListener("beforedestroy",function(){null==t.quickMenu&&null==t.quickMenu||Ext.destroy(t.getMenu())}),this.callParent(arguments)},getGrid:function(){return this.grid}}),Ext.define("Ins.player.Player",{extend:"Ext.Component",alias:"widget.ins_player",config:{file:null,image:null,autostart:!1,_playerWidth:"100%",_playerHeight:360,onPlayerReady:null,onPlayerVolume:null,onPlayerPlay:null,onPlayerPause:null,onPlayerComplete:null,onPlayerSeek:null,onPlayerTime:null,onPlayerFullscreen:null},initComponent:function(){var e=this,t=(null==e.id||null==e.id?"":e.id)+"_player";e.playerId=t,e.html='<div id="'+t+'"></div>',null!=e.width&&(e._playerWidth=e.width),null!=e.height&&(e._playerHeight=e.height),e.on("render",function(){e.newInstance(t)}),e.on("beforedestroy",function(){e.remove()}),e.callParent(arguments)},newInstance:function(e){var t=this;jwplayer(e).setup({flashplayer:STATIC_PATH+"/lib/jwplayer/6.12.5/bin-release/jwplayer.flash.swf",file:t.file,image:t.image,autostart:t.autostart,width:t._playerWidth,height:t._playerHeight,events:{onReady:function(){null!=t.onPlayerReady&&t.onPlayerReady()},onVolume:function(e){null!=t.onPlayerReady&&t.onPlayerReady(e.volume)},onPlay:function(){null!=t.onPlayerPlay&&t.onPlayerPlay()},onPause:function(){null!=t.onPlayerPause&&t.onPlayerPause()},onComplete:function(){null!=t.onPlayerComplete&&t.onPlayerComplete()},onSeek:function(e){null!=t.onPlayerSeek&&t.onPlayerSeek(e.position,e.offset)},onTime:function(e){null!=t.onPlayerTime&&t.onPlayerTime(e.position)},onFullscreen:function(e){null!=t.onPlayerFullscreen&&t.onPlayerFullscreen(e.fullscreen)}}})},getPlayer:function(){return jwplayer(this.playerId)},play:function(){this.getPlayer().play(!0)},pause:function(){this.getPlayer().pause(!0)},getState:function(){return this.getPlayer().getState()},stop:function(){this.getPlayer().stop()},remove:function(){this.getPlayer().remove()},load:function(e){this.getPlayer().load([{file:e}])},seek:function(e){this.getPlayer().seek(e)},getPosition:function(){return this.getPlayer().getPosition()},getMute:function(){return this.getPlayer().getMute()},setMute:function(e){this.getPlayer().setMute(e)},getVolume:function(){return this.getPlayer().getVolume()},setVolume:function(e){this.getPlayer().setVolume(e)},getHeight:function(){return this.getPlayer().getHeight()},getWidth:function(){return this.getPlayer().getWidth()},resize:function(e,t){this.getPlayer().resize(e,t)}}),Ext.define("Ins.list.CrudList",{extend:"Ins.panel.Panel",alias:"ins_crudlist",config:{urlConfig:{},dataSet:[],formFields:[],permission:{add:!0,update:!0,remove:!0,view:!0},tplImgUrl:"{icon}",tplField:"{text}",columnSize:2,defaultFormFieldWidth:230,pkField:"id",loadOnShow:!0,customMenu:[],hideTitle:!1,onRowClick:null,onBeforeShowAddForm:null,onBeforeShowEditForm:null,onBeforeShowViewForm:null,onBeforeShowCxtMenu:null,onAfterShowCxtMenu:null,onAfterShowAddForm:null,onAfterShowEditForm:null,onAfterShowViewForm:null,onBeforeDelete:null,onBeforeSaveAdd:null,onBeforeSaveEdit:null,onAfterDelete:null,onAfterFormSubmit:null,formWindowHeight:null,formWindowWidth:510,formWindowMaxHeight:null,formWindowMaxWidth:null,formWindowModal:!1,labelConfig:{add:{text:null,iconCls:null},update:{text:null,iconCls:null},view:{text:null,iconCls:null},remove:{text:null,iconCls:null},query:{text:null,iconCls:null}}},initComponent:function(){var a=this;(null!=a.getHeader()||a.hideTitle)&&Ext.apply(a,{header:!a.hideTitle});var e=[];for(var t in a.dataSet){var n=a.dataSet[t];e.push(n.name)}Ext.apply(a,{fields:e});var o=Ext.create("Ins.data.Store",{url:a.urlConfig.loadAll,fields:a.fields,idProperty:a.pkField,pageSize:1e3,autoLoad:a.loadOnShow});Ext.apply(a,{store:o});var l=[];for(var t in a.formFields){var i=null;if(null!=(c=a.formFields[t]).forData&&null!=c.forData||null!=c.name&&null!=c.name)null!=(i=a.getFieldDefByName(Ext.clone(c)))&&null==i.width&&"component"!=i.xtype&&"container"!=i.xtype&&"panel"!=i.xtype&&"ins_panel"!=i.xtype&&"ins_fieldcontainer"!=i.xtype&&Ext.apply(i,{width:a.defaultFormFieldWidth});else if(null!=c.items&&null!=c.items)for(var r in(i=Ext.clone(c)).items=[],c.items)null!=c.items[r]&&null==c.items[r].width&&"component"!=c.items[r].xtype&&"container"!=c.items[r].xtype&&"panel"!=c.items[r].xtype&&"ins_panel"!=c.items[r].xtype&&"ins_fieldcontainer"!=c.items[r].xtype&&Ext.apply(c.items[r],{width:a.defaultFormFieldWidth}),i.items.push(a.getFieldDefByName(Ext.clone(c.items[r])));l.push(i)}var s={fields:l,modal:a.formWindowModal,defaultFormFieldWidth:a.defaultFormFieldWidth,columnSize:a.columnSize,onBeforeHide:function(e){e.getForm().reset()}};null!=a.onAfterFormSubmit&&(s.onAfterSubmit=a.onAfterFormSubmit),null!=a.formWindowHeight&&(s.height=a.formWindowHeight),null!=a.formWindowWidth&&(s.width=a.formWindowWidth),null!=a.formWindowMaxHeight&&(s.maxHeight=a.formWindowMaxHeight),null!=a.formWindowMaxWidth&&(s.maxWidth=a.formWindowMaxWidth);var u=Ext.create("Ins.form.OprFormWindow",s);Ext.apply(a,{form:u,url:a.urlConfig.loadAll});var d=[];if(null!=a.urlConfig.update&&null!=a.urlConfig.update&&null!=a.urlConfig.load&&null!=a.urlConfig.load&&a.permission.update&&d.push({id:a.getId()+"_edit_btn",iconCls:null!=a.labelConfig.update.iconCls?a.labelConfig.update.iconCls:"icon-edit",text:null!=a.labelConfig.update.text?a.labelConfig.update.text:"编辑",handler:function(){var e=!0;if(null!=a.onBeforeShowEditForm&&null!=a.onBeforeShowEditForm&&(e=a.onBeforeShowEditForm(a.getForm())),e){var t={};t[a.pkField]=a.getCurrentRecord().data[a.pkField],u.showAsEditMode({loadUrl:a.urlConfig.load+"?nolog=y",updateUrl:a.urlConfig.update,onBeforeSave:a.onBeforeSaveEdit,params:t,success:function(e){a.load()},onSuccess:function(e,t){null!=a.onAfterShowEditForm&&a.onAfterShowEditForm(e,t)}})}}}),null!=a.urlConfig.remove&&null!=a.urlConfig.remove&&a.permission.remove&&d.push({id:a.getId()+"_delete_btn",text:null!=a.labelConfig.remove.text?a.labelConfig.remove.text:"删除",iconCls:null!=a.labelConfig.remove.iconCls?a.labelConfig.remove.iconCls:"icon-delete",handler:function(e){var t=!0;if(null!=a.onBeforeDelete&&null!=a.onBeforeDelete&&(t=a.onBeforeDelete(a.getCurrentRecord())),t){var n=a.getCurrentRecord().data[a.pkField];Messager.send({confirm:"确认要删除该节点吗？",maskCmp:a,url:a.urlConfig.remove,data:{id:n},onSuccess:function(e){a.load(),null!=a.onAfterDelete&&a.onAfterDelete(),TopMessage.info("操作成功！")}})}}}),null!=a.urlConfig.load&&null!=a.urlConfig.load&&a.permission.view&&d.push({id:a.getId()+"_view_btn",iconCls:null!=a.labelConfig.view.iconCls?a.labelConfig.view.iconCls:"icon-view",text:null!=a.labelConfig.view.text?a.labelConfig.view.text:"查看明细",handler:function(){var e=!0;if(null!=a.onBeforeShowViewForm&&null!=a.onBeforeShowViewForm&&(e=a.onBeforeShowViewForm(a.getForm())),e){var t={};t[a.pkField]=a.getCurrentRecord().data[a.pkField],u.showAsViewMode({loadUrl:a.urlConfig.load,params:t,onSuccess:function(e,t){null!=a.onAfterShowViewForm&&a.onAfterShowViewForm(e,t)}})}}}),null!=a.customMenu&&0<a.customMenu.length)for(var t in 0<d.length&&d.push("-"),a.customMenu){var c=a.customMenu[t];d.push(c)}if(0<d.length){var f=new Ins.menu.Menu({items:d});Ext.apply(a,{contextMenu:f})}-1==a.tplField.indexOf("{")&&(a.tplField="{"+a.tplField+"}");var h=Ext.create("Ext.view.View",{scrollable:"y",itemSelector:"div",store:a.store,tpl:'<tpl for="."><div style="background: url('+a.tplImgUrl+') no-repeat 8px 2px;margin-top: 3px;margin-bottom: 3px;padding-left: 29px;font-size: 13px;line-height: 20px;cursor: pointer;border: 1px solid #fff;">'+a.tplField+"</div></tpl>",listeners:{itemclick:function(e,t,n,o,l,i){a.currentRecord=t,null!=a.onRowClick&&a.onRowClick(t,o,l)},itemcontextmenu:function(e,t,n,o,l,i){App.utils.preventDefault(l),a.currentRecord=t;var r=!0;null!=a.onBeforeShowCxtMenu&&(r=a.onBeforeShowCxtMenu(f)),r&&0<d.length&&(a.contextMenu.showAt(l.getXY()),null!=a.onAfterShowCxtMenu&&a.onAfterShowCxtMenu(f))}}});a.dataView=h;var m=[];a.permission.add&&m.push({type:"plus",tooltip:"添加",handler:function(e,t,n){var o=!0;null!=a.onBeforeShowAddForm&&(o=a.onBeforeShowAddForm(a.getForm())),o&&(u.showAsAddMode({url:a.urlConfig.add,onBeforeSave:a.onBeforeSaveAdd,success:function(e){a.load()}}),null!=a.onAfterShowAddForm&&a.onAfterShowAddForm(a.getForm()))}}),m.push({type:"refresh",tooltip:"Refresh",handler:function(e,t,n){a.load()}}),Ext.apply(a,{views:[h],headButtons:m}),a.addListener("beforedestroy",function(){null==a.form&&null==a.form||Ext.destroy(a.form),null==a.contextMenu&&null==a.contextMenu||Ext.destroy(a.contextMenu)}),a.callParent(arguments)},getFieldDefByName:function(e){for(var t in this.dataSet){var n=this.dataSet[t];if(n.name==e.forData)return Ext.apply(e,{fieldLabel:n.text,text:n.text,name:n.name}),e}if(null!=e.name&&null!=e.name)return Ext.apply(e,{fieldLabel:e.text,text:e.text}),e;window.console&&console.error("没有发现 dataSet 中配置的该表单字段。")},getForm:function(){return this.form.getForm()},getCurrentRecord:function(){return this.currentRecord},getDataView:function(){return this.dataView},load:function(e){var t=this;t.setDisabled(!1),null!=e&&null!=e&&(t.loadParams=e,t.dataView.getStore().proxy.extraParams=t.loadParams),t.dataView.getStore().reload()}}),Ext.define("Ins.grid.GridHeaderUtil",{init:function(l){var e=l.saveGridColums;if(e&&0!=e.enabled){if(null==CURRENT_USER&&!CURRENT_USER.id)return void(window.console&&console.error("没有用户id，不能使用自定义表头功能。"));if(!e.key)return void(window.console&&console.error("saveGridColums中没有发现key值，key值是必选属性"));l._saveColumns=function(e){var n=["width","text","dataIndex","hidden","locked"],o={};Ext.Array.each(e.getGridColumns(),function(t,e){o={sortNum:e},Ext.Array.each(n,function(e){o[e]=t[e]}),t.dataIndex&&(l.INS_GRIDCOLUMSMAP[t.dataIndex]=o)})},l.sortBySortNum=function(e){return Ext.Array.sort(e,function(e,t){return e.sortNum<t.sortNum?-1:e.sortNum>t.sortNum?1:0})},Ext.Array.each(l.gridColumns,function(e,t){e.dataIndex||(e.dataIndex=e.forData),null!=e&&null!=e.columns&&0<e.columns.length&&Ext.Array.each(e.columns,function(e,t){e.dataIndex||(e.dataIndex=e.forData)})}),l.INS_GRIDCOLUMSMAP={},l.addListener("columnschanged",function(e){l._saveColumns(e)}),l.addListener("columnresize",function(e){l._saveColumns(e)});var t={text:"保存表头",iconCls:"icon-ok"};e.button&&Ext.apply(t,e.button);var n=t.handler;t.handler=function(){Messager.send({url:CTX_PATH+"/grid/header/saveGridColums",data:{userId:CURRENT_USER.id,key:e.key,columsJson:JSON.stringify(l.INS_GRIDCOLUMSMAP)},onSuccess:function(e){var t=!0;null!=n&&(t=n()),t&&TopMessage.info("表头保存成功")},onError:function(){alert("请求异常")}})},l.actionButtons||(l.actionButtons=[]),l.actionButtons.push("->",t);var o=null;if(Messager.send({url:CTX_PATH+"/grid/header/getGridColums",sync:!0,data:{userId:CURRENT_USER.id,key:e.key},onSuccess:function(e){e&&e.columsJson&&(o=JSON.parse(e.columsJson))},onError:function(){alert("获取表头失败")}}),o){var i,r=[],a=[];Ext.Array.each(l.gridColumns,function(n,e){(i=o[n.dataIndex])&&Ext.apply(n,i),null!=n&&null!=n.columns&&0<n.columns.length?(a=[],Ext.Array.each(n.columns,function(e,t){(i=o[e.dataIndex])&&Ext.apply(e,i),!0===e.locked?r.push(e):(a.push(e),n.sortNum||(n.sortNum=e.sortNum))}),n.columns=l.sortBySortNum(a),0<n.columns.length&&r.push(n)):r.push(n)}),l.gridColumns=l.sortBySortNum(r)}}}}),Ext.define("Ins.grid.GridDev",{extend:"Ins.grid.Grid",alias:["widget.ins_griddev"],initComponent:function(){App.getClass("Ins.grid.GridHeaderUtil").init(this),this.callParent(arguments)}}),Ext.define("Ins.grid.CrudGridDev",{extend:"Ins.grid.CrudGrid",alias:["widget.ins_crudgriddev"],initComponent:function(){App.getClass("Ins.grid.GridHeaderUtil").init(this),this.callParent(arguments)}});
//# sourceMappingURL=ins-component-zh_CN.min.js.map