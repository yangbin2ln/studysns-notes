var Utils={isIE:function(){return!!window.ActiveXObject},isIE8:function(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("msie")&&-1!=a.indexOf("8.0")},ltIE8:function(){var a,b="8.0",c=navigator.userAgent.toLowerCase(),d=c.indexOf("msie")>-1;return d?(a=c.match(/msie ([\d.]+)/)[1],b>=a?!0:!1):!1},htmlEncode:function(a){var b="";return 0==a.length?"":(b=a.replace(/&/g,"&#38;"),b=b.replace(/\"/g,"&#34;"),b=b.replace(/\'/g,"&#39;"),b=b.replace(/</g,"&#60;"),b=b.replace(/>/g,"&#62;"))},htmlDecode:function(a){var b="";return 0==a.length?"":(b=a.replace(/&#62;/g,">"),b=b.replace(/&#60;/g,"<"),b=b.replace(/&#39;/g,"'"),b=b.replace(/&#34;/g,'"'),b=b.replace(/&#38;/g,"&"))},apply:function(a,b){if(a&&b&&"object"==typeof b){var c;for(c in b)a[c]=b[c]}return a},applyIf:function(a,b){var c;if(a)for(c in b)void 0===a[c]&&(a[c]=b[c]);return a},clone:function(a){if(null===a||void 0===a)return a;if(a.nodeType&&a.cloneNode)return a.cloneNode(!0);var b,c,d,e=toString.call(a);if("[object Date]"===e)return new Date(a.getTime());if("[object Array]"===e)for(b=a.length,c=[];b--;)c[b]=Utils.clone(a[b]);else if("[object Object]"===e&&a.constructor===Object){c={};for(d in a)c[d]=Utils.clone(a[d])}return c||a},on:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},off:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},getEvent:function(a){return a?a:window.event},getEventTarget:function(a){return a.target||a.srcElement},getParameter:function(a){for(var b=unescape(window.location.search.substr(1)).split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(2==d.length&&d[0].toUpperCase()==a.toUpperCase())return d[1]}return null},replaceParamVal:function(paramName,replaceWith,url){var oUrl=location.href.toString();void 0!=url&&null!=url&&(oUrl=url);var nUrl=null;if(-1!=oUrl.indexOf(paramName+"=")){var re=eval("/("+paramName+"=)([^&]*)/gi");nUrl=oUrl.replace(re,paramName+"="+replaceWith)}else nUrl=oUrl,nUrl+=-1!=nUrl.indexOf("?")?"&"+paramName+"="+replaceWith:"?"+paramName+"="+replaceWith;return nUrl},require:function(a,b,c){(void 0==c||null==c)&&(c=0);var d=Utils.getExtName(a[c]);c==a.length-1?"css"===d?Utils.addCss(a[c],b):"js"===d?Utils.addScript(a[c],b):Utils.getTemplate(a[c],b):"css"===d?Utils.addCss(a[c],function(){c++,Utils.require(a,b,c)}):"js"===d?Utils.addScript(a[c],function(){c++,Utils.require(a,b,c)}):Utils.getTemplate(a[c],function(){c++,Utils.require(a,b,c)})},addScript:function(a,b){for(var c=document.getElementsByTagName("head")[0],d=c.getElementsByTagName("script"),e=!1,f=0;f<d.length;f++){var g=d[f].getAttribute("src");if(g==a){e=!0;break}}if(e)b&&"function"==typeof b&&b();else{var h=document.createElement("script");h.setAttribute("src",a),h.setAttribute("type","text/javascript"),h.onload=h.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(b&&"function"==typeof b&&b(),h.onload=h.onreadystatechange=null)},c.appendChild(h)}},addCss:function(a,b){for(var c=document.getElementsByTagName("head")[0],d=c.getElementsByTagName("link"),e=!1,f=0;f<d.length;f++){var g=d[f].getAttribute("href");if(g==a){e=!0;break}}if(!e){var h=document.createElement("link");h.setAttribute("type","text/css"),h.setAttribute("rel","stylesheet"),h.setAttribute("href",a),c.appendChild(h)}b&&"function"==typeof b&&b()},templateCache:[],getTemplate:function(a,b){for(var c="",d=0;d<Utils.templateCache.length;d++){var e=Utils.templateCache[d];if(a==e.path)return void(b&&"function"==typeof b&&b(e.content))}Utils.Messager.send({type:"GET",url:a,cache:!0,onSuccess:function(d){c=d;var e={path:a,content:c};Utils.templateCache.push(e),b&&"function"==typeof b&&b(c)}})},isNotEmpty:function(a){return!this.isEmpty(a)},isEmpty:function(a){return null==a||"undefined"==typeof a||"string"==typeof a&&""==a&&"undefined"!=a?!0:!1},isNumber:function(a){return!isNaN(a)},each:function(a,b,c){if(null!=a)if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===!1)return!1}else for(var f in a)if(a.hasOwnProperty(f)&&b.call(c,a[f],f,a)===!1)return!1},inArray:function(a,b){var c=-1;return this.each(a,function(a,d){return a===b?(c=d,!1):void 0}),c},pushItem:function(a,b){-1==this.inArray(a,b)&&a.push(b)},removeItem:function(a,b){for(var c=0,d=a.length;d>c;c++)a[c]===b&&(a.splice(c,1),c--)},replaceAll:function(a,b,c){return raRegExp=new RegExp(b,"g"),a.replace(raRegExp,c)},trim:function(a){return a.replace(/(^\s*)|(\s*$)/g,"")},getExtName:function(a){return a.substring(a.lastIndexOf(".")+1).toLowerCase()},formatCurrency:function(a){a=a.toString().replace(/\$|\,/g,""),isNaN(a)&&(a="0"),sign=a==(a=Math.abs(a)),a=Math.floor(100*a+.50000000001),cents=a%100,a=Math.floor(a/100).toString(),cents<10&&(cents="0"+cents);for(var b=0;b<Math.floor((a.length-(1+b))/3);b++)a=a.substring(0,a.length-(4*b+3))+","+a.substring(a.length-(4*b+3));return(sign?"":"-")+a+("."+cents)},formatDate:function(a,b){function c(a,b){return b=b.length,a=a||0,b=a}return b.replace(/([YMDhsm])\1*/g,function(b){switch(b.charAt()){case"Y":return c(a.getFullYear(),b);case"M":return Utils.leftZeroPad(c(a.getMonth()+1,b),2);case"D":return Utils.leftZeroPad(c(a.getDate(),b),2);case"w":return a.getDay()+1;case"h":return Utils.leftZeroPad(c(a.getHours(),b),2);case"m":return Utils.leftZeroPad(c(a.getMinutes(),b),2);case"s":return Utils.leftZeroPad(c(a.getSeconds(),b),2)}})},leftZeroPad:function(a,b){var c="00000000000000000000";return"string"!=typeof a&&(a=String(a)),c.substring(0,b-a.length)+a},getUUID:function(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-";var d=a.join("");return d}};Utils.Map=function(){this.map={},this.length=0},Utils.Map.prototype={put:function(a,b){var c=this,d=c.map;return c.containsKey(a)||++c.length,d[a]=b,c},get:function(a){var b=this.map;return b.hasOwnProperty(a)?b[a]:void 0},containsKey:function(a){var b=this.map;return b.hasOwnProperty(a)&&void 0!==b[a]},removeAtKey:function(a){var b=this;return b.containsKey(a)?(delete b.map[a],--b.length,!0):!1},clear:function(){var a=this;return a.map={},a.length=0,a},getKeys:function(){return this.getArray(!0)},getValues:function(){return this.getArray(!1)},getArray:function(a){var b,c=[],d=this.map;for(b in d)d.hasOwnProperty(b)&&c.push(a?b:d[b]);return c},each:function(a,b){var c,d=Utils.apply({},this.map),e=this.length;b=b||this;for(c in d)if(d.hasOwnProperty(c)&&a.call(b,c,d[c],e)===!1)break;return this}},Utils.Messager={send:function(a){var b=this,c=b.makeRequest();a=b.buildCfg(a),c.onreadystatechange=function(){b.readyStateChange(c,a)},c.open(a.method,a.url,a.async),"GET"===a.method?c.send(null):(c.setRequestHeader("Content-type",a.contentType),c.send(a.data))},makeRequest:function(){var a=!1;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}return a},buildCfg:function(a){if(a.method=void 0==a.type||null==a.type?"POST":a.type.toUpperCase(),a.async=void 0==a.sync||null==a.sync?!0:!a.sync,a.cache=void 0==a.cache||null==a.cache?!1:a.cache,a.contentType=void 0==a.contentType||null==a.contentType?"application/x-www-form-urlencoded":a.contentType,a.cache||(-1!=a.url.indexOf("?")?a.url+="&":a.url+="?",a.url+="t="+(new Date).getTime()),"object"==typeof a.data){var b="";for(var c in a.data)b+=c+"="+a.data[c]+"&";a.data=b.substring(0,b.length-1)}return a},readyStateChange:function(a,b){4==a.readyState&&(200==a.status||304==a.status?b.onSuccess&&b.onSuccess(a.responseText):b.onError&&b.onError())}},Utils.Math={random:function(a,b){return Math.floor(Math.random()*(b-a))+a},add:function(a,b){var c,d,e;try{c=a.toString().split(".")[1].length}catch(f){c=0}try{d=b.toString().split(".")[1].length}catch(f){d=0}return e=Math.pow(10,Math.max(c,d)),(a*e+b*e)/e},sub:function(a,b){var c,d,e,f;try{c=a.toString().split(".")[1].length}catch(g){c=0}try{d=b.toString().split(".")[1].length}catch(g){d=0}return e=Math.pow(10,Math.max(c,d)),f=c>=d?c:d,((a*e-b*e)/e).toFixed(f)},mul:function(a,b){var c=0,d=a.toString(),e=b.toString();try{c+=d.split(".")[1].length}catch(f){}try{c+=e.split(".")[1].length}catch(f){}return Number(d.replace(".",""))*Number(e.replace(".",""))/Math.pow(10,c)},div:function(arg1,arg2){var r1,r2,t1=0,t2=0;try{t1=arg1.toString().split(".")[1].length}catch(e){}try{t2=arg2.toString().split(".")[1].length}catch(e){}with(Math)return r1=Number(arg1.toString().replace(".","")),r2=Number(arg2.toString().replace(".","")),r1/r2*pow(10,t2-t1)}},Utils.Cookie={openCookie:function(){var a=navigator.cookieEnabled?!0:!1;return"undefined"!=typeof navigator.cookieEnabled||a||(document.cookie="testcookie",a="testcookie"==document.cookie?!0:falsedocument.cookie=""),a?!0:!1},setCookie:function(a,b,c){date=new Date,(null==c||void 0==c)&&(c=1440),date.setTime(date.getTime()+60*c*1e3),document.cookie=a+"="+escape(b)+";expires="+date.toGMTString()+";path=/"},getCookie:function(a){var b=new RegExp(a+"=[^;]+","i");return document.cookie.match(b)?document.cookie.match(b)[0].split("=")[1]:""}};var Message={msg:function(a,b,c){var d="info";(void 0==b||null==b)&&(b="INFO");var e=Ext.Msg.INFO;"INFO"===b.toUpperCase()?e=Ext.Msg.INFO:"WARN"===b.toUpperCase()?(e=Ext.Msg.WARNING,d="warn"):"ERROR"===b.toUpperCase()&&(e=Ext.Msg.ERROR,d="error"),Ext.Msg.show({title:d,msg:a,buttons:Ext.MessageBox.OK,icon:e,fn:void 0==c||null==c?function(){}:c})},input:function(a,b){Ext.Msg.prompt(a,"",function(a,c){var d=!1;"OK"===a.toUpperCase()&&(d=!0),b(d,c)})},ask:function(a,b){Ext.Msg.confirm("confirm",a,function(a){var c=!1;"YES"===a.toUpperCase()&&(c=!0),b(c)})}};TopMessage=function(){var a;return{info:function(a){TopMessage.msg(a,"info","info")},warn:function(a){TopMessage.msg(a,"warn","warn")},error:function(a){TopMessage.msg(a,"error","error")},msg:function(b,c,d){a?document.body.appendChild(a.dom):a=Ext.DomHelper.append(document.body,{id:"top-msg-div"},!0);var e="";(void 0==c||null==c)&&(c="message");var f=document.createElement("div");f.setAttribute("class","top-msg "+Ext.baseCSSPrefix+"border-box"),void 0!=d&&null!=d?"INFO"===d.toUpperCase()?(f.style.border="2px solid #3892d3",f.style.color="#3892d3"):"WARN"===d.toUpperCase()?(f.style.border="2px solid #eb7e23",f.style.color="#eb7e23"):"ERROR"===d.toUpperCase()&&(f.style.border="2px solid red",f.style.color="red"):f.style.border="2px solid #ccc",Ext.DomHelper.append(f,"<h3>"+c+"</h3><p>"+b+"</p>",!0);var g=document.createElement("outerDiv");g.appendChild(f),e=g.innerHTML,g=null;var h=Ext.DomHelper.append(a,e,!0);h.hide(),h.slideIn("t").ghost("t",{delay:3e3,remove:!0})}}}();var Messager={send:function(a){var b=this;void 0!=a.confirm?Message.ask(a.confirm,function(c){1==c&&b.base(a)}):b.base(a)},base:function(a){var b=null;void 0!=a.maskCmp&&(b=new Ext.LoadMask({msg:void 0!=a.maskText&&null!=a.maskText?a.maskText:"Loading...",target:a.maskCmp})),null!=b&&b.show();var c=!0;void 0!=a.onBefore&&(c=a.onBefore()),c&&Ext.Ajax.request({url:a.url,params:a.data,async:void 0==a.sync||null==a.sync?!0:!a.sync,success:function(c){if(null!=b&&Ext.destroy(b),void 0!=a.onSuccess){var d=null;if(void 0!=c.responseText&&null!=c.responseText&&""!=c.responseText)try{d=Ext.JSON.decode(c.responseText)}catch(e){d=c.responseText}a.onSuccess(d)}},failure:function(b,c){void 0!=a.onError&&a.onError(b,c)}})}};Ext.define("Ins.data.Store",{extend:"Ext.data.Store",alias:["widget.ins_store"],config:{url:null},autoLoad:!0,pageSize:1e3,constructor:function(){var a=this;a.callParent(arguments),null!=a.url?a.setProxy({type:"ajax",url:a.url,simpleSortMode:!0,actionMethods:{read:"POST"},reader:{type:"json",rootProperty:"data",totalProperty:"total"},extraParams:void 0==a.params||null==a.params?{}:a.params}):a.setProxy({type:"memory",reader:{type:"json"}})},getTotle:function(){var a=this;return a.getTotalCount()},findRecordById:function(a,b){var c=this;return c.findRecord(a,b)},findRecordByIndex:function(a){var b=this;return b.getAt(a)},getColumnData:function(a){for(var b=this,c=[],d=0;d<b.getTotle();d++){var e=b.findRecordByIndex(d);if(void 0==e||null==e)break;c.push(e.get(a))}return{ser:Ext.JSON.encode(c),data:c}},getCurrentPageData:function(){var a=this;return a.data.items},addRecords:function(a){var b=this;b.add(a)},removeAllRecords:function(){var a=this;a.removeAll()}}),Ext.define("Ins.panel.Panel",{extend:"Ext.panel.Panel",alias:"widget.ins_panel",config:{views:[],headButtons:[],actionButtons:[],actionButtonsAlign:"top",actionButtonsStyle:"default",onAfterRender:null,onAfterResize:null,useAppBg:!1},layout:"fit",headerPosition:"top",initComponent:function(){var a=this;if(a.useAppBg&&(a.bodyStyle="background-image:url("+App.LAYOUT_BG+")"),a.actionButtons.length>0){var b={xtype:"toolbar",id:a.getId()+"_toolbar",items:a.actionButtons,dock:a.actionButtonsAlign,ui:a.actionButtonsStyle};Ext.apply(a,{dockedItems:b})}a.headButtons.length>0&&Ext.apply(a,{tools:a.headButtons}),Ext.apply(a,{items:a.views}),null!=a.onAfterRender&&a.addListener("afterrender",a.onAfterRender),null!=a.onAfterResize&&a.addListener("resize",a.onAfterResize),this.callParent(arguments)}}),Ext.define("Ins.layout.BorderLayout",{extend:"Ext.panel.Panel",alias:["widget.ins_borderlayout"],config:{views:[],location:[],fold:[],useAppBg:!1},locationMapping:{top:"north",bottom:"south",left:"west",right:"east",center:"center"},border:!1,initComponent:function(){var a=this;a.useAppBg&&(a.bodyStyle="background-image:url("+App.LAYOUT_BG+")");var b=[];for(var c in a.views){var d=a.views[c],e=a.locationMapping[a.location[c]];if(Ext.apply(d,{region:e}),void 0!=a.fold&&null!=a.fold&&a.fold.length>c){var f=a.fold[c];void 0!=f&&null!=f&&1==f&&Ext.apply(d,{split:!0,collapsible:!0,collapseMode:"undefinde"})}b.push(d)}Ext.apply(a,{layout:"border",items:b}),this.callParent(arguments)},foldView:function(a){Ext.getCmp(a).collapse()},unfoldView:function(a){Ext.getCmp(a).expand()}}),Ext.define("Ins.layout.BoxLayout",{extend:"Ext.panel.Panel",alias:["widget.ins_boxlayout"],config:{views:[],direction:"-",comSize:[],useAppBg:!1},border:!1,initComponent:function(){var a=this;a.useAppBg&&(a.bodyStyle="background-image:url("+App.LAYOUT_BG+")");var b=null;b="-"==a.direction?{type:"hbox",align:"stretch"}:{type:"vbox",align:"stretch"};for(var c=0;c<a.views.length;c++)void 0==a.comSize[c]||null==a.comSize[c]||Ext.apply(a.views[c],a.comSize[c]);Ext.apply(a,{layout:b,items:a.views}),this.callParent(arguments)}}),Ext.define("Ins.layout.AccrodionLayout",{extend:"Ext.panel.Panel",alias:["widget.ins_accrodionlayout"],config:{views:[]},layout:{type:"accordion",titleCollapse:!0,animate:!0},initComponent:function(){var a=this;a.views.length>0&&Ext.apply(a,{items:a.views}),this.callParent(arguments)}}),Ext.define("Ins.layout.tab.TabLayout",{extend:"Ext.tab.Panel",alias:["widget.ins_tablayout"],config:{views:[],direction:"top",onTabChange:null,useAppBg:!1},activeTab:0,flex:1,border:!1,deferredRender:!1,initComponent:function(){var a=this;if(a.useAppBg&&(a.bodyStyle="background-image:url("+App.LAYOUT_BG+")"),0!=a.views.length){var b=[];for(var c in a.views){var d=a.views[c];Ext.apply(d,{tabConfig:{tooltip:a.views[c].title}}),b.push(d)}Ext.apply(a,{items:b,defaults:{closeText:"Close this tab"}})}a.setTabPosition(a.direction),void 0!=a.onTabChange&&null!=a.onTabChange&&a.addListener("tabchange",function(b,c,d,e){a.onTabChange(a.getSelectedTabTitle(),d,c)}),this.callParent(arguments)},setDisabled:function(a){var b=this;b.callParent([a]),b.selectTabByIndex(1),b.selectTabByIndex(0)},selectTabByIndex:function(a){var b=this;b.setActiveTab(a)},selectTabById:function(a){var b=this,c=Ext.getCmp(a);c.setDisabled(!1),b.setActiveTab(c)},getSelectedTabTitle:function(){var a=this;return a.getActiveTab().title}}),Ext.define("Ins.layout.tab.TabCloseMenu",{extend:"Ext.plugin.Abstract",alias:"plugin.ins_tabclosemenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"Close tab",showCloseOthers:!0,closeOthersTabsText:"Close othre tab",showCloseAll:!0,closeAllTabsText:"Close All tab",extraItemsHead:null,extraItemsTail:null,constructor:function(a){this.callParent([a]),this.mixins.observable.constructor.call(this,a)},init:function(a){this.tabPanel=a,this.tabBar=a.down("tabbar"),this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:!0})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:".x-tab"})},destroy:function(){this.callParent(),Ext.destroy(this.menu)},onContextMenu:function(a,b){var c=this,d=c.createMenu(),e=!0,f=!0,g=c.tabBar.getChildByElement(b),h=c.tabBar.items.indexOf(g);c.item=c.tabPanel.getComponent(h),d.child("#close").setDisabled(!c.item.closable),(c.showCloseAll||c.showCloseOthers)&&(c.tabPanel.items.each(function(a){return a.closable&&(e=!1,a!==c.item)?(f=!1,!1):!0}),c.showCloseAll&&d.child("#closeAll").setDisabled(e),c.showCloseOthers&&d.child("#closeOthers").setDisabled(f)),a.preventDefault?a.preventDefault():a.returnValue=!1,c.fireEvent("beforemenu",d,c.item,c),d.showAt(a.getXY())},createMenu:function(){var a=this;if(!a.menu){var b=[{itemId:"close",iconCls:"icon-cross",text:a.closeTabText,scope:a,handler:a.onClose}];(a.showCloseAll||a.showCloseOthers)&&b.push("-"),a.showCloseOthers&&b.push({itemId:"closeOthers",text:a.closeOthersTabsText,scope:a,handler:a.onCloseOthers}),a.showCloseAll&&b.push({itemId:"closeAll",text:a.closeAllTabsText,scope:a,handler:a.onCloseAll}),a.extraItemsHead&&(b=a.extraItemsHead.concat(b)),a.extraItemsTail&&(b=b.concat(a.extraItemsTail)),a.menu=Ext.create("Ext.menu.Menu",{items:b,listeners:{hide:a.onHideMenu,scope:a}})}return a.menu},onHideMenu:function(){var a=this;a.fireEvent("aftermenu",a.menu,a)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(!0)},onCloseAll:function(){this.doClose(!1)},doClose:function(a){var b=[];this.tabPanel.items.each(function(c){c.closable&&(a&&c===this.item||b.push(c))},this),Ext.suspendLayouts(),Ext.Array.forEach(b,function(a){this.tabPanel.remove(a)},this),Ext.resumeLayouts(!0)}}),Ext.define("Ins.layout.CenterLayout",{extend:"Ins.panel.Panel",alias:["widget.ins_centerlayout"],layout:"center",initComponent:function(){this.callParent(arguments)}}),Ext.define("Ins.window.Window",{extend:"Ext.window.Window",alias:["widget.ins_window"],config:{views:[],hideTitle:!1,headButtons:[],actionButtons:[],actionButtonsAlign:"bottom",actionButtonsStyle:"footer",onBeforeShow:null,onBeforeHide:null,useAppBg:!1},title:"Unknown Window",closeAction:"hide",collapsible:!0,resizable:!0,modal:!0,layout:"fit",headerPosition:"top",maximizable:!1,minimizable:!1,constrain:!0,constrainHeader:!0,initComponent:function(){var a=this;if(a.useAppBg&&(a.bodyStyle="background-image:url("+App.LAYOUT_BG+")"),a.header=!a.hideTitle,a.actionButtons.length>0){var b={id:a.getId()+"_toolbar",xtype:"toolbar",dock:a.actionButtonsAlign,items:a.actionButtons,ui:a.actionButtonsStyle};Ext.apply(a,{dockedItems:b})}a.headButtons.length>0&&Ext.apply(a,{tools:a.headButtons}),Ext.apply(a,{items:a.views}),void 0!=a.onBeforeShow&&null!=a.onBeforeShow&&a.addListener("beforeshow",a.onBeforeShow),void 0!=a.onBeforeHide&&null!=a.onBeforeHide&&a.addListener("beforehide",a.onBeforeHide),this.callParent(arguments)},alignToCenter:function(){var a=this;a.center()}}),Ext.define("Ins.menu.Menu",{extend:"Ext.menu.Menu",alias:["widget.ins_menu"],config:{},initComponent:function(){this.callParent(arguments)},showMenu:function(a){var b=this;b.showAt(a.pageX,a.pageY)}}),Ext.define("Ins.tree.Tree",{extend:"Ext.tree.Panel",config:{url:null,fields:[],pkField:"id",onDblClick:null,onContextMenuClick:null,onClick:null,loadOnShow:!0,hideTitle:!1,searchFiled:!1,searchFieldText:"Search",actionButtons:[],checkedAsParent:!0,onCtxClick:null,NODE_EXPAND_STATE:[]},title:"Unknown Tree",useArrows:!0,rootVisible:!1,animate:!1,multiSelect:!1,width:240,initComponent:function(){var a=this;(null!=a.getHeader()||a.hideTitle)&&Ext.apply(a,{header:!a.hideTitle});var b=["id","pid","text"];for(var c in b){var d=b[c],e=Ext.Array.contains(a.fields,d);e||a.fields.push(d)}Ext.apply(a,{store:new Ext.data.TreeStore({fields:a.fields,autoLoad:a.loadOnShow,idProperty:a.pkField,proxy:{actionMethods:{read:"POST"},type:"ajax",url:a.url}})}),a.tools=[{type:"collapse",tooltip:"Collapse",listeners:{click:function(){a.expandAll()}}},{type:"expand",tooltip:"Expand",listeners:{click:function(){a.collapseAll()}}},{type:"refresh",tooltip:"Refresh",handler:function(){a.reloadExpand()}}],a.listeners={itemdblclick:function(b,c,d,e,f){Ext.apply(a,{currNode:c}),null!=a.onDblClick&&a.onDblClick(c,f)},itemclick:function(b,c,d,e,f,g){Ext.apply(a,{currNode:c}),null!=a.onClick&&a.onClick(c)},itemcontextmenu:function(b,c,d,e,f){Ext.apply(a,{currNode:c}),null!=a.onContextMenuClick&&(rsFlag=a.onContextMenuClick(c,f)),null!=a.onCtxClick&&a.onCtxClick(c,f)},checkchange:function(b,c){a.setChecked(b,c)},selectionchange:function(a,b,c){}};var f=[];if(a.actionButtons.length>0&&f.push({xtype:"toolbar",items:a.actionButtons}),a.searchFiled){var g;if("ins_gridtree"!=a.xtype&&"ins_crudgridtree"!=a.xtype)a.hideHeaders=!0,a.columns=[{xtype:"treecolumn",flex:1,dataIndex:"text",scope:a,renderer:function(a){var b=this.searchField.getValue();return b.length>0?this.strMarkRedPlus(b,a):a}}];else for(var c=0;c<a.columns.length;c++)"text"==a.columns[c].dataIndex&&Ext.apply(a.columns[c],{xtype:"treecolumn",dataIndex:"text",scope:a,renderer:function(a){var b=this.searchField.getValue();return b.length>0?this.strMarkRedPlus(b,a):a}});f.push({xtype:"textfield",dock:"top",emptyText:a.searchFieldText,enableKeyEvents:!0,triggers:{clear:{cls:"x-form-clear-trigger",handler:"onClearTriggerClick",hidden:!0,scope:"this"},search:{cls:"x-form-search-trigger",weight:1,handler:"onSearchTriggerClick",scope:"this"}},onClearTriggerClick:function(){this.setValue(),a.store.clearFilter(),this.getTrigger("clear").hide()},onSearchTriggerClick:function(){a.filterStore(this.getValue())},listeners:{keyup:{fn:function(b,c,d){var e=b.getValue();e&&e!==g&&(b.getTrigger("clear")[e.length>0?"show":"hide"](),a.filterStore(e),g=e)},buffer:200},render:function(a){this.searchField=a},scope:a}})}f.length>0&&Ext.apply(a,{dockedItems:f}),this.callParent(arguments)},getCurrentNode:function(){var a=this;return a.currNode},getSelectedView:function(){var a=this,b=a.getSelectionModel().getSelection(),c="[";for(var d in b){var e=b[d].data[a.pkField];c+='"'+e+'",'}return c=c.substring(0,c.length-1),c+="]","]"==c&&(c="[]"),{count:b.length,idSer:c,idArr:Ext.JSON.decode(c),records:b}},getCheckedView:function(){var a=this,b=a.getView().getChecked(),c="[";for(var d in b){var e=b[d].data[a.pkField];c+='"'+e+'",'}return c=c.substring(0,c.length-1),c+="]","]"==c&&(c="[]"),{count:b.length,idSer:c,idArr:Ext.JSON.decode(c),records:b}},load:function(a){var b=this;b.setDisabled(!1),void 0!=a&&null!=a&&(b.loadParams=a,b.getStore().proxy.extraParams=b.loadParams),b.store.reload()},reloadExpand:function(){var a=this;a.NODE_EXPAND_STATE=[],a.getRootNode().cascadeBy(function(b){1==b.data.expanded&&a.NODE_EXPAND_STATE.push(b.getPath())}),a.store.reload({callback:function(){var b;for(b=0;b<a.NODE_EXPAND_STATE.length;b++)a.expandPath(a.NODE_EXPAND_STATE[b])}})},clearChecked:function(){var a=this;a.getRootNode().cascadeBy(function(a){a.set("checked",!1)})},clearSelect:function(){var a=this;a.getStore().getTotalCount()>0&&a.getSelectionModel().selectAll(),a.getSelectionModel().deselectAll()},setChecked:function(a,b){var c=this;c.checkedAsParent&&b&&c.setParentNodeChecked(a),a.set("checked",b),a.cascadeBy(function(a){a.set("checked",b)})},setParentNodeChecked:function(a){var b=this,c=a.parentNode;null!=c&&((0==c.data.checked||1==c.data.checked)&&c.set("checked",!0),null!=c.data.id&&b.setParentNodeChecked(c))},filterStore:function(a){var b,c=this,d=c.store,e=a.toLowerCase(),f=function(a){var c,d=a.childNodes,e=d&&d.length,g=b.test(a.get("text"));if(g)for(c=0;e>c;c++)d[c].set("visible",!0);else for(c=0;e>c&&!(g=d[c].isLeaf()?d[c].get("visible"):f(d[c]));c++);return g};e.length<1?d.clearFilter():(b=new RegExp(e,"i"),d.getFilters().replaceAll({filterFn:f}))},strMarkRedPlus:function(a,b){return b.replace(new RegExp("("+a+")","gi"),"<span style='color: red;'><b>$1</b></span>")}}),Ext.define("Ins.tree.CrudTree",{extend:"Ins.tree.Tree",config:{urlConfig:{},dataSet:[],formFields:[],permission:{add:!0,update:!0,remove:!0,view:!0},defaultFormFieldWidth:230,customMenu:[],onBeforeShowAddForm:null,onBeforeShowEditForm:null,onBeforeShowViewForm:null,onAfterShowAddForm:null,onAfterShowEditForm:null,onAfterShowViewForm:null,onBeforeDelete:null,onBeforeSaveAdd:null,onBeforeSaveEdit:null,onBeforeShowCxtMenu:null,onAfterShowCxtMenu:null,onAfterDelete:null,onAfterFormSubmit:null,columnSize:2,labelConfig:{add:{text:null,iconCls:null},update:{text:null,iconCls:null},view:{text:null,iconCls:null},remove:{text:null,iconCls:null}},formWindowHeight:null,formWindowWidth:510,formWindowMaxHeight:null,formWindowMaxWidth:null,formWindowModal:!1},initComponent:function(){var a=this,b=[];for(var c in a.dataSet){var d=a.dataSet[c];b.push(d.name)}Ext.apply(a,{fields:b});var e=[];for(var c in a.formFields){var f=a.formFields[c],g=null;if(void 0!=f.forData&&null!=f.forData||void 0!=f.name&&null!=f.name)g=a.getFieldDefByName(Ext.clone(f)),null!=g&&void 0==g.width&&"component"!=g.xtype&&"container"!=g.xtype&&"panel"!=g.xtype&&"ins_panel"!=g.xtype&&"ins_fieldcontainer"!=g.xtype&&Ext.apply(g,{width:a.defaultFormFieldWidth});else if(void 0!=f.items&&null!=f.items){g=Ext.clone(f),g.items=[];for(var h in f.items)null!=f.items[h]&&void 0==f.items[h].width&&"component"!=f.items[h].xtype&&"container"!=f.items[h].xtype&&"panel"!=f.items[h].xtype&&"ins_panel"!=f.items[h].xtype&&"ins_fieldcontainer"!=f.items[h].xtype&&Ext.apply(f.items[h],{width:a.defaultFormFieldWidth}),g.items.push(a.getFieldDefByName(Ext.clone(f.items[h])))}e.push(g)}var i={fields:e,modal:a.formWindowModal,defaultFormFieldWidth:a.defaultFormFieldWidth,columnSize:a.columnSize,onBeforeHide:function(a){a.getForm().reset()}};null!=a.onAfterFormSubmit&&(i.onAfterSubmit=a.onAfterFormSubmit),null!=a.formWindowHeight&&(i.height=a.formWindowHeight),null!=a.formWindowWidth&&(i.width=a.formWindowWidth),null!=a.formWindowMaxHeight&&(i.maxHeight=a.formWindowMaxHeight),null!=a.formWindowMaxWidth&&(i.maxWidth=a.formWindowMaxWidth);var j=Ext.create("Ins.form.OprFormWindow",i);Ext.apply(a,{form:j,url:a.urlConfig.loadAll});var k=[];if(void 0!=a.urlConfig.add&&null!=a.urlConfig.add&&a.permission.add&&k.push({id:a.getId()+"_add_btn",text:null!=a.labelConfig.add.text?a.labelConfig.add.text:"Add",iconCls:null!=a.labelConfig.add.iconCls?a.labelConfig.add.iconCls:"icon-add",handler:function(b){var c=!0;null!=a.onBeforeShowAddForm&&(c=a.onBeforeShowAddForm(a.getForm())),c&&(j.showAsAddMode({url:a.urlConfig.add,onBeforeSave:a.onBeforeSaveAdd,success:function(b){a.reloadExpand()}}),null!=a.onAfterShowAddForm&&a.onAfterShowAddForm(a.getForm()))}}),void 0!=a.urlConfig.update&&null!=a.urlConfig.update&&void 0!=a.urlConfig.load&&null!=a.urlConfig.load&&a.permission.update&&k.push({id:a.getId()+"_edit_btn",iconCls:null!=a.labelConfig.update.iconCls?a.labelConfig.update.iconCls:"icon-edit",text:null!=a.labelConfig.update.text?a.labelConfig.update.text:"Edit",handler:function(){var b=!0;if(void 0!=a.onBeforeShowEditForm&&null!=a.onBeforeShowEditForm&&(b=a.onBeforeShowEditForm(a.getForm())),b){var c={};c[a.pkField]=a.getCurrentNode().data[a.pkField],j.showAsEditMode({loadUrl:a.urlConfig.load+"?nolog=y",updateUrl:a.urlConfig.update,onBeforeSave:a.onBeforeSaveEdit,params:c,success:function(b){a.reloadExpand()},onSuccess:function(b,c){null!=a.onAfterShowEditForm&&a.onAfterShowEditForm(b,c)}})}}}),void 0!=a.urlConfig.remove&&null!=a.urlConfig.remove&&a.permission.remove&&k.push({id:a.getId()+"_delete_btn",text:null!=a.labelConfig.remove.text?a.labelConfig.remove.text:"Delete",iconCls:null!=a.labelConfig.remove.iconCls?a.labelConfig.remove.iconCls:"icon-delete",handler:function(b){var c=!0;if(void 0!=a.onBeforeDelete&&null!=a.onBeforeDelete&&(c=a.onBeforeDelete(a.getSelectedView())),c){var d=a.getCurrentNode().data[a.pkField];Messager.send({confirm:"Delete this node?",maskCmp:a,url:a.urlConfig.remove,data:{id:d},onSuccess:function(b){a.reloadExpand(),null!=a.onAfterDelete&&a.onAfterDelete(),TopMessage.info("Success")}})}}}),void 0!=a.urlConfig.load&&null!=a.urlConfig.load&&a.permission.view&&k.push({id:a.getId()+"_view_btn",iconCls:null!=a.labelConfig.view.iconCls?a.labelConfig.view.iconCls:"icon-view",text:null!=a.labelConfig.view.text?a.labelConfig.view.text:"View",handler:function(){var b=!0;if(void 0!=a.onBeforeShowViewForm&&null!=a.onBeforeShowViewForm&&(b=a.onBeforeShowViewForm(a.getForm())),b){var c={};c[a.pkField]=a.getCurrentNode().data[a.pkField],j.showAsViewMode({loadUrl:a.urlConfig.load,params:c,onSuccess:function(b,c){null!=a.onAfterShowViewForm&&a.onAfterShowViewForm(b,c)}})}}}),void 0!=a.customMenu&&a.customMenu.length>0){k.length>0&&k.push("-");for(var c in a.customMenu){var f=a.customMenu[c];k.push(f)}}if(k.length>0){var l=new Ins.menu.Menu({items:k});Ext.apply(a,{contextMenu:l,onCtxClick:function(b,c){c.preventDefault?c.preventDefault():c.returnValue=!1;var d=!0;null!=a.onBeforeShowCxtMenu&&(d=a.onBeforeShowCxtMenu(l)),d&&k.length>0&&(a.contextMenu.showAt(c.getXY()),null!=a.onAfterShowCxtMenu&&a.onAfterShowCxtMenu(l))}})}a.addListener("beforedestroy",function(){(void 0!=a.form||null!=a.form)&&Ext.destroy(a.form),(void 0!=a.contextMenu||null!=a.contextMenu)&&Ext.destroy(a.contextMenu)}),a.callParent(arguments)},getFieldDefByName:function(a){var b=this;for(var c in b.dataSet){var d=b.dataSet[c];if(d.name==a.forData)return Ext.apply(a,{fieldLabel:d.text,text:d.text,name:d.name}),a}return null!=a.name&&void 0!=a.name?(Ext.apply(a,{fieldLabel:a.text,text:a.text}),a):void(window.console&&console.error("没有发现 dataSet 中配置的该表单字段。"))},getForm:function(){var a=this;return a.form.getForm()}}),Ext.define("Ins.tree.GridTree",{extend:"Ins.tree.Tree",alias:"widget.ins_gridtree",config:{gridColumns:null,hideTableHead:!1,treeAt:"text",defaultColumnWidth:120,disabledColumnsSortable:!1},animate:!1,rowLines:!0,columnLines:!0,width:"100%",multiSelect:!1,viewConfig:{stripeRows:!0,enableTextSelection:!0},initComponent:function(){var a=this;if(Ext.apply(a,{hideHeaders:a.hideTableHead}),null!=a.gridColumns)for(var b in a.gridColumns){var c=a.gridColumns[b];void 0!=c.dataIndex&&Ext.applyIf(c,{width:a.defaultColumnWidth}),void 0!=c.dataIndex&&void 0==c.sortable&&Ext.apply(c,{sortable:!a.disabledColumnsSortable}),c.dataIndex==a.treeAt&&Ext.applyIf(c,{xtype:"treecolumn"})}Ext.apply(a,{columns:a.gridColumns}),a.callParent(arguments)}}),Ext.define("Ins.tree.CrudGridTree",{extend:"Ins.tree.Tree",alias:"widget.ins_crudgridtree",config:{urlConfig:{},dataSet:[],formFields:[],permission:{add:!0,update:!0,remove:!0,view:!0},defaultFormFieldWidth:230,customMenu:[],onBeforeShowAddForm:null,onBeforeShowEditForm:null,onBeforeShowViewForm:null,onAfterShowAddForm:null,onAfterShowEditForm:null,onAfterShowViewForm:null,onBeforeDelete:null,onBeforeSaveAdd:null,onBeforeSaveEdit:null,onBeforeShowCxtMenu:null,onAfterShowCxtMenu:null,onAfterDelete:null,onAfterFormSubmit:null,columnSize:2,labelConfig:{add:{text:null,iconCls:null},update:{text:null,iconCls:null},view:{text:null,iconCls:null},remove:{text:null,iconCls:null}},gridColumns:null,hideTableHead:!1,treeAt:"text",defaultColumnWidth:120,disabledColumnsSortable:!1,formWindowHeight:null,formWindowWidth:510,formWindowMaxHeight:null,formWindowMaxWidth:null,formWindowModal:!1},animate:!1,rowLines:!0,columnLines:!0,width:"100%",multiSelect:!1,viewConfig:{stripeRows:!0,enableTextSelection:!0},initComponent:function(){var a=this;Ext.apply(a,{hideHeaders:a.hideTableHead
});var b=[];for(var c in a.dataSet){var d=a.dataSet[c];b.push(d.name)}Ext.apply(a,{fields:b});var e=[];for(var c in a.gridColumns){var f=Ext.clone(a.gridColumns[c]),g=a.getColumnDefByName(f);Ext.applyIf(g,{width:a.defaultColumnWidth,sortable:!a.disabledColumnsSortable}),g.dataIndex==a.treeAt&&Ext.applyIf(g,{xtype:"treecolumn"}),e.push(g)}Ext.apply(a,{columns:e});var h=[];for(var c in a.formFields){var i=a.formFields[c],j=null;if(void 0!=i.forData&&null!=i.forData||void 0!=i.name&&null!=i.name)j=a.getFieldDefByName(Ext.clone(i)),null!=j&&void 0==j.width&&"component"!=j.xtype&&"container"!=j.xtype&&"panel"!=j.xtype&&"ins_panel"!=j.xtype&&"ins_fieldcontainer"!=j.xtype&&Ext.apply(j,{width:a.defaultFormFieldWidth});else if(void 0!=i.items&&null!=i.items){j=Ext.clone(i),j.items=[];for(var k in i.items)null!=i.items[k]&&void 0==i.items[k].width&&"component"!=i.items[k].xtype&&"container"!=i.items[k].xtype&&"panel"!=i.items[k].xtype&&"ins_panel"!=i.items[k].xtype&&"ins_fieldcontainer"!=i.items[k].xtype&&Ext.apply(i.items[k],{width:a.defaultFormFieldWidth}),j.items.push(a.getFieldDefByName(Ext.clone(i.items[k])))}h.push(j)}var l={fields:h,modal:a.formWindowModal,defaultFormFieldWidth:a.defaultFormFieldWidth,columnSize:a.columnSize,onBeforeHide:function(a){a.getForm().reset()}};null!=a.onAfterFormSubmit&&(l.onAfterSubmit=a.onAfterFormSubmit),null!=a.formWindowHeight&&(l.height=a.formWindowHeight),null!=a.formWindowWidth&&(l.width=a.formWindowWidth),null!=a.formWindowMaxHeight&&(l.maxHeight=a.formWindowMaxHeight),null!=a.formWindowMaxWidth&&(l.maxWidth=a.formWindowMaxWidth);var m=Ext.create("Ins.form.OprFormWindow",l);Ext.apply(a,{form:m,url:a.urlConfig.loadAll});var n=[];if(void 0!=a.urlConfig.add&&null!=a.urlConfig.add&&n.push({id:a.getId()+"_add_btn",hidden:!a.permission.add,text:null!=a.labelConfig.add.text?a.labelConfig.add.text:"Add",iconCls:null!=a.labelConfig.add.iconCls?a.labelConfig.add.iconCls:"icon-add",handler:function(b){var c=!0;null!=a.onBeforeShowAddForm&&(c=a.onBeforeShowAddForm(a.getForm())),c&&(m.showAsAddMode({url:a.urlConfig.add,onBeforeSave:a.onBeforeSaveAdd,success:function(b){a.reloadExpand()}}),null!=a.onAfterShowAddForm&&a.onAfterShowAddForm(a.getForm()))}}),void 0!=a.urlConfig.update&&null!=a.urlConfig.update&&void 0!=a.urlConfig.load&&null!=a.urlConfig.load&&n.push({id:a.getId()+"_edit_btn",hidden:!a.permission.update,iconCls:null!=a.labelConfig.update.iconCls?a.labelConfig.update.iconCls:"icon-edit",text:null!=a.labelConfig.update.text?a.labelConfig.update.text:"Edit",handler:function(){var b=!0;if(void 0!=a.onBeforeShowEditForm&&null!=a.onBeforeShowEditForm&&(b=a.onBeforeShowEditForm(a.getForm())),b){var c={};c[a.pkField]=a.getCurrentNode().data[a.pkField],m.showAsEditMode({loadUrl:a.urlConfig.load+"?nolog=y",updateUrl:a.urlConfig.update,onBeforeSave:a.onBeforeSaveEdit,params:c,success:function(b){a.reloadExpand()},onSuccess:function(b,c){null!=a.onAfterShowEditForm&&a.onAfterShowEditForm(b,c)}})}}}),void 0!=a.urlConfig.remove&&null!=a.urlConfig.remove&&n.push({id:a.getId()+"_delete_btn",hidden:!a.permission.remove,text:null!=a.labelConfig.remove.text?a.labelConfig.remove.text:"Delete",iconCls:null!=a.labelConfig.remove.iconCls?a.labelConfig.remove.iconCls:"icon-delete",handler:function(b){var c=!0;if(void 0!=a.onBeforeDelete&&null!=a.onBeforeDelete&&(c=a.onBeforeDelete(a.getSelectedView())),c){var d=a.getCurrentNode().data[a.pkField];Messager.send({confirm:"Delete this node?",maskCmp:a,url:a.urlConfig.remove,data:{id:d},onSuccess:function(b){a.reloadExpand(),null!=a.onAfterDelete&&a.onAfterDelete(),TopMessage.info("Success")}})}}}),void 0!=a.urlConfig.load&&null!=a.urlConfig.load&&n.push({id:a.getId()+"_view_btn",hidden:!a.permission.view,iconCls:null!=a.labelConfig.view.iconCls?a.labelConfig.view.iconCls:"icon-view",text:null!=a.labelConfig.view.text?a.labelConfig.view.text:"View",handler:function(){var b=!0;if(void 0!=a.onBeforeShowViewForm&&null!=a.onBeforeShowViewForm&&(b=a.onBeforeShowViewForm(a.getForm())),b){var c={};c[a.pkField]=a.getCurrentNode().data[a.pkField],m.showAsViewMode({loadUrl:a.urlConfig.load,params:c,onSuccess:function(b,c){null!=a.onAfterShowViewForm&&a.onAfterShowViewForm(b,c)}})}}}),void 0!=a.customMenu&&a.customMenu.length>0){n.length>0&&n.push("-");for(var c in a.customMenu){var i=a.customMenu[c];n.push(i)}}if(n.length>0){var o=new Ins.menu.Menu({items:n});Ext.apply(a,{contextMenu:o,onCtxClick:function(b,c){c.preventDefault?c.preventDefault():c.returnValue=!1;var d=!0;null!=a.onBeforeShowCxtMenu&&(d=a.onBeforeShowCxtMenu(o)),d&&n.length>0&&(a.contextMenu.showAt(c.getXY()),null!=a.onAfterShowCxtMenu&&a.onAfterShowCxtMenu(o))}})}a.addListener("beforedestroy",function(){(void 0!=a.form||null!=a.form)&&Ext.destroy(a.form),(void 0!=a.contextMenu||null!=a.contextMenu)&&Ext.destroy(a.contextMenu)}),a.callParent(arguments)},getColumnDefByName:function(a){var b=this,c=null;"string"==typeof a?c={forData:a}:"object"==typeof a&&(c=a);for(var d in b.dataSet){var e=b.dataSet[d];if(e.name==c.forData){Ext.apply(c,{text:e.text,dataIndex:e.name});break}}return c},getFieldDefByName:function(a){var b=this;for(var c in b.dataSet){var d=b.dataSet[c];if(d.name==a.forData)return Ext.apply(a,{fieldLabel:d.text,text:d.text,name:d.name}),a}return null!=a.name&&void 0!=a.name?(Ext.apply(a,{fieldLabel:a.text,text:a.text}),a):void(window.console&&console.error("没有发现 dataSet 中配置的该表单字段。"))},getForm:function(){var a=this;return a.form.getForm()}}),Ext.define("Ins.tree.ChooserTree",{extend:"Ins.tree.Tree",alias:"widget.ins_choosertree",config:{onChooserSelect:null,onBeforeChooserSelect:null,onChooserCancel:null,isSearch:!1},initComponent:function(){var a=this;a.searchFiled=a.isSearch,a.hideTitle=!0,a.actionButtons.unshift({text:"Cancel",iconCls:"icon-delete",handler:function(b){null!=a.onChooserCancel&&a.onChooserCancel()}}),a.actionButtons.unshift({text:"Ok",iconCls:"icon-ok",handler:function(b){var c=a.getSelectedView();if(0==c.count)return void TopMessage.warn("Please select a record");var d=!0;void 0!=a.onBeforeChooserSelect&&null!=a.onBeforeChooserSelect&&(d=a.onBeforeChooserSelect(c.records[0])),d&&null!=a.onChooserSelect&&a.onChooserSelect(c.records[0])}}),a.callParent(arguments)}});var FormToolkit={REQUIRED_TPL:'<span style="color:red;font-weight:bold" data-qtip="requited">*</span>',config:{text:null,onFieldFocus:null,onFieldBlur:null,onFieldChange:null,msgTarget:"side"},init:function(a){null!=a.text&&Ext.apply(a,{fieldLabel:a.text}),void 0==a.allowBlank||a.allowBlank||Ext.apply(a,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL}),null!=a.onFieldFocus&&a.addListener("focus",a.onFieldFocus),null!=a.onFieldBlur&&a.addListener("blur",a.onFieldBlur),null!=a.onFieldChange&&a.addListener("change",a.onFieldChange)},setFormFieldsReadonly:function(a,b){a.getForm().getFields().each(function(a){try{"ins_htmleditor"!=a.xtype&&(a.setReadOnly(b),1==b?a.setFieldStyle({backgroundColor:"#EBEBEB"}):a.setFieldStyle({backgroundColor:"#FFF"}))}catch(c){}})}};Ext.define("Ins.form.field.TextField",{extend:"Ext.form.field.Text",alias:["widget.ins_textfield"],config:FormToolkit.config,maxLength:32,initComponent:function(){var a=this;FormToolkit.init(this),0==a.allowBlank&&(a.allowOnlyWhitespace=!1),this.callParent(arguments)}}),Ext.define("Ins.form.field.PasswordField",{extend:"Ins.form.field.TextField",alias:["widget.ins_passwordfield"],inputType:"password"}),Ext.define("Ins.form.field.HiddenField",{extend:"Ext.form.field.Hidden",alias:["widget.ins_hiddenfield"],config:{onFieldChange:null},initComponent:function(){var a=this;null!=a.onFieldChange&&a.addListener("change",a.onFieldChange),this.callParent(arguments)}}),Ext.define("Ins.form.field.NumberField",{extend:"Ext.form.field.Number",alias:["widget.ins_numberfield"],config:FormToolkit.config,decimalPrecision:12,maxLength:32,minValue:0,maxValue:999999999999,initComponent:function(){FormToolkit.init(this),this.callParent(arguments)}}),Ext.define("Ins.form.field.List",{extend:"Ext.form.field.ComboBox",alias:["widget.ins_list"],config:FormToolkit.config,constructor:function(a){var b=this;Ext.apply(b,{list:[],fields:["text","value"]}),b.callParent([a])},editable:!1,displayField:"text",valueField:"value",queryMode:"local",initComponent:function(){var a=this;FormToolkit.init(a),null!=a.list&&a.list.length>0&&(a.store={fields:a.fields,data:a.list}),this.callParent(arguments)},getList:function(){var a=this;return a.list},getTextByValue:function(a){var b=this;for(var c in b.list){var d=b.list[c];if(d.value==a)return d.text}return null},getValueByText:function(a){var b=this;for(var c in b.list){var d=b.list[c];if(d.text==a)return d.value}return null}}),Ext.define("Ins.form.field.DynamicList",{extend:"Ins.form.field.List",alias:["widget.ins_dynamiclist"],config:{url:null,params:{}},initComponent:function(){var a=this;null!=a.url&&Ext.apply(a,{store:a.buildStore(a.url,a.params)}),this.callParent(arguments)},getList:function(){var a=this,b=[];return a.getStore().each(function(a){b.push({text:a.get("text"),value:a.get("value")})}),b},buildStore:function(a,b){var c=this,d=new Ins.data.Store({fields:c.fields,url:a,params:b});return d},load:function(a){var b=this;void 0!=a&&null!=a&&(b.getStore().proxy.extraParams=a),b.getStore().reload()}}),Ext.define("Ins.form.field.TagList",{extend:"Ext.form.field.Tag",alias:["widget.ins_taglist"],config:FormToolkit.config,constructor:function(a){var b=this;Ext.apply(b,{url:null,list:[],fields:["text","value"]}),b.callParent([a])},displayField:"text",valueField:"value",initComponent:function(){var a=this;null!=a.url&&Ext.apply(a,{store:a.buildStore(a.url,a.params)}),Ext.apply(a,{listeners:{change:function(b,c,d,e){if(void 0!=c.length&&c.length>0){for(var f=[],g=0;g<c.length;g++){for(var h=!1,i=0;i<f.length;i++)if(f[i]==c[g]){h=!0;break}h||f.push(c[g])}a.setValue(f)}}}}),FormToolkit.init(this),this.callParent(arguments)},getList:function(){var a=this,b=[];return a.getStore().each(function(a){b.push({text:a.get("text"),value:a.get("value")})}),b},buildStore:function(a,b){var c=this,d=new Ins.data.Store({fields:c.fields,url:a,params:b});return d},load:function(a){var b=this;void 0!=a&&null!=a&&(b.getStore().proxy.extraParams=a),b.getStore().load()}}),Ext.define("Ins.form.field.DateField",{extend:"Ext.form.field.Date",alias:["widget.ins_datefield"],config:FormToolkit.config,format:"Y-m-d",initComponent:function(){FormToolkit.init(this),this.callParent(arguments)},getStringValue:function(){var a=this;return a.getRawValue()}}),Ext.define("Ins.form.field.DateTimeField",{extend:"Ext.form.field.Picker",alias:["widget.ins_datetimefield"],config:FormToolkit.config,initComponent:function(){var a=this;FormToolkit.init(this),a.callParent()},format:"yyyy-MM-dd HH:mm:ss",triggerCls:Ext.baseCSSPrefix+"form-date-trigger",matchFieldWidth:!1,getErrors:function(a){var b=this,c=b.callParent([a]);return c.length>0?c:(svalue=a,a=Ext.Date.parse(a,"Y-m-d H:i:s",!0),""!=svalue&&null==a?(c.push(svalue+" 是无效的日期时间格式 - 必须符合格式：Y-m-d H:i:s"),c):void 0)},createPicker:function(){var a=this,b="d_"+(new Date).getTime();Ext.apply(a,{dateId:b});var c=new Date;a.form=Ext.widget({xtype:"form",layout:"vbox",items:[{xtype:"datepicker",colspan:5,id:b},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"hour",width:55,minValue:0,maxValue:23,allowBlank:!1,value:c.getHours()},{xtype:"ins_displayfield",value:":"},{xtype:"numberfield",name:"min",minValue:0,maxValue:59,width:55,allowBlank:!1,value:c.getMinutes()},{xtype:"ins_displayfield",value:":"},{xtype:"numberfield",name:"seconds",minValue:0,maxValue:59,width:55,allowBlank:!1,value:0}]}],buttons:[{text:"Ok",iconCls:"icon-ok",handler:function(){a.onSelect()}}]});var d=Ext.create("Ext.panel.Panel",{border:!0,floating:!0,items:[a.form],onMouseDown:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}});return d},onSelect:function(a,b){var c=this;if(c.form.isValid()){var d=Ext.getCmp(c.dateId).getValue(),e=c.form.getForm(),f=d.getFullYear(),g=d.getMonth()+1,d=d.getDate(),h=e.findField("hour").getValue(),i=e.findField("min").getValue(),j=e.findField("seconds").getValue();10>g&&(g="0"+g),10>d&&(d="0"+d),10>h&&(h="0"+h),10>i&&(i="0"+i),10>j&&(j="0"+j);var k=c.format.replace("yyyy",f).replace("MM",g).replace("dd",d).replace("HH",h).replace("mm",i).replace("ss",j);c.setValue(k),c.collapse()}},onExpand:function(){},onBlur:function(a){var b=this;b.callParent([a])}}),Ext.define("Ins.form.field.TextAreaField",{extend:"Ext.form.field.TextArea",alias:["widget.ins_textareafield"],config:FormToolkit.config,maxLength:512,initComponent:function(){var a=this;FormToolkit.init(this),0==a.allowBlank&&(a.allowOnlyWhitespace=!1),this.callParent(arguments)}}),Ext.define("Ins.form.field.FileField",{extend:"Ext.form.field.File",alias:["widget.ins_filefield"],config:FormToolkit.config,buttonText:"Browse...",initComponent:function(){FormToolkit.init(this),this.callParent(arguments)}}),Ext.define("Ins.form.field.DisplayField",{extend:"Ext.form.field.Display",alias:["widget.ins_displayfield"],config:FormToolkit.config,initComponent:function(){FormToolkit.init(this),this.callParent(arguments)}}),Ext.define("Ins.form.FieldContainer",{extend:"Ext.form.FieldContainer",alias:["widget.ins_fieldcontainer"],config:{text:null},layout:"hbox",defaults:{},defaultType:"ins_textfield",initComponent:function(){var a=this;null!=a.text&&(Ext.apply(a,{fieldLabel:a.text}),void 0==a.allowBlank||a.allowBlank||Ext.apply(a,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL})),this.callParent(arguments)}}),Ext.define("Ins.form.FieldSet",{extend:"Ext.form.FieldSet",alias:["widget.ins_fieldset"],config:{text:null,columnSize:2,defaultFormFieldWidth:230},margin:"2 2 2 2",collapsible:!0,padding:"5 5 10 5",defaultType:"ins_textfield",initComponent:function(){var a=this;Ext.apply(a,{title:"<span style='font-weight:bold;'>"+a.text+"</span>",layout:{type:"table",columns:a.columnSize},defaults:{width:a.defaultFormFieldWidth}}),this.callParent(arguments)}}),Ext.define("Ins.form.field.RaidoField",{extend:"Ext.form.RadioGroup",alias:["widget.ins_radiofield"],config:{text:null,name:null,columnSize:2,boxs:[],onFieldChange:null},msgTarget:"side",initComponent:function(){var a=this,b=[];void 0==a.allowBlank||a.allowBlank||Ext.apply(a,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL});for(var c=0;c<a.boxs.length;c++)(void 0==a.boxs[c].checked||null==a.boxs[c].checked)&&(a.boxs[c].checked=!1),void 0!=a.value&&null!=a.value&&""!=a.value&&(a.value==a.boxs[c].value&&(a.boxs[c].checked=!0),a.initRadioValue=a.value),b.push({boxLabel:a.boxs[c].text,name:a.name,inputValue:a.boxs[c].value,checked:a.boxs[c].checked,hidden:a.boxs[c].hidden,disabled:a.boxs[c].disabled});Ext.apply(a,{columns:a.columnSize,fieldLabel:a.text,items:b}),null!=a.onFieldChange&&a.addListener("change",a.onFieldChange),this.callParent(arguments)},setValue:function(value){var me=this;eval("value={"+me.name+":value};"),me.callParent([value])},getValue:function(){var a=this,b=a.callParent();return b[a.name]},reset:function(){var a=this;a.setValue(a.initRadioValue)}}),Ext.define("Ins.form.field.CheckboxField",{extend:"Ext.form.CheckboxGroup",alias:["widget.ins_checkboxfield"],config:{text:null,name:null,columnSize:2,boxs:[],onFieldChange:null},blankText:"This field is required",msgTarget:"side",initComponent:function(){var a=this;void 0==a.allowBlank||a.allowBlank||Ext.apply(a,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL});for(var b=[],c=0;c<a.boxs.length;c++){if((void 0==a.boxs[c].checked||null==a.boxs[c].checked)&&(a.boxs[c].checked=!1),void 0!=a.value&&null!=a.value&&""!=a.value){for(var d in a.value)if(a.value[d]==a.boxs[c].value){a.boxs[c].checked=!0;break}a.initRadioValue=a.value}b.push({boxLabel:a.boxs[c].text,name:a.name,inputValue:a.boxs[c].value,checked:a.boxs[c].checked,hidden:a.boxs[c].hidden,disabled:a.boxs[c].disabled})}Ext.apply(a,{columns:a.columnSize,fieldLabel:a.text,items:b}),null!=a.onFieldChange&&a.addListener("change",a.onFieldChange),this.callParent(arguments)},setValue:function(value){var me=this;eval("value={"+me.name+":value};"),me.callParent([value])},getValue:function(){var a=this,b=a.callParent();return b[a.name]},reset:function(){var a=this;a.setValue(a.initRadioValue)}}),Ext.define("Ins.form.field.SliderField",{extend:"Ext.slider.Single",alias:["widget.ins_sliderfield"],config:{text:null,onFieldDrag:null,onFieldChange:null},width:270,minValue:0,maxValue:100,value:0,hideLabel:!1,useTips:!0,initComponent:function(){var a=this;null!=a.text&&Ext.apply(a,{fieldLabel:a.text}),null!=a.onFieldDrag&&a.addListener("drag",a.onFieldDrag),null!=a.onFieldChange&&a.addListener("change",a.onFieldChange),this.callParent(arguments)}}),Ext.define("Ins.form.field.HtmlEditor",{extend:"Ext.form.FieldContainer",mixins:["Ext.form.field.Field"],alias:["widget.ins_htmleditor"],config:FormToolkit.config,ueditorInstance:null,initialized:!1,initComponent:function(){var a=this;null!=a.text&&Ext.apply(a,{fieldLabel:a.text}),void 0==a.allowBlank||a.allowBlank||Ext.apply(a,{afterLabelTextTpl:FormToolkit.REQUIRED_TPL});var b=(void 0==a.id||null==a.id?"":a.id)+"-ueditor-"+(new Date).getTime();a.html='<script id="'+b+'" type="text/plain" name="'+a.name+'"></script>',a.callParent(arguments),a.initField(),a.on("render",function(){var c={elementPathEnabled:!1,wordCount:!1,autoFloatEnabled:!0,autoHeightEnabled:!1,enableContextMenu:!1,enableAutoSave:!1,initialFrameWidth:a.width,initialFrameHeight:a.height,pasteplain:!1,toolbars:[["fontsize","bold","underline","italic","forecolor","backcolor","|","blockquote","insertorderedlist","insertunorderedlist","justifyleft","justifycenter","justifyright","|","link","insertimage","insertvideo","preview"]]};a.ueditorInstance=UE.getEditor(b,c),a.ueditorInstance.ready(function(){a.initialized=!0,void 0!=a._value&&null!=a._value&&""!=a._value&&a.setValue(a._value),null!=a.onFieldFocus&&a.ueditorInstance.addListener("focus",function(){a.onFieldFocus(a)}),a.ueditorInstance.addListener("blur",function(){a.isValid(),null!=a.onFieldBlur&&a.onFieldBlur(a)}),a.ueditorInstance.addListener("contentChange",function(){a.isValid(),null!=a.onFieldChange&&a.onFieldChange(a)})})})},getValue:function(){var a=this,b="";return a.initialized&&(b=a.ueditorInstance.getContent()),a.value=b,b},setValue:function(a){var b=this;return(null===a||void 0===a)&&(a=""),b.initialized?b.ueditorInstance.setContent(a):b._value=a,b},setReadOnly:function(a){var b=this;a?b.ueditorInstance.setDisabled():b.ueditorInstance.setEnabled()},isValid:function(){var a=this;if(0==a.allowBlank){if(""==a.getValue()||void 0==a.getValue()||null==a.getValue())return $("#"+a.getId()+"-innerCt iframe").css({border:"1px solid red"}),!1;$("#"+a.getId()+"-innerCt iframe").css({border:""})}return!0},reset:function(){var a=this;a.setValue(""),$("#"+a.getId()+"-innerCt iframe").css({border:""})}}),Ext.define("Ins.form.Form",{extend:"Ext.form.Panel",alias:["widget.ins_form"],config:{fields:[],columnSize:2,defaultFormFieldWidth:230,actionButtons:[],textWidth:100,textAlign:"top",textStyle:""},defaultType:"ins_textfield",bodyPadding:6,scrollable:!0,extraValues:{},initComponent:function(){var a=this;if(a.fields.length>0)for(var b in a.fields){var c=a.fields[b];null!=c&&void 0==c.width&&"component"!=c.xtype&&"container"!=c.xtype&&"panel"!=c.xtype&&"ins_panel"!=c.xtype&&("ins_fieldset"!=c.xtype?Ext.apply(c,{width:a.defaultFormFieldWidth}):Ext.apply(c,{width:"100%"}))}a.actionButtons.length>0&&Ext.apply(a,{buttons:a.actionButtons}),Ext.apply(a,{items:a.fields,layout:{type:"table",columns:a.columnSize},defaults:{},fieldDefaults:{labelAlign:a.textAlign,margin:"2 5 2 2",labelStyle:a.textStyle}}),this.callParent(arguments)},getField:function(a){var b=this;return b.getForm().findField(a)},getValue:function(a){var b=this,c=b.getForm().findField(a);return void 0==c||null==c?b.extraValues[a]:"ins_datefield"==c.xtype?c.getRawValue():c.getValue()},getValues:function(){var a=this,b=a.getForm().getValues();return Ext.applyIf(b,a.extraValues),b},setExtraValues:function(a){var b=this;Ext.applyIf(b.extraValues,a)},setValue:function(a,b){var c=this;c.getField(a).setValue(b)},valid:function(a){var b=this;b.getForm().isValid()?void 0!=a.onSuccess&&null!=a.onSuccess&&a.onSuccess(b):void 0!=a.onError&&null!=a.onError&&a.onError(b)},loadData:function(a){var b=this;b.getForm().load({url:a.url,waitMsg:"Loading...",params:a.params,failure:function(a,c){b.getForm().reset()},success:function(c,d){void 0!=a.onSuccess&&null!=a.onSuccess&&a.onSuccess(b,d)}})},send:function(a){var b=this;b.valid({onSuccess:function(c){void 0!=a.confirm&&null!=a.confirm?Message.ask(a.confirm,function(c){c&&b.sendBase(a)}):b.sendBase(a)},onError:function(b){void 0!=a.onValidError&&null!=a.onValidError&&a.onValidError(b)}})},sendBase:function(a){var b=this,c=void 0==a.maskText||null==a.maskText?"Executing...":a.maskText;b.submit({url:a.url,waitMsg:c,success:function(b,c){null!=a.onSuccess&&a.onSuccess(c.result)},failure:function(a,b){try{return App.errorHandler(b.response)}catch(c){var d="The operation failed or system error";return TopMessage.error(d),!1}}})},hideFields:function(a){var b=this;if(void 0!=a&&a.length>0)for(var c in a){var d=a[c];b.getField(d).hide()}},showFields:function(a){var b=this;if(void 0!=a&&a.length>0)for(var c in a){var d=a[c];b.getField(d).show()}},reset:function(a){var b=this;b.extraValues={};var c=b.getForm().getFields().items;for(var d in c){var e=c[d],f=e.xtype;(void 0!=a&&null!=a||"ins_hiddenfield"!=f)&&e.reset()}}}),Ext.define("Ins.form.OprFormWindow",{extend:"Ins.window.Window",alias:"widget.ins_oprformwindow",config:{fields:[],url:null,success:null,mode:null,defaultFormFieldWidth:230,onBeforeSave:null,onAfterClickResetButton:null,columnSize:2,onBeforeShow:null,onBeforeHide:null,autoMessage:!0,onAfterSubmit:null},modal:!1,maximizable:!0,initComponent:function(){var a=this,b=Ext.create("Ins.form.Form",{xtype:"ins_form",columnSize:a.columnSize,defaultFormFieldWidth:a.defaultFormFieldWidth,fields:a.fields});a.form=b,Ext.apply(a,{views:[b],dockedItems:[{id:"toolbar_"+a.getId(),xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{id:"resetBtn_"+a.getId(),text:"Reset",iconCls:"icon-clear",handler:function(){b.reset(),null!=a.onAfterClickResetButton&&a.onAfterClickResetButton(b)}},{text:"Save",id:"saveBtn_"+a.getId(),iconCls:"icon-ok",handler:function(){if(b.getForm().isValid()){var c=!0;if(null!=a.onBeforeSave&&void 0!=a.onBeforeSave&&(c=a.onBeforeSave(a.getForm())),!c)return;a.oprRecord(b)}}}]}],listeners:{beforehide:function(){return void 0!=a.onBeforeHide&&null!=a.onBeforeHide?a.onBeforeHide(a.getForm()):!0},close:function(){a.getForm().reset()},beforeshow:function(){return void 0!=a.onBeforeShow&&null!=a.onBeforeShow?a.onBeforeShow(a.getForm()):!0}}}),a.callParent(arguments)},showAsAddMode:function(a){var b=this;return App.getCom("resetBtn_"+b.getId()).setHidden(!1),b.isHidden()?(b.setTitle(void 0!=a.title&&null!=a.title?a.title:"Add"),App.getCom("toolbar_"+b.getId()).setVisible(!0),FormToolkit.setFormFieldsReadonly(b.getForm(),!1),b.mode="ADD",b.url=a.url,b.success=a.success,b.onBeforeSave=a.onBeforeSave,b.onBeforeHide=a.onBeforeHide,b.onBeforeShow=a.onBeforeShow,b.show(),void b.alignToCenter()):(TopMessage.warn("Please complete the current operation..."),!1)},showAsEditMode:function(a){var b=this;return App.getCom("resetBtn_"+b.getId()).setHidden(!0),b.isHidden()?(b.setTitle(void 0!=a.title&&null!=a.title?a.title:"Edit"),App.getCom("toolbar_"+b.getId()).setVisible(!0),FormToolkit.setFormFieldsReadonly(b.getForm(),!1),b.mode="EDIT",b.url=a.updateUrl,b.success=a.success,b.onBeforeSave=a.onBeforeSave,b.onBeforeHide=a.onBeforeHide,b.onBeforeShow=a.onBeforeShow,void b.getForm().loadData({url:a.loadUrl,params:a.params,onSuccess:function(c,d){b.show(),b.alignToCenter(),null!=a.onSuccess&&a.onSuccess(c,d)}})):(TopMessage.warn("Please complete the current operation"),!1)},showAsViewMode:function(a){var b=this;return b.isHidden()?(b.setTitle(void 0!=a.title&&null!=a.title?a.title:"View"),App.getCom("toolbar_"+b.getId()).setVisible(!1),b.mode="VIEW",FormToolkit.setFormFieldsReadonly(b.getForm(),!0),b.onBeforeHide=a.onBeforeHide,b.onBeforeShow=a.onBeforeShow,void b.getForm().loadData({url:a.loadUrl,params:a.params,onSuccess:function(c,d){b.show(),b.alignToCenter(),null!=a.onSuccess&&a.onSuccess(c,d)}})):(TopMessage.warn("Please complete the current operation"),!1)},getForm:function(){var a=this;return a.form},getField:function(a){var b=this;return b.getForm().getField(a)},setValue:function(a,b){var c=this;c.getForm().setValue(a,b)},getValue:function(a){var b=this;b.getForm().getValue(a)},oprRecord:function(a){var b=this;Message.ask("Are you sure?",function(c){c&&a.submit({url:b.url,waitMsg:"Loading...",success:function(a,c){var d=!0;if(null!=b.onAfterSubmit&&(d=b.onAfterSubmit(a,c)),d){b.getForm().reset();try{b.getForm().setValue("id","")}catch(e){throw new Error("not id field")}b.hide(),b.autoMessage&&TopMessage.info("Success!"),null!=b.success&&b.success()}},failure:function(a,b){try{return App.errorHandler(b.response)}catch(c){var d="The operation failed or system error";return TopMessage.error(d),!1}}})})}}),Ext.define("Ins.grid.Grid",{extend:"Ext.grid.Panel",config:{url:null,fields:[],gridColumns:[],pkField:"id",loadOnShow:!0,hideTitle:!1,hideTableHead:!1,hidePagingBar:!1,actionButtons:[],actionButtonsSort:[],checkable:!0,defaultColumnWidth:120,autoColunmWidth:!1,valueMapper:null,selectMode:"MULTI",selectCheckOnly:!1,exportToExcel:!1,pageSize:20,customPage:[10,20,30,50,100],onBeforeSearch:null,editable:!1,editType:"row",disabledColumnsSortable:!1,onLoadComplete:null,onRowClick:null,onRowDbClick:null,onContextMenuClick:null,onRowSelect:null,onRowDeSelect:null,onRowSelectChange:null,hideRowNumber:!0,rowNumberText:"RowNumber",rowNumberWidth:50,showActionColumn:!0,actionColumnMenu:[],actionColumnClick:null,actionColumnLocked:!0,acrossSelect:!1,model:"server",localData:[],condition:{},onConditionShow:null,_childdActionButtons:[],showSelCheck:null},loadMask:!0,columnLines:!0,invalidateScrollerOnRefresh:!1,enableLocking:!1,disableSelection:!1,resizable:!1,viewConfig:{stripeRows:!0,enableTextSelection:!0},initComponent:function(){var a=this;if(a.acrossSelect&&Ext.apply(a,{acrossSelection:new Ext.util.HashMap}),Ext.apply(a,{title:void 0==a.title||null==a.title?"Unknown grid":a.title}),Ext.apply(a,{forceFit:a.autoColunmWidth}),a.hidePagingBar&&(a.pageSize=1e3),void 0==a.store||null==a.store){var b=null;"server"===a.model?b=new Ins.data.Store({remoteSort:!0,fields:a.fields,url:a.url,idProperty:a.pkField,pageSize:a.pageSize,autoLoad:a.loadOnShow,listeners:{beforeload:function(a,b,c){},load:function(b,c,d,e){null!=a.onLoadComplete&&a.onLoadComplete(a.getStore()),a.acrossSelect&&a.getSelectionModel().select(a.acrossSelection.getValues(),!0)}}}):"local"===a.model&&(b=Ext.create("Ins.data.Store",{fields:a.fields,data:a.localData,idProperty:a.pkField,pageSize:a.pageSize,autoLoad:a.loadOnShow})),Ext.apply(a,{store:b})}if(Ext.apply(a,{header:!a.hideTitle,hideHeaders:a.hideTableHead}),a.editable){var c=null;"row"===a.editType?c=Ext.create("Ext.grid.plugin.RowEditing",{clicksToMoveEditor:1,autoCancel:!1}):"cell"===a.editType&&(c=new Ext.grid.plugin.CellEditing({clicksToEdit:1})),Ext.apply(a,{plugins:[c]})}var d={itemclick:function(b,c,d,e,f,g){a.currentRecord=c,null!=a.onRowClick&&a.onRowClick(c,e,f)},itemdblclick:function(b,c,d,e,f,g){a.currentRecord=c,null!=a.onRowDbClick&&a.onRowDbClick(c,e,f)},itemcontextmenu:function(b,c,d,e,f,g){a.currentRecord=c,null!=a.onContextMenuClick&&(f.preventDefault?f.preventDefault():f.returnValue=!1,a.onContextMenuClick(c,e,f))},select:function(b,c,d,e){if(a.currentRecord=c,null!=a.onRowSelect&&a.onRowSelect(c,d),a.acrossSelect&&(a.acrossSelection.containsKey(c.data[a.pkField])||a.acrossSelection.add(c.data[a.pkField],c)),null!=a.showSelCheck){var f=a.showSelCheck(c,d);f||a.getSelectionModel().deselect(c)}},deselect:function(b,c,d,e){a.currentRecord=c,null!=a.onRowDeSelect&&a.onRowDeSelect(c,d),a.acrossSelect&&a.acrossSelection.containsKey(c.data[a.pkField])&&a.acrossSelection.removeAtKey(c.data[a.pkField])},selectionchange:function(b,c,d){null!=a.onRowSelectChange&&a.onRowSelectChange(c)}};Ext.apply(a,{listeners:d}),a.acrossSelect&&(a.selectCheckOnly=!0),a.checkable&&Ext.apply(a,{selModel:{selType:"checkboxmodel",checkOnly:a.selectCheckOnly,mode:a.selectMode,renderer:function(b,c,d,e,f,g,h){c.tdStyle="vertical-align:middle;";var i=!0;return null!=a.showSelCheck&&(i=a.showSelCheck(d,e)),i?'<div class="'+Ext.baseCSSPrefix+'grid-row-checker"> </div>':""}}});var e=[];if(a.hideRowNumber||e.push({xtype:"rownumberer",dataIndex:"ROWNUMBER_COL",text:a.rowNumberText,width:a.rowNumberWidth,locked:!0}),a.actionColumnMenu.length>0){a.quickMenu=Ext.create("Ins.menu.Menu",{id:a.getId()+"_action_menu",items:a.actionColumnMenu});var f=[{iconCls:"icon-list2",tooltip:"Operation list",handler:function(b,c,d,e,f){var g=b.getStore().getAt(c);a.fireEvent("itemclick",b,g,null,c,f,null),a.currentRecord=g;var h=!0;null!=a.actionColumnClick&&(h=a.actionColumnClick(g)),h&&a.quickMenu.showAt(f.getXY())}}];a.showActionColumn&&e.push({dataIndex:"OPRATE_COL",text:"",align:"center",menuDisabled:!0,sortable:!1,xtype:"actioncolumn",hideable:!1,locked:a.actionColumnLocked,resizable:!1,width:40,items:f,renderer:function(a,b,c,d,e,f,g){return b.tdStyle="vertical-align:middle;",a}})}for(var g in a.gridColumns){var h=Ext.clone(a.gridColumns[g]);if(void 0!=h.columns&&null!=h.columns&&h.columns.length>0)for(var i=0;i<h.columns.length;i++)a._setColumn(h.columns[i]);else a._setColumn(h);e.push(h)}Ext.apply(a,{columns:e});var j=[];if(a._childdActionButtons.length>0)for(var g in a._childdActionButtons)j.push(a._childdActionButtons[g]);if(void 0!=a.condition.fields&&null!=a.condition.fields&&a.condition.fields.length>0){Ext.applyIf(a.condition,{columnSize:2,defaultFieldWidth:200});var k=a.getId()+"_query_btn",l=Ext.create("Ins.form.Form",{xtype:"ins_form",title:"Query criteria (Clear can view all records)",columnSize:a.condition.columnSize,textAlign:"top",textStyle:"font-weight:bold",defaultFormFieldWidth:a.condition.defaultFieldWidth,fields:a.condition.fields,tools:[{type:"close Query criteria panel",tooltip:"Close",handler:function(){App.getCom(a.getId()+"_query_btn_menu").hide()}}],actionButtons:[{text:"Clear",iconCls:"icon-clear",handler:function(){l.reset(!0)}},{text:"Search",iconCls:"icon-ok",handler:function(){var b=!0;if(void 0!=a.onBeforeSearch&&null!=a.onBeforeSearch&&(b=a.onBeforeSearch(l)),0!=b){var c=0;for(var d in a.condition.fields){var e=a.condition.fields[d],f=e.xtype;if("ins_hiddenfield"!=f){var g=l.getField(e.name).getValue();null!=g&&""!=g&&c++}}var h=void 0!=a.condition.buttonText&&null!=a.condition.buttonText?a.condition.buttonText:"Search";c>0&&(h+="&nbsp;<span style='color:blue;font-weight:bold;'>&nbsp;(+"+c+")</span>"),Ext.getCmp(k).setText(h),App.getCom(a.getId()+"_query_btn_menu").hide(),a.search(l.getForm().getValues())}}}]});Ext.apply(a,{conditionForm:l}),j.push({id:k,iconCls:"icon-search",text:void 0!=a.condition.buttonText&&null!=a.condition.buttonText?a.condition.buttonText:"Search",menu:new Ins.menu.Menu({id:a.getId()+"_query_btn_menu",items:[l]}),listeners:{menushow:function(){null!=a.onConditionShow&&a.onConditionShow(a.getConditionForm())}}})}a.exportToExcel&&j.push({id:a.getId()+"_export_btn",iconCls:"icon-export",text:"Export",handler:function(){for(var b=a,c=b.columns,d=b.gridColumns,e=Ext.JSON.encode(d),f="[",g=0;g<c.length;g++)"OPRATE_COL"!=c[g].dataIndex&&(f+='{"text":"'+c[g].text+'","dataIndex":"'+c[g].dataIndex+'","width":"'+c[g].cellWidth+'"}',c.length-1!=g&&(f+=","));f+="]";var h=b.url,i=new Object;if(void 0!=a.condition.fields&&null!=a.condition.fields&&a.condition.fields.length>0){var j=a.getConditionForm().getForm().getValues();void 0!=j&&null!=j&&(i=Ext.clone(j))}void 0!=a.loadParams&&null!=a.loadParams&&Ext.applyIf(i,a.loadParams),i.gridColumns=e,i.columnsJson=f,i.gridUrl=h,i.total=b.getStore().totalCount,Messager.send({url:CTX_PATH+"/insexport/excel",data:i,
confirm:"Export all records?",maskCmp:b,maskText:"Export...",onSuccess:function(a){a.success?(window.location.href=a.fileInfo.baseUrl,TopMessage.info("Success")):TopMessage.info("Failure")}})}});for(var g=0;g<a.actionButtons.length;g++)j.push(a.actionButtons[g]);if(j.length>0&&"-"==j[j.length-1]&&j.pop(),a.actionButtonsSort.length>0){var m=[];for(var g in a.actionButtonsSort)if("|"!=a.actionButtonsSort[g])for(var i in j){var n=j[i].text;(void 0==n||null==n||""==n)&&(n=j[i].html),n==a.actionButtonsSort[g]&&(m.push(j[i]),delete j[i])}else m.push("-");for(var g in j)"-"!=j[g]&&"|"!=j[g]&&m.push(j[g]);j=Ext.clone(m)}a.actionButtons=j;var o=[];if(a.actionButtons.length>0){var p={xtype:"toolbar",items:a.actionButtons,dock:"top"};Ext.apply(a,{actionToolbar:p}),o.push(p)}if(!a.hidePagingBar){var q=[],r=!1,s=[];for(var g in a.customPage){a.pageSize==a.customPage[g]&&(r=!0);var t={text:a.customPage[g],value:a.customPage[g]};s.push(t),r&&(q=["-",{xtype:"ins_list",width:58,list:s,value:a.pageSize,onFieldChange:function(b,c,d,e){a.getStore().pageSize=c,a.getStore().load({page:1,start:0})}}])}if(!r)return void(window.console&&console.error("pageSize 必须等于 customPage中的配置项！"));o.push({xtype:"pagingtoolbar",dock:"bottom",xtype:"pagingtoolbar",displayInfo:!0,store:a.store,items:q})}Ext.apply(a,{dockedItems:o}),a.addListener("beforedestroy",function(){(void 0!=a.conditionForm||null!=a.conditionForm)&&Ext.destroy(a.conditionForm),(void 0!=a.quickMenu||null!=a.quickMenu)&&Ext.destroy(a.quickMenu)}),a.callParent(arguments)},_setColumn:function(a){var b=this;void 0!=a.dataIndex&&void 0==a.sortable&&Ext.apply(a,{sortable:!b.disabledColumnsSortable}),void 0!=a.width||b.autoColunmWidth||Ext.apply(a,{width:b.defaultColumnWidth});for(var c in b.valueMapper){b.valueMapper[c];if(a.dataIndex==c){Ext.apply(a,{renderer:b.valueMapper[c]});break}}(void 0==a.renderer||null==a.renderer)&&"checkcolumn"!=a.xtype&&Ext.apply(a,{renderer:function(a,b){return b.tdStyle="vertical-align:middle;",Ext.util.Format.htmlEncode(a)}})},load:function(a){var b=this;b.setDisabled(!1),void 0!=a&&null!=a&&(b.loadParams=a,b.getStore().proxy.extraParams=b.loadParams),b.getStore().reload()},search:function(a){var b=this;if(b.setDisabled(!1),void 0!=a&&null!=a){var c=Ext.clone(a);void 0!=b.loadParams&&null!=b.loadParams&&Ext.applyIf(c,b.loadParams),b.getStore().proxy.extraParams=c}b.getStore().currentPage=1,b.getStore().reload({page:1,start:0})},searchByCondition:function(){var a=this;a.search(a.getConditionForm().getForm().getValues())},getCurrentRecord:function(){var a=this;return a.currentRecord},getSelectedView:function(){var a=this,b=null;b=a.acrossSelect?a.acrossSelection.getValues():a.getSelectionModel().getSelection();var c=a.getIdSer(b,a.pkField);return{count:b.length,idSer:c,idArr:Ext.JSON.decode(c),records:b}},getIdSer:function(a,b){var c="[";for(var d in a){var e=a[d].data[b];c+='"'+e+'",'}return c=c.substring(0,c.length-1),c+="]","]"==c&&(c="[]"),c},select:function(a){var b=this,c=[];for(var d in a){var e=a[d],f=b.getStore().findRecordById(b.pkField,e);null!=f&&c.push(f)}b.getSelectionModel().select(c)},selectAcrossSelect:function(a){var b=this;for(var c in a){var d=a[c];b.acrossSelection.add(d.data[b.pkField],d)}b.getSelectionModel().select(b.acrossSelection.getValues(),!0)},clearSelect:function(){var a=this;a.acrossSelect&&a.acrossSelection.clear(),a.getStore().getTotle()>0&&a.getSelectionModel().selectAll(),a.getSelectionModel().deselectAll()},selectCurrentPageRecords:function(){var a=this;a.getSelectionModel().selectAll()},getConditionForm:function(){var a=this;return a.conditionForm},setToolbarDisabled:function(a){var b=this;b.actionToolbar.setDisabled(a)}}),Ext.define("Ins.grid.CrudGrid",{extend:"Ins.grid.Grid",config:{urlConfig:{},dataSet:[],formFields:[],permission:{add:!0,update:!0,remove:!0,view:!0},gridColumns:[],condition:[],conditionColumnSize:2,conditionWidth:200,columnSize:2,defaultFormFieldWidth:230,defaultCondFieldWidth:200,onBeforeSearch:null,onBeforeShowAddForm:null,onBeforeShowEditForm:null,onBeforeShowViewForm:null,onAfterShowAddForm:null,onAfterShowEditForm:null,onAfterShowViewForm:null,onAfterDelete:null,onBeforeDelete:null,onBeforeSaveAdd:null,onBeforeSaveEdit:null,onAfterFormSubmit:null,formWindowHeight:null,formWindowWidth:510,formWindowMaxHeight:null,formWindowMaxWidth:null,formWindowModal:!1,labelConfig:{add:{text:null,iconCls:null},update:{text:null,iconCls:null},view:{text:null,iconCls:null},remove:{text:null,iconCls:null},query:{text:null,iconCls:null}}},initComponent:function(){var a=this,b=[];for(var c in a.dataSet){var d=a.dataSet[c];b.push(d.name)}Ext.apply(a,{fields:b});var e=[];for(var c in a.gridColumns){var f=Ext.clone(a.gridColumns[c]),g=null;if(void 0!=f.columns&&null!=f.columns&&f.columns.length>0){g=Ext.clone(f),g.columns=[];for(var h=0;h<f.columns.length;h++)g.columns.push(a.getColumnDefByName(f.columns[h]))}else g=a.getColumnDefByName(f);e.push(g)}Ext.apply(a,{gridColumns:e});var i=[];for(var c in a.formFields){var j=a.formFields[c],k=null;if(void 0!=j.forData&&null!=j.forData||void 0!=j.name&&null!=j.name)k=a.getFieldDefByName(Ext.clone(j)),null!=k&&void 0==k.width&&"component"!=k.xtype&&"container"!=k.xtype&&"panel"!=k.xtype&&"ins_panel"!=k.xtype&&"ins_fieldcontainer"!=k.xtype&&Ext.apply(k,{width:a.defaultFormFieldWidth});else if(void 0!=j.items&&null!=j.items){k=Ext.clone(j),k.items=[];for(var h in j.items)null!=j.items[h]&&void 0==j.items[h].width&&"component"!=j.items[h].xtype&&"container"!=j.items[h].xtype&&"panel"!=j.items[h].xtype&&"ins_panel"!=j.items[h].xtype&&"ins_fieldcontainer"!=j.items[h].xtype&&Ext.apply(j.items[h],{width:a.defaultFormFieldWidth}),k.items.push(a.getFieldDefByName(Ext.clone(j.items[h])))}i.push(k)}var l={fields:i,modal:a.formWindowModal,defaultFormFieldWidth:a.defaultFormFieldWidth,columnSize:a.columnSize,onBeforeHide:function(a){a.getForm().reset()}};null!=a.onAfterFormSubmit&&(l.onAfterSubmit=a.onAfterFormSubmit),null!=a.formWindowHeight&&(l.height=a.formWindowHeight),null!=a.formWindowWidth&&(l.width=a.formWindowWidth),null!=a.formWindowMaxHeight&&(l.maxHeight=a.formWindowMaxHeight),null!=a.formWindowMaxWidth&&(l.maxWidth=a.formWindowMaxWidth);var m=Ext.create("Ins.form.OprFormWindow",l);Ext.apply(a,{form:m,url:a.urlConfig.loadAll}),void 0!=a.urlConfig.add&&null!=a.urlConfig.add&&a.permission.add&&a._childdActionButtons.push({id:a.getId()+"_add_btn",text:null!=a.labelConfig.add.text?a.labelConfig.add.text:"Add",iconCls:null!=a.labelConfig.add.iconCls?a.labelConfig.add.iconCls:"icon-add",handler:function(b){var c=!0;null!=a.onBeforeShowAddForm&&(c=a.onBeforeShowAddForm(a.getForm())),c&&(m.showAsAddMode({url:a.urlConfig.add,onBeforeSave:a.onBeforeSaveAdd,success:function(b){a.load()}}),null!=a.onAfterShowAddForm&&a.onAfterShowAddForm(a.getForm()))}}),void 0!=a.urlConfig.remove&&null!=a.urlConfig.remove&&a.permission.remove&&a._childdActionButtons.push({id:a.getId()+"_delete_btn",text:null!=a.labelConfig.remove.text?a.labelConfig.remove.text:"Delete",iconCls:null!=a.labelConfig.remove.iconCls?a.labelConfig.remove.iconCls:"icon-delete",handler:function(b){var c=a.getSelectedView();if(0==c.count)return void Message.msg("Please select at least one record","WARN");var d=!0;void 0!=a.onBeforeDelete&&null!=a.onBeforeDelete&&(d=a.onBeforeDelete(a.getSelectedView())),d&&Messager.send({confirm:"Delete the selected <span style='font-size:25px;color:red'>"+c.count+"</span> records？",maskCmp:a,url:a.urlConfig.remove,data:{SELECT_ITEMS:c.idSer},onSuccess:function(b){a.load(),null!=a.onAfterDelete&&a.onAfterDelete(),TopMessage.info("Success")}})}});var n=a.actionColumnMenu.length;(a.permission.update&&void 0!=a.urlConfig.update&&null!=a.urlConfig.update&&void 0!=a.urlConfig.load&&null!=a.urlConfig.load||a.permission.view&&void 0!=a.urlConfig.load&&null!=a.urlConfig.load)&&n>0&&a.actionColumnMenu.unshift("-"),void 0!=a.urlConfig.load&&null!=a.urlConfig.load&&a.permission.view&&a.actionColumnMenu.unshift({id:a.getId()+"_view_btn",iconCls:null!=a.labelConfig.view.iconCls?a.labelConfig.view.iconCls:"icon-view",text:null!=a.labelConfig.view.text?a.labelConfig.view.text:"View",handler:function(){var b=!0;if(void 0!=a.onBeforeShowViewForm&&null!=a.onBeforeShowViewForm&&(b=a.onBeforeShowViewForm(a.getForm())),b){var c={};c[a.pkField]=a.getCurrentRecord().data[a.pkField],m.showAsViewMode({loadUrl:a.urlConfig.load,params:c,onSuccess:function(b,c){null!=a.onAfterShowViewForm&&a.onAfterShowViewForm(b,c)}})}}}),void 0!=a.urlConfig.update&&null!=a.urlConfig.update&&void 0!=a.urlConfig.load&&null!=a.urlConfig.load&&a.permission.update&&a.actionColumnMenu.unshift({id:a.getId()+"_edit_btn",iconCls:null!=a.labelConfig.update.iconCls?a.labelConfig.update.iconCls:"icon-edit",text:null!=a.labelConfig.update.text?a.labelConfig.update.text:"Edit",handler:function(){var b=!0;if(void 0!=a.onBeforeShowEditForm&&null!=a.onBeforeShowEditForm&&(b=a.onBeforeShowEditForm(a.getForm())),b){var c={};c[a.pkField]=a.getCurrentRecord().data[a.pkField],m.showAsEditMode({loadUrl:a.urlConfig.load+"?nolog=y",updateUrl:a.urlConfig.update,onBeforeSave:a.onBeforeSaveEdit,params:c,success:function(b){a.load()},onSuccess:function(b,c){null!=a.onAfterShowEditForm&&a.onAfterShowEditForm(b,c)}})}}});var o={};if(a.condition.length>0){o.columnSize=a.conditionColumnSize,o.defaultFieldWidth=a.conditionWidth,o.onBeforeSearch=a.onBeforeSearch;var p=[];for(var c in a.condition){var j=a.condition[c],q=null;"string"==typeof j?q=a.getConditionField(j):"object"==typeof j&&(q=j),p.push(q),o.fields=p}Ext.apply(a.condition,o)}a.addListener("beforedestroy",function(){(void 0!=a.form||null!=a.form)&&Ext.destroy(a.form)}),a.callParent(arguments)},getFieldDefByName:function(a){var b=this;for(var c in b.dataSet){var d=b.dataSet[c];if(d.name==a.forData)return Ext.apply(a,{fieldLabel:d.text,text:d.text,name:d.name}),a}return null!=a.name&&void 0!=a.name?(Ext.apply(a,{fieldLabel:a.text,text:a.text}),a):void(window.console&&console.error("没有发现 dataSet 中配置的该表单字段。"))},getColumnDefByName:function(a){var b=this,c=null;"string"==typeof a?c={forData:a}:"object"==typeof a&&(c=a);for(var d in b.dataSet){var e=b.dataSet[d];if(e.name==c.forData){Ext.apply(c,{text:e.text,dataIndex:e.name});break}}return c},getConditionField:function(a){var b=this,c=null,d=!1;for(var e in b.formFields){if(void 0!=b.formFields[e].items){for(var f in b.formFields[e].items)if(b.formFields[e].items[f].forData==a){c=Ext.clone(b.formFields[e].items[f]),c.colspan=1,c.width=b.conditionWidth,d=!0;break}}else{var g=b.formFields[e];g.forData==a&&(c=Ext.clone(g),c.colspan=1,c.width=b.conditionWidth,d=!0)}if(d)break}return Ext.apply(c,{name:a,allowBlank:!0,afterLabelTextTpl:"",suffixText:null}),b.getFieldDefByName(c)},getForm:function(){var a=this;return a.form.getForm()}}),Ext.define("Ins.grid.ChooserGrid",{extend:"Ins.grid.Grid",alias:"widget.ins_choosergrid",config:{onChooserSelect:null,onBeforeChooserSelect:null,onChooserCancel:null,isAskWindow:!0},selectMode:"MULTI",initComponent:function(){var a=this;a._childdActionButtons=[{text:"Ok",iconCls:"icon-ok",handler:function(b){var c=a.getSelectedView();if(0==c.count)return void TopMessage.warn("Please select at least one record");var d=!0;void 0!=a.onBeforeChooserSelect&&null!=a.onBeforeChooserSelect&&(d=a.onBeforeChooserSelect()),d&&(a.isAskWindow?Message.ask("Add the selected <span style='font-size:25px;color:red'>"+c.count+"</span> records？",function(b){b&&null!=a.onChooserSelect&&a.onChooserSelect(c)}):null!=a.onChooserSelect&&a.onChooserSelect(c))}},{text:"Cancel",iconCls:"icon-delete",handler:function(b){null!=a.onChooserCancel&&a.onChooserCancel()}}],"MULTI"==a.selectMode?a._childdActionButtons.push("-",{iconCls:"icon-clear",text:"Clear",handler:function(){a.clearSelect()}}):"SINGLE"==a.selectMode&&(a.onRowClick=function(b){var c=!0;if(void 0!=a.onBeforeChooserSelect&&null!=a.onBeforeChooserSelect&&(c=a.onBeforeChooserSelect()),c){var d=a.getSelectedView();null!=a.onChooserSelect&&a.onChooserSelect(d)}}),Ext.apply(a,{hideTitle:!0,hideRowNumber:!0,checkable:"MULTI"==a.selectMode,acrossSelect:"MULTI"==a.selectMode}),a.callParent(arguments)}}),Ext.define("Ins.chooser.ChooserGirdWindow",{extend:"Ins.window.Window",alias:"widget.ins_choosergridwindow",config:{onSelect:null,onBeforeSelect:null,beforeShowClear:!0,selectMode:"MULTI",url:null,fields:null,pkField:"id",hidePagingBar:!1,pageSize:20,gridColumns:null,loadOnShow:!0,actionButtons:[],actionButtonsSort:[],valueMapper:null,condition:{}},width:595,height:380,title:"unknown Chooser",modal:!0,initComponent:function(){var a=this,b=Ext.create("Ins.grid.ChooserGrid",{url:a.url,fields:a.fields,pkField:a.pkField,pageSize:a.pageSize,gridColumns:a.gridColumns,loadOnShow:a.loadOnShow,actionButtons:a.actionButtons,actionButtonsSort:a.actionButtonsSort,condition:a.condition,hidePagingBar:a.hidePagingBar,selectMode:a.selectMode,valueMapper:a.valueMapper,onChooserCancel:function(){a.hide()},onBeforeChooserSelect:a.onBeforeSelect,onChooserSelect:function(b){null!=a.onSelect&&a.onSelect(b),a.hide()}});Ext.apply(a,{grid:b,views:[b]}),a.onBeforeShow=function(){a.beforeShowClear&&a.grid.clearSelect(),a.grid.load()},a.actionButtons=[],a.callParent(arguments)},getGrid:function(){var a=this;return a.grid}}),Ext.define("Ins.chooser.ChooserGirdField",{extend:"Ext.form.field.Picker",alias:["widget.ins_choosergridfield"],config:FormToolkit.config,initComponent:function(){var a=this;FormToolkit.init(this),a.callParent()},editable:!1,constructor:function(a){var b=this;Ext.apply(b,{onSelect:null,onBeforeSelect:null,chooserWidth:void 0==b.chooserWidth||null==b.chooserWidth?595:b.chooserWidth,chooserHeight:void 0==b.chooserHeight||null==b.chooserHeight?330:b.chooserHeight,selectMode:void 0==b.selectMode||null==b.selectMode?"SINGLE":"MULTI",url:null,fields:null,pkField:"id",hidePagingBar:void 0==b.isHidePagingBar||null==b.isHidePagingBar?!1:b.isHidePagingBar,gridColumns:null,valueMapper:null,loadOnShow:!0,actionButtons:[],actionButtonsSort:[],condition:{}}),b.callParent([a]),Ext.apply(b,{grid:Ext.create("Ins.grid.ChooserGrid",{url:b.url,fields:b.fields,pkField:b.pkField,hidePagingBar:b.hidePagingBar,gridColumns:b.gridColumns,loadOnShow:b.loadOnShow,actionButtons:b.actionButtons,actionButtonsSort:b.actionButtonsSort,condition:b.condition,valueMapper:b.valueMapper,selectMode:b.selectMode,isAskWindow:!1,onChooserCancel:function(){b.collapse()},onBeforeChooserSelect:b.onBeforeSelect,onChooserSelect:function(a){null!=b.onSelect&&b.onSelect(a),b.collapse()}})})},triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",matchFieldWidth:!1,grid:null,createPicker:function(){var a=this,b=Ext.create("Ext.panel.Panel",{border:!0,floating:!0,width:a.chooserWidth,height:a.chooserHeight,layout:"fit",shadow:!0,maxHeight:350,items:[a.grid]});return b},onExpand:function(){var a=this;a.grid.clearSelect(),a.grid.load()},onBlur:function(a){var b=this;b.callParent([a])}}),Ext.define("Ins.chooser.ChooserTreeField",{extend:"Ext.form.field.Picker",alias:["widget.ins_choosertreefield"],config:FormToolkit.config,initComponent:function(){var a=this;FormToolkit.init(this),a.callParent()},editable:!1,constructor:function(a){var b=this;Ext.apply(b,{onSelect:null,onBeforeSelect:null,width:void 0==b.chooserWidth||null==b.chooserWidth?250:b.chooserWidth,url:null,isSearch:null==b.isSearch||void 0==b.isSearch?!0:b.isSearch}),b.callParent([a]),b.tree=Ext.create("Ins.tree.ChooserTree",{isSearch:b.isSearch,url:b.url,onChooserCancel:function(){b.collapse()},onBeforeChooserSelect:b.onBeforeSelect,onChooserSelect:function(a){null!=b.onSelect&&b.onSelect(a),b.collapse()}})},triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",matchFieldWidth:!1,createPicker:function(){var a=this,b=Ext.create("Ext.panel.Panel",{border:!0,floating:!0,width:a.chooserWidth,height:a.chooserHeight,layout:"fit",maxHeight:450,minHeight:250,shadow:!0,items:[a.tree]});return b},onExpand:function(){var a=this;a.tree.reloadExpand()},onBlur:function(a){var b=this;b.callParent([a])}}),Ext.define("Ins.chooser.ChooserGridButton",{extend:"Ext.button.Button",alias:"widget.ins_choosergridbutton",config:{onSelect:null,onBeforeSelect:null,beforeShowClear:!0,selectMode:"MULTI",gridUrl:null,fields:null,pkField:"id",hidePagingBar:!1,pageSize:20,gridColumns:null,loadOnShow:!0,actionButtons:[],actionButtonsSort:[],valueMapper:null,condition:{},chooserWidth:595,chooserHeight:380,onBeforeShowChooser:null},initComponent:function(){var a=this;(void 0==a.text||null==a.text||""==a.text)&&(a.text="unknown Chooser"),(void 0==a.iconCls||null==a.iconCls||""==a.iconCls)&&(a.iconCls="icon-pageadd");var b=Ext.create("Ins.grid.ChooserGrid",{isAskWindow:!1,width:a.chooserWidth,height:a.chooserHeight,url:a.gridUrl,fields:a.fields,pkField:a.pkField,pageSize:a.pageSize,gridColumns:a.gridColumns,loadOnShow:a.loadOnShow,actionButtons:a.actionButtons,actionButtonsSort:a.actionButtonsSort,condition:a.condition,hidePagingBar:a.hidePagingBar,selectMode:a.selectMode,valueMapper:a.valueMapper,onChooserCancel:function(){a.hideMenu()},onBeforeChooserSelect:a.onBeforeSelect,onChooserSelect:function(b){null!=a.onSelect&&a.onSelect(b),a.hideMenu()}});a.grid=b,a.menu=new Ins.menu.Menu({id:a.getId()+"_chooser_menu",items:[b],listeners:{beforeshow:function(){a.beforeShowClear&&a.grid.clearSelect();var b=!1;return null!=a.onBeforeShowChooser?b=a.onBeforeShowChooser():(a.grid.load(),b=!0),b}},onMouseDown:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1}}),a.addListener("menuhide",function(){a.grid.setHidden(!0)}),a.addListener("menushow",function(){a.grid.setHidden(!1)}),a.addListener("beforedestroy",function(){(void 0!=a.quickMenu||null!=a.quickMenu)&&Ext.destroy(a.getMenu())}),this.callParent(arguments)},getGrid:function(){return this.grid}}),Ext.define("Ins.player.Player",{extend:"Ext.Component",alias:"widget.ins_player",config:{file:null,image:null,autostart:!1,_playerWidth:"100%",_playerHeight:360,onPlayerReady:null,onPlayerVolume:null,onPlayerPlay:null,onPlayerPause:null,onPlayerComplete:null,onPlayerSeek:null,onPlayerTime:null,onPlayerFullscreen:null},initComponent:function(){var a=this,b=(void 0==a.id||null==a.id?"":a.id)+"_player";a.playerId=b,a.html='<div id="'+b+'"></div>',void 0!=a.width&&(a._playerWidth=a.width),void 0!=a.height&&(a._playerHeight=a.height),a.on("render",function(){a.newInstance(b)}),a.on("beforedestroy",function(){a.remove()}),a.callParent(arguments)},newInstance:function(a){var b=this;jwplayer(a).setup({flashplayer:STATIC_PATH+"/lib/jwplayer/6.12.5/bin-release/jwplayer.flash.swf",file:b.file,image:b.image,autostart:b.autostart,width:b._playerWidth,height:b._playerHeight,events:{onReady:function(){null!=b.onPlayerReady&&b.onPlayerReady()},onVolume:function(a){null!=b.onPlayerReady&&b.onPlayerReady(a.volume)},onPlay:function(){null!=b.onPlayerPlay&&b.onPlayerPlay()},onPause:function(){null!=b.onPlayerPause&&b.onPlayerPause()},onComplete:function(){null!=b.onPlayerComplete&&b.onPlayerComplete()},onSeek:function(a){null!=b.onPlayerSeek&&b.onPlayerSeek(a.position,a.offset)},onTime:function(a){null!=b.onPlayerTime&&b.onPlayerTime(a.position)},onFullscreen:function(a){null!=b.onPlayerFullscreen&&b.onPlayerFullscreen(a.fullscreen)}}})},getPlayer:function(){return jwplayer(this.playerId)},play:function(){this.getPlayer().play(!0)},pause:function(){this.getPlayer().pause(!0)},getState:function(){return this.getPlayer().getState()},stop:function(){this.getPlayer().stop()},remove:function(){this.getPlayer().remove()},load:function(a){this.getPlayer().load([{file:a}])},seek:function(a){this.getPlayer().seek(a)},getPosition:function(){return this.getPlayer().getPosition()},getMute:function(){return this.getPlayer().getMute()},setMute:function(a){this.getPlayer().setMute(a)},getVolume:function(){return this.getPlayer().getVolume()},setVolume:function(a){this.getPlayer().setVolume(a)},getHeight:function(){return this.getPlayer().getHeight()},getWidth:function(){return this.getPlayer().getWidth()},resize:function(a,b){this.getPlayer().resize(a,b)}}),Ext.define("Ins.list.CrudList",{extend:"Ins.panel.Panel",alias:"ins_crudlist",config:{urlConfig:{},dataSet:[],formFields:[],permission:{add:!0,update:!0,remove:!0,view:!0},tplImgUrl:"{icon}",tplField:"{text}",columnSize:2,defaultFormFieldWidth:230,pkField:"id",loadOnShow:!0,customMenu:[],hideTitle:!1,onRowClick:null,onBeforeShowAddForm:null,onBeforeShowEditForm:null,onBeforeShowViewForm:null,onBeforeShowCxtMenu:null,onAfterShowCxtMenu:null,onAfterShowAddForm:null,onAfterShowEditForm:null,onAfterShowViewForm:null,onBeforeDelete:null,onBeforeSaveAdd:null,onBeforeSaveEdit:null,onAfterDelete:null,onAfterFormSubmit:null,formWindowHeight:null,formWindowWidth:510,formWindowMaxHeight:null,formWindowMaxWidth:null,formWindowModal:!1,labelConfig:{add:{text:null,iconCls:null},update:{text:null,iconCls:null},view:{text:null,iconCls:null},remove:{text:null,iconCls:null},query:{text:null,iconCls:null}}},initComponent:function(){var a=this;(null!=a.getHeader()||a.hideTitle)&&Ext.apply(a,{header:!a.hideTitle});var b=[];for(var c in a.dataSet){var d=a.dataSet[c];b.push(d.name)}Ext.apply(a,{fields:b});var e=Ext.create("Ins.data.Store",{url:a.urlConfig.loadAll,fields:a.fields,idProperty:a.pkField,pageSize:1e3,autoLoad:a.loadOnShow});Ext.apply(a,{store:e});var f=[];for(var c in a.formFields){var g=a.formFields[c],h=null;if(void 0!=g.forData&&null!=g.forData||void 0!=g.name&&null!=g.name)h=a.getFieldDefByName(Ext.clone(g)),null!=h&&void 0==h.width&&"component"!=h.xtype&&"container"!=h.xtype&&"panel"!=h.xtype&&"ins_panel"!=h.xtype&&"ins_fieldcontainer"!=h.xtype&&Ext.apply(h,{width:a.defaultFormFieldWidth});else if(void 0!=g.items&&null!=g.items){h=Ext.clone(g),h.items=[];for(var i in g.items)null!=g.items[i]&&void 0==g.items[i].width&&"component"!=g.items[i].xtype&&"container"!=g.items[i].xtype&&"panel"!=g.items[i].xtype&&"ins_panel"!=g.items[i].xtype&&"ins_fieldcontainer"!=g.items[i].xtype&&Ext.apply(g.items[i],{width:a.defaultFormFieldWidth}),h.items.push(a.getFieldDefByName(Ext.clone(g.items[i])))}f.push(h)}var j={fields:f,modal:a.formWindowModal,defaultFormFieldWidth:a.defaultFormFieldWidth,columnSize:a.columnSize,onBeforeHide:function(a){a.getForm().reset()}};null!=a.onAfterFormSubmit&&(j.onAfterSubmit=a.onAfterFormSubmit),null!=a.formWindowHeight&&(j.height=a.formWindowHeight),null!=a.formWindowWidth&&(j.width=a.formWindowWidth),null!=a.formWindowMaxHeight&&(j.maxHeight=a.formWindowMaxHeight),null!=a.formWindowMaxWidth&&(j.maxWidth=a.formWindowMaxWidth);var k=Ext.create("Ins.form.OprFormWindow",j);Ext.apply(a,{form:k,url:a.urlConfig.loadAll});var l=[];if(void 0!=a.urlConfig.update&&null!=a.urlConfig.update&&void 0!=a.urlConfig.load&&null!=a.urlConfig.load&&a.permission.update&&l.push({id:a.getId()+"_edit_btn",iconCls:null!=a.labelConfig.update.iconCls?a.labelConfig.update.iconCls:"icon-edit",text:null!=a.labelConfig.update.text?a.labelConfig.update.text:"Edit",handler:function(){var b=!0;if(void 0!=a.onBeforeShowEditForm&&null!=a.onBeforeShowEditForm&&(b=a.onBeforeShowEditForm(a.getForm())),b){var c={};c[a.pkField]=a.getCurrentRecord().data[a.pkField],k.showAsEditMode({loadUrl:a.urlConfig.load+"?nolog=y",updateUrl:a.urlConfig.update,onBeforeSave:a.onBeforeSaveEdit,params:c,success:function(b){a.load()},onSuccess:function(b,c){null!=a.onAfterShowEditForm&&a.onAfterShowEditForm(b,c)}})}}}),void 0!=a.urlConfig.remove&&null!=a.urlConfig.remove&&a.permission.remove&&l.push({id:a.getId()+"_delete_btn",text:null!=a.labelConfig.remove.text?a.labelConfig.remove.text:"Delete",iconCls:null!=a.labelConfig.remove.iconCls?a.labelConfig.remove.iconCls:"icon-delete",handler:function(b){var c=!0;if(void 0!=a.onBeforeDelete&&null!=a.onBeforeDelete&&(c=a.onBeforeDelete(a.getCurrentRecord())),c){var d=a.getCurrentRecord().data[a.pkField];Messager.send({confirm:"Delete this node?",maskCmp:a,url:a.urlConfig.remove,data:{id:d},onSuccess:function(b){a.load(),null!=a.onAfterDelete&&a.onAfterDelete(),TopMessage.info("Success")}})}}}),void 0!=a.urlConfig.load&&null!=a.urlConfig.load&&a.permission.view&&l.push({id:a.getId()+"_view_btn",iconCls:null!=a.labelConfig.view.iconCls?a.labelConfig.view.iconCls:"icon-view",text:null!=a.labelConfig.view.text?a.labelConfig.view.text:"View",handler:function(){var b=!0;if(void 0!=a.onBeforeShowViewForm&&null!=a.onBeforeShowViewForm&&(b=a.onBeforeShowViewForm(a.getForm())),b){var c={};c[a.pkField]=a.getCurrentRecord().data[a.pkField],k.showAsViewMode({loadUrl:a.urlConfig.load,params:c,onSuccess:function(b,c){null!=a.onAfterShowViewForm&&a.onAfterShowViewForm(b,c)}})}}}),void 0!=a.customMenu&&a.customMenu.length>0){l.length>0&&l.push("-");for(var c in a.customMenu){var g=a.customMenu[c];l.push(g)}}if(l.length>0){var m=new Ins.menu.Menu({items:l});Ext.apply(a,{contextMenu:m})}-1==a.tplField.indexOf("{")&&(a.tplField="{"+a.tplField+"}");var n=Ext.create("Ext.view.View",{scrollable:"y",itemSelector:"div",store:a.store,tpl:'<tpl for="."><div style="background: url('+a.tplImgUrl+') no-repeat 8px 2px;margin-top: 3px;margin-bottom: 3px;padding-left: 29px;font-size: 13px;line-height: 20px;cursor: pointer;border: 1px solid #fff;">'+a.tplField+"</div></tpl>",listeners:{itemclick:function(b,c,d,e,f,g){a.currentRecord=c,null!=a.onRowClick&&a.onRowClick(c,e,f)},itemcontextmenu:function(b,c,d,e,f,g){App.utils.preventDefault(f),a.currentRecord=c;var h=!0;null!=a.onBeforeShowCxtMenu&&(h=a.onBeforeShowCxtMenu(m)),h&&l.length>0&&(a.contextMenu.showAt(f.getXY()),null!=a.onAfterShowCxtMenu&&a.onAfterShowCxtMenu(m))}}});a.dataView=n;var o=[];a.permission.add&&o.push({type:"plus",tooltip:"添加",handler:function(b,c,d){var e=!0;null!=a.onBeforeShowAddForm&&(e=a.onBeforeShowAddForm(a.getForm())),e&&(k.showAsAddMode({url:a.urlConfig.add,onBeforeSave:a.onBeforeSaveAdd,success:function(b){a.load()}}),null!=a.onAfterShowAddForm&&a.onAfterShowAddForm(a.getForm()))}}),o.push({type:"refresh",tooltip:"Refresh",handler:function(b,c,d){a.load()}}),Ext.apply(a,{views:[n],headButtons:o}),a.addListener("beforedestroy",function(){(void 0!=a.form||null!=a.form)&&Ext.destroy(a.form),(void 0!=a.contextMenu||null!=a.contextMenu)&&Ext.destroy(a.contextMenu)}),a.callParent(arguments)},getFieldDefByName:function(a){var b=this;for(var c in b.dataSet){var d=b.dataSet[c];if(d.name==a.forData)return Ext.apply(a,{fieldLabel:d.text,text:d.text,name:d.name}),a}return null!=a.name&&void 0!=a.name?(Ext.apply(a,{fieldLabel:a.text,text:a.text}),a):void(window.console&&console.error("没有发现 dataSet 中配置的该表单字段。"))},getForm:function(){var a=this;return a.form.getForm()},getCurrentRecord:function(){var a=this;return a.currentRecord},getDataView:function(){var a=this;return a.dataView},load:function(a){var b=this;b.setDisabled(!1),void 0!=a&&null!=a&&(b.loadParams=a,b.dataView.getStore().proxy.extraParams=b.loadParams),b.dataView.getStore().reload()}}),Ext.define("Ins.grid.GridHeaderUtil",{init:function(a){var b=a.saveGridColums;if(b&&0!=b.enabled){if(null==CURRENT_USER&&!CURRENT_USER.id)return void(window.console&&console.error("没有用户id，不能使用自定义表头功能。"));if(!b.key)return void(window.console&&console.error("saveGridColums中没有发现key值，key值是必选属性"));a._saveColumns=function(b){var c=["width","text","dataIndex","hidden","locked"],d={};Ext.Array.each(b.getGridColumns(),function(b,e){d={sortNum:e},Ext.Array.each(c,function(a){d[a]=b[a]}),b.dataIndex&&(a.INS_GRIDCOLUMSMAP[b.dataIndex]=d)})},a.sortBySortNum=function(a){return Ext.Array.sort(a,function(a,b){return a.sortNum<b.sortNum?-1:a.sortNum>b.sortNum?1:0})},Ext.Array.each(a.gridColumns,function(a,b){a.dataIndex||(a.dataIndex=a.forData),void 0!=a&&null!=a.columns&&a.columns.length>0&&Ext.Array.each(a.columns,function(a,b){a.dataIndex||(a.dataIndex=a.forData)})}),a.INS_GRIDCOLUMSMAP={},a.addListener("columnschanged",function(b){a._saveColumns(b)}),a.addListener("columnresize",function(b){a._saveColumns(b)});var c={text:"保存表头",iconCls:"icon-ok"};b.button&&Ext.apply(c,b.button);var d=c.handler;c.handler=function(){Messager.send({url:CTX_PATH+"/grid/header/saveGridColums",data:{userId:CURRENT_USER.id,key:b.key,columsJson:JSON.stringify(a.INS_GRIDCOLUMSMAP)},onSuccess:function(a){var b=!0;null!=d&&(b=d()),b&&TopMessage.info("表头保存成功")},onError:function(){alert("请求异常")}})},a.actionButtons||(a.actionButtons=[]),a.actionButtons.push("->",c);var e=null;if(Messager.send({url:CTX_PATH+"/grid/header/getGridColums",sync:!0,data:{userId:CURRENT_USER.id,key:b.key},onSuccess:function(a){a&&a.columsJson&&(e=JSON.parse(a.columsJson))},onError:function(){alert("获取表头失败")}}),e){var f,g=[],h=[];Ext.Array.each(a.gridColumns,function(b,c){f=e[b.dataIndex],f&&Ext.apply(b,f),void 0!=b&&null!=b.columns&&b.columns.length>0?(h=[],Ext.Array.each(b.columns,function(a,c){f=e[a.dataIndex],f&&Ext.apply(a,f),a.locked===!0?g.push(a):(h.push(a),b.sortNum||(b.sortNum=a.sortNum))}),b.columns=a.sortBySortNum(h),b.columns.length>0&&g.push(b)):g.push(b)}),a.gridColumns=a.sortBySortNum(g)}}}}),Ext.define("Ins.grid.GridDev",{extend:"Ins.grid.Grid",alias:["widget.ins_griddev"],initComponent:function(){var a=this;App.getClass("Ins.grid.GridHeaderUtil").init(a),this.callParent(arguments)}}),Ext.define("Ins.grid.CrudGridDev",{extend:"Ins.grid.CrudGrid",alias:["widget.ins_crudgriddev"],initComponent:function(){var a=this;App.getClass("Ins.grid.GridHeaderUtil").init(a),this.callParent(arguments)}});